<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.251">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Modern Investments: Theory, Data, and Practice - 4&nbsp; Optimal Portfolios: Practice</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./input_sensitivity.html" rel="next">
<link href="./portfolios.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
        <script type="text/javascript">
        window.PlotlyConfig = {MathJaxConfig: 'local'};
        if (window.MathJax && window.MathJax.Hub && window.MathJax.Hub.Config) {window.MathJax.Hub.Config({SVG: {font: "STIX-Web"}});}
        if (typeof require !== 'undefined') {
        require.undef("plotly");
        requirejs.config({
            paths: {
                'plotly': ['https://cdn.plot.ly/plotly-2.14.0.min']
            }
        });
        require(['plotly'], function(Plotly) {
            window._Plotly = Plotly;
        });
        }
        </script>
        

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Optimal Portfolios: Practice</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Modern Investments: Theory, Data, and Practice</a> 
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Preface</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./miracle.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Miracle of Compound Interest</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./diversification.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Miracle of Diversification</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./portfolios.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Optimal Portfolios: Theory</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./portfolios_frictions.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Optimal Portfolios: Practice</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./input_sensitivity.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Optimal Portfolios: Sensitivity to Inputs</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./fixed-income.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Fixed Income</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#different-borrowing-lending-rates" id="toc-different-borrowing-lending-rates" class="nav-link active" data-scroll-target="#different-borrowing-lending-rates"><span class="toc-section-number">4.1</span>  Different Borrowing &amp; Lending Rates</a>
  <ul class="collapse">
  <li><a href="#kinked-cals" id="toc-kinked-cals" class="nav-link" data-scroll-target="#kinked-cals">Kinked CALs</a></li>
  <li><a href="#optimal-portfolios" id="toc-optimal-portfolios" class="nav-link" data-scroll-target="#optimal-portfolios">Optimal Portfolios</a></li>
  <li><a href="#optimal-capital-allocation" id="toc-optimal-capital-allocation" class="nav-link" data-scroll-target="#optimal-capital-allocation">Optimal Capital Allocation</a></li>
  </ul></li>
  <li><a href="#short-sales-constraints" id="toc-short-sales-constraints" class="nav-link" data-scroll-target="#short-sales-constraints"><span class="toc-section-number">4.2</span>  Short-Sales Constraints</a>
  <ul class="collapse">
  <li><a href="#short-sales-and-hedging" id="toc-short-sales-and-hedging" class="nav-link" data-scroll-target="#short-sales-and-hedging">Short-Sales and Hedging</a></li>
  <li><a href="#gmv-and-frontier-portfolios" id="toc-gmv-and-frontier-portfolios" class="nav-link" data-scroll-target="#gmv-and-frontier-portfolios">GMV and Frontier Portfolios</a></li>
  <li><a href="#tangency-portfolio" id="toc-tangency-portfolio" class="nav-link" data-scroll-target="#tangency-portfolio">Tangency Portfolio</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec-optimal-portfolios-practice" class="quarto-section-identifier d-none d-lg-block"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Optimal Portfolios: Practice</span></span></h1>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<p>The optimal portfolios studied in <a href="#sec-diversification"><span class="quarto-unresolved-ref">sec-diversification</span></a> and <a href="#sec-optimal-portfolios-theory"><span class="quarto-unresolved-ref">sec-optimal-portfolios-theory</span></a> assumed away a number of frictions that are important in practice. Most investors cannot borrow at the same rate at which they save. Some investors cannot sell securities short or may also have other position limits such as maximum portfolio weights. We show how the analyses in the preceding chapters change when we impose more realistic assumptions on the investing environment.</p>
<section id="different-borrowing-lending-rates" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="different-borrowing-lending-rates"><span class="header-section-number">4.1</span> Different Borrowing &amp; Lending Rates</h2>
<section id="kinked-cals" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="kinked-cals">Kinked CALs</h3>
<p>The capital allocation line is the set of expected returns and standard deviations formed by combining a single risky asset (or portfolio) with weight <span class="math inline">\(w\)</span> and a risk-free asset with weight <span class="math inline">\(1-w\)</span>. In <a href="#sec-optimal-portfolios-theory"><span class="quarto-unresolved-ref">sec-optimal-portfolios-theory</span></a>, we assumed a single risk-free rate. Any portfolios with <span class="math inline">\(w&gt;100\%\)</span> involve borrowing at the risk-free rate (that is, issuing bonds at the same rate as, say, US Treasuries). This is probably not a reasonable assumption. For most investors, <span class="math inline">\(r^{\text{borrow}}&gt;r^{\text{saving}}\)</span>. In this case, the capital allocation line is kinked at the risky-asset. For portfolios with some risk-free saving, the capital allocation line is the same as in <a href="#eq-cal">Equation&nbsp;<span class="quarto-unresolved-ref">eq-cal</span></a>:</p>
<p><span class="math display">\[ E[r_p] = r_f^{\text{saving}} + \bigg[ \frac{E[r_{\text{risky}}]-r_f^{\text{saving}}}{\text{sd}[r_{\text{risky}}] }\bigg]\cdot \text{sd}[r_p]\,.\]</span></p>
<p>For portfolios with borrowing, the capital allocation line has a lower slope: <span class="math display">\[ E[r_p] = r_f^{\text{borrow}} + \bigg[ \frac{E[r_{\text{risky}}]-r_f^{\text{borrow}}}{\text{sd}[r_{\text{risky}}] }\bigg]\cdot \text{sd}[r_p]\,.\]</span> <a href="#fig-cal">Figure&nbsp;<span class="quarto-unresolved-ref">fig-cal</span></a> shows the set of possible portfolios along the kinked capital allocation line with differential savings and borrowing rates. The black dotted lines extend the blue solid lines, but the points on the black dotted lines are infeasible, because they involve saving at the borrowing rate or borrowing at the savings rate.</p>
<div class="cell" data-execution_count="2">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.graph_objects <span class="im">as</span> go</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Parameter values (in percent)</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>mn <span class="op">=</span> <span class="dv">6</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>sd <span class="op">=</span> <span class="dv">15</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>s <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>extra <span class="op">=</span> <span class="fl">1.25</span>    <span class="co">#incremental borrowing rate</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> data(mn, sd, s, b):</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    grid <span class="op">=</span> np.linspace(<span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">201</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    mns <span class="op">=</span> [(s <span class="op">+</span> w <span class="op">*</span> (mn <span class="op">-</span> s) <span class="cf">if</span> w <span class="op">&lt;=</span> <span class="dv">1</span> <span class="cf">else</span> b <span class="op">+</span> w <span class="op">*</span> (mn <span class="op">-</span> b)) <span class="cf">for</span> w <span class="kw">in</span> grid]</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    sds <span class="op">=</span> [w <span class="op">*</span> sd <span class="cf">for</span> w <span class="kw">in</span> grid]</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    mns_infeasible <span class="op">=</span> [(s <span class="op">+</span> w <span class="op">*</span> (mn <span class="op">-</span> s) <span class="cf">if</span> w <span class="op">&gt;</span> <span class="dv">1</span> <span class="cf">else</span> b <span class="op">+</span> w <span class="op">*</span> (mn <span class="op">-</span> b)) <span class="cf">for</span> w <span class="kw">in</span> grid]</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> grid, mns, sds, mns_infeasible</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> figtbl(mn, sd, s, extra):</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>    mn <span class="op">/=</span> <span class="dv">100</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>    sd <span class="op">/=</span> <span class="dv">100</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>    b <span class="op">=</span> s<span class="op">+</span>extra</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>    s <span class="op">/=</span> <span class="dv">100</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>    b <span class="op">/=</span> <span class="dv">100</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>    grid, mns, sds, mns_infeasible <span class="op">=</span> data(mn, sd, s, b)</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.DataFrame({<span class="st">'grid'</span>: grid, <span class="st">'mns'</span>: mns, <span class="st">'sds'</span>: sds, <span class="st">'mns_infeas'</span>:mns_infeasible})</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>    string <span class="op">=</span> <span class="st">"wealth in market = %</span><span class="sc">{text:.0f}</span><span class="st">%&lt;extra&gt;&lt;/extra&gt;"</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>    trace1 <span class="op">=</span> go.Scatter(</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span>df[grid<span class="op">&lt;=</span><span class="dv">1</span>].sds, y<span class="op">=</span>df[grid<span class="op">&lt;=</span><span class="dv">1</span>].mns, mode<span class="op">=</span><span class="st">"lines"</span>, text<span class="op">=</span><span class="dv">100</span> <span class="op">*</span> df[grid<span class="op">&lt;=</span><span class="dv">1</span>].grid, hovertemplate<span class="op">=</span>string, name<span class="op">=</span><span class="st">'CAL (saving)'</span>, line<span class="op">=</span><span class="bu">dict</span>(color<span class="op">=</span><span class="st">"blue"</span>),</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>    string <span class="op">=</span> <span class="st">"wealth in market = %</span><span class="sc">{text:.0f}</span><span class="st">%&lt;extra&gt;&lt;/extra&gt;"</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>    trace1a <span class="op">=</span> go.Scatter(</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span>df[grid<span class="op">&gt;</span><span class="dv">1</span>].sds, y<span class="op">=</span>df[grid<span class="op">&gt;</span><span class="dv">1</span>].mns, mode<span class="op">=</span><span class="st">"lines"</span>, text<span class="op">=</span><span class="dv">100</span> <span class="op">*</span> df[grid<span class="op">&gt;</span><span class="dv">1</span>].grid, hovertemplate<span class="op">=</span>string, name<span class="op">=</span><span class="st">'CAL (borrowing)'</span>, line<span class="op">=</span><span class="bu">dict</span>(color<span class="op">=</span><span class="st">"blue"</span>),</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>    string <span class="op">=</span> <span class="st">"infeasible saving at borrowing rate&lt;extra&gt;&lt;/extra&gt;"</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>    trace2 <span class="op">=</span> go.Scatter(</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span>df[grid<span class="op">&lt;=</span><span class="dv">1</span>].sds, y<span class="op">=</span>df[grid<span class="op">&lt;=</span><span class="dv">1</span>].mns_infeas, mode<span class="op">=</span><span class="st">"lines"</span>, hovertemplate<span class="op">=</span>string, showlegend <span class="op">=</span> <span class="va">False</span>, line<span class="op">=</span><span class="bu">dict</span>(color<span class="op">=</span><span class="st">"black"</span>, dash<span class="op">=</span><span class="st">'dot'</span>),</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>    string <span class="op">=</span> <span class="st">"infeasible borrowing at saving rate&lt;extra&gt;&lt;/extra&gt;"</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>    trace2a <span class="op">=</span> go.Scatter(</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span>df[grid<span class="op">&gt;</span><span class="dv">1</span>].sds, y<span class="op">=</span>df[grid<span class="op">&gt;</span><span class="dv">1</span>].mns_infeas, mode<span class="op">=</span><span class="st">"lines"</span>, hovertemplate<span class="op">=</span>string, showlegend <span class="op">=</span> <span class="va">False</span>, line<span class="op">=</span><span class="bu">dict</span>(color<span class="op">=</span><span class="st">"black"</span>, dash<span class="op">=</span><span class="st">'dot'</span>),</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>    string <span class="op">=</span> <span class="st">"wealth in market = 100%&lt;extra&gt;&lt;/extra&gt;"</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>    trace3 <span class="op">=</span> go.Scatter(</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span>[sd], y<span class="op">=</span>[mn], mode<span class="op">=</span><span class="st">"markers"</span>, hovertemplate<span class="op">=</span>string, marker<span class="op">=</span><span class="bu">dict</span>(size<span class="op">=</span><span class="dv">15</span>), name<span class="op">=</span><span class="st">'Market'</span></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>    string <span class="op">=</span> <span class="st">"wealth in market = 0%&lt;extra&gt;&lt;/extra&gt;"</span></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>    trace4 <span class="op">=</span> go.Scatter(</span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span>[<span class="dv">0</span>], y<span class="op">=</span>[s], mode<span class="op">=</span><span class="st">"markers"</span>, hovertemplate<span class="op">=</span>string, marker<span class="op">=</span><span class="bu">dict</span>(size<span class="op">=</span><span class="dv">15</span>), name<span class="op">=</span><span class="st">'Risk-free (Saving)'</span></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>    )  </span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>    string <span class="op">=</span> <span class="st">"Borrowing rate&lt;extra&gt;&lt;/extra&gt;"</span></span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>    trace5 <span class="op">=</span> go.Scatter(</span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span>[<span class="dv">0</span>], y<span class="op">=</span>[b], mode<span class="op">=</span><span class="st">"markers"</span>, hovertemplate<span class="op">=</span>string, marker<span class="op">=</span><span class="bu">dict</span>(size<span class="op">=</span><span class="dv">15</span>), name<span class="op">=</span><span class="st">'Risk-free (Borrowing)'</span></span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>    )       </span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>    fig <span class="op">=</span> go.Figure()</span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>    fig.add_trace(trace1)</span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>    fig.add_trace(trace1a)</span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>    fig.add_trace(trace2)</span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>    fig.add_trace(trace2a)</span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>    fig.add_trace(trace3)</span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>    fig.add_trace(trace4)</span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>    fig.add_trace(trace5)</span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>    fig.layout.xaxis[<span class="st">"title"</span>] <span class="op">=</span> <span class="st">"Standard Deviation"</span></span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>    fig.layout.yaxis[<span class="st">"title"</span>] <span class="op">=</span> <span class="st">"Expected Return"</span></span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>    fig.update_yaxes(tickformat<span class="op">=</span><span class="st">".0%"</span>)</span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>    fig.update_xaxes(tickformat<span class="op">=</span><span class="st">".0%"</span>)</span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>    fig.update_layout(legend<span class="op">=</span><span class="bu">dict</span>(yanchor<span class="op">=</span><span class="st">"top"</span>, y <span class="op">=</span><span class="fl">0.99</span>, xanchor<span class="op">=</span><span class="st">"left"</span>, x<span class="op">=</span><span class="fl">0.01</span>))</span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>    fig.show()</span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a>figtbl(mn, sd, s, extra)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-cal" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">

<div>                            <div id="c5210fef-c441-4310-9c85-9aa153c44389" class="plotly-graph-div" style="height:525px; width:100%;"></div>            <script type="text/javascript">                require(["plotly"], function(Plotly) {                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("c5210fef-c441-4310-9c85-9aa153c44389")) {                    Plotly.newPlot(                        "c5210fef-c441-4310-9c85-9aa153c44389",                        [{"hovertemplate":"wealth in market = %{text:.0f}%<extra></extra>","line":{"color":"blue"},"mode":"lines","name":"CAL (saving)","text":[0.0,1.0,2.0,3.0,4.0,5.0,6.0,7.000000000000001,8.0,9.0,10.0,11.0,12.0,13.0,14.000000000000002,15.0,16.0,17.0,18.0,19.0,20.0,21.0,22.0,23.0,24.0,25.0,26.0,27.0,28.000000000000004,28.999999999999996,30.0,31.0,32.0,33.0,34.0,35.0,36.0,37.0,38.0,39.0,40.0,41.0,42.0,43.0,44.0,45.0,46.0,47.0,48.0,49.0,50.0,51.0,52.0,53.0,54.0,55.00000000000001,56.00000000000001,57.00000000000001,57.99999999999999,59.0,60.0,61.0,62.0,63.0,64.0,65.0,66.0,67.0,68.0,69.0,70.0,71.0,72.0,73.0,74.0,75.0,76.0,77.0,78.0,79.0,80.0,81.0,82.0,83.0,84.0,85.0,86.0,87.0,88.0,89.0,90.0,91.0,92.0,93.0,94.0,95.0,96.0,97.0,98.0,99.0,100.0],"x":[0.0,0.0015,0.003,0.0045,0.006,0.0075,0.009,0.0105,0.012,0.0135,0.015,0.0165,0.018,0.0195,0.021,0.0225,0.024,0.025500000000000002,0.027,0.028499999999999998,0.03,0.0315,0.033,0.0345,0.036,0.0375,0.039,0.0405,0.042,0.0435,0.045,0.0465,0.048,0.0495,0.051000000000000004,0.052500000000000005,0.054,0.0555,0.056999999999999995,0.058499999999999996,0.06,0.0615,0.063,0.0645,0.066,0.0675,0.069,0.07050000000000001,0.072,0.0735,0.075,0.0765,0.078,0.0795,0.081,0.0825,0.084,0.0855,0.087,0.0885,0.09,0.0915,0.093,0.0945,0.096,0.0975,0.099,0.1005,0.10200000000000001,0.10350000000000001,0.10500000000000001,0.1065,0.108,0.1095,0.111,0.11249999999999999,0.11399999999999999,0.11549999999999999,0.11699999999999999,0.1185,0.12,0.1215,0.123,0.1245,0.126,0.1275,0.129,0.1305,0.132,0.1335,0.135,0.1365,0.138,0.1395,0.14100000000000001,0.14250000000000002,0.144,0.1455,0.147,0.1485,0.15],"y":[0.02,0.0204,0.0208,0.0212,0.0216,0.022,0.0224,0.0228,0.0232,0.0236,0.024,0.024399999999999998,0.0248,0.0252,0.0256,0.026,0.0264,0.0268,0.0272,0.0276,0.027999999999999997,0.028399999999999998,0.0288,0.0292,0.029599999999999998,0.03,0.0304,0.0308,0.0312,0.031599999999999996,0.032,0.0324,0.032799999999999996,0.0332,0.0336,0.034,0.0344,0.0348,0.035199999999999995,0.0356,0.036,0.0364,0.0368,0.0372,0.037599999999999995,0.038,0.038400000000000004,0.0388,0.0392,0.039599999999999996,0.039999999999999994,0.0404,0.0408,0.0412,0.0416,0.041999999999999996,0.0424,0.0428,0.043199999999999995,0.0436,0.044,0.044399999999999995,0.04479999999999999,0.0452,0.0456,0.046,0.0464,0.046799999999999994,0.0472,0.0476,0.048,0.0484,0.048799999999999996,0.049199999999999994,0.04959999999999999,0.049999999999999996,0.0504,0.0508,0.051199999999999996,0.05159999999999999,0.05199999999999999,0.0524,0.0528,0.0532,0.053599999999999995,0.05399999999999999,0.05439999999999999,0.0548,0.0552,0.0556,0.055999999999999994,0.05639999999999999,0.0568,0.0572,0.0576,0.057999999999999996,0.058399999999999994,0.05879999999999999,0.05919999999999999,0.0596,0.06],"type":"scatter"},{"hovertemplate":"wealth in market = %{text:.0f}%<extra></extra>","line":{"color":"blue"},"mode":"lines","name":"CAL (borrowing)","text":[101.0,102.0,103.0,104.0,105.0,106.0,107.0,108.0,109.00000000000001,110.00000000000001,111.00000000000001,112.00000000000001,113.00000000000001,114.00000000000001,115.00000000000001,115.99999999999999,117.0,118.0,119.0,120.0,121.0,122.0,123.0,124.0,125.0,126.0,127.0,128.0,129.0,130.0,131.0,132.0,133.0,134.0,135.0,136.0,137.0,138.0,139.0,140.0,141.0,142.0,143.0,144.0,145.0,146.0,147.0,148.0,149.0,150.0,151.0,152.0,153.0,154.0,155.0,156.0,157.0,158.0,159.0,160.0,161.0,162.0,163.0,164.0,165.0,166.0,167.0,168.0,169.0,170.0,171.0,172.0,173.0,174.0,175.0,176.0,177.0,178.0,179.0,180.0,181.0,182.0,183.0,184.0,185.0,186.0,187.0,188.0,189.0,190.0,191.0,192.0,193.0,194.0,195.0,196.0,197.0,198.0,199.0,200.0],"x":[0.1515,0.153,0.1545,0.156,0.1575,0.159,0.1605,0.162,0.1635,0.165,0.1665,0.168,0.1695,0.171,0.17250000000000001,0.174,0.1755,0.177,0.1785,0.18,0.1815,0.183,0.1845,0.186,0.1875,0.189,0.1905,0.192,0.1935,0.195,0.1965,0.198,0.1995,0.201,0.2025,0.20400000000000001,0.20550000000000002,0.20700000000000002,0.20850000000000002,0.21000000000000002,0.2115,0.213,0.2145,0.216,0.2175,0.219,0.2205,0.222,0.2235,0.22499999999999998,0.22649999999999998,0.22799999999999998,0.22949999999999998,0.23099999999999998,0.23249999999999998,0.23399999999999999,0.2355,0.237,0.2385,0.24,0.2415,0.243,0.2445,0.246,0.2475,0.249,0.2505,0.252,0.2535,0.255,0.2565,0.258,0.2595,0.261,0.2625,0.264,0.2655,0.267,0.2685,0.27,0.2715,0.273,0.2745,0.276,0.2775,0.279,0.2805,0.28200000000000003,0.28350000000000003,0.28500000000000003,0.28650000000000003,0.288,0.2895,0.291,0.2925,0.294,0.2955,0.297,0.2985,0.3],"y":[0.060274999999999995,0.06055,0.060825,0.0611,0.061375,0.061649999999999996,0.061925,0.0622,0.062475,0.06275,0.063025,0.0633,0.06357499999999999,0.06385,0.064125,0.06439999999999999,0.064675,0.06495,0.065225,0.0655,0.065775,0.06605,0.066325,0.06659999999999999,0.06687499999999999,0.06714999999999999,0.067425,0.0677,0.06797500000000001,0.06825,0.068525,0.0688,0.069075,0.06935,0.06962499999999999,0.06989999999999999,0.070175,0.07045,0.07072500000000001,0.07100000000000001,0.07127499999999999,0.07155,0.071825,0.0721,0.072375,0.07264999999999999,0.07292499999999999,0.07319999999999999,0.073475,0.07375,0.074025,0.0743,0.074575,0.07485,0.075125,0.0754,0.07567499999999999,0.07594999999999999,0.076225,0.0765,0.076775,0.07705000000000001,0.077325,0.0776,0.077875,0.07815,0.078425,0.07869999999999999,0.07897499999999999,0.07924999999999999,0.07952499999999998,0.0798,0.080075,0.08035,0.080625,0.0809,0.081175,0.08145,0.08172499999999999,0.08199999999999999,0.08227499999999999,0.08255,0.082825,0.08310000000000001,0.083375,0.08365,0.083925,0.0842,0.084475,0.08474999999999999,0.08502499999999999,0.08529999999999999,0.08557499999999998,0.08585,0.086125,0.08639999999999999,0.086675,0.08695,0.087225,0.0875],"type":"scatter"},{"hovertemplate":"infeasible saving at borrowing rate<extra></extra>","line":{"color":"black","dash":"dot"},"mode":"lines","showlegend":false,"x":[0.0,0.0015,0.003,0.0045,0.006,0.0075,0.009,0.0105,0.012,0.0135,0.015,0.0165,0.018,0.0195,0.021,0.0225,0.024,0.025500000000000002,0.027,0.028499999999999998,0.03,0.0315,0.033,0.0345,0.036,0.0375,0.039,0.0405,0.042,0.0435,0.045,0.0465,0.048,0.0495,0.051000000000000004,0.052500000000000005,0.054,0.0555,0.056999999999999995,0.058499999999999996,0.06,0.0615,0.063,0.0645,0.066,0.0675,0.069,0.07050000000000001,0.072,0.0735,0.075,0.0765,0.078,0.0795,0.081,0.0825,0.084,0.0855,0.087,0.0885,0.09,0.0915,0.093,0.0945,0.096,0.0975,0.099,0.1005,0.10200000000000001,0.10350000000000001,0.10500000000000001,0.1065,0.108,0.1095,0.111,0.11249999999999999,0.11399999999999999,0.11549999999999999,0.11699999999999999,0.1185,0.12,0.1215,0.123,0.1245,0.126,0.1275,0.129,0.1305,0.132,0.1335,0.135,0.1365,0.138,0.1395,0.14100000000000001,0.14250000000000002,0.144,0.1455,0.147,0.1485,0.15],"y":[0.0325,0.032775,0.03305,0.033325,0.0336,0.033875,0.03415,0.034425000000000004,0.0347,0.034975,0.035250000000000004,0.035525,0.0358,0.036075,0.03635,0.036625,0.0369,0.037175,0.03745,0.037725,0.038,0.038275,0.03855,0.038825,0.0391,0.039375,0.03965,0.039925,0.0402,0.040475,0.04075,0.041025,0.0413,0.041575,0.04185,0.042125,0.0424,0.042675,0.04295,0.043225,0.0435,0.043775,0.04405,0.044325,0.0446,0.044875,0.04515,0.045425,0.0457,0.045975,0.04625,0.046525,0.0468,0.047075,0.04735,0.047625,0.0479,0.048175,0.04844999999999999,0.048725,0.049,0.049275,0.04955,0.049824999999999994,0.0501,0.050375,0.05065,0.050925,0.051199999999999996,0.051475,0.051750000000000004,0.052025,0.0523,0.052575,0.052849999999999994,0.053125,0.0534,0.053675,0.05395,0.054224999999999995,0.0545,0.054775000000000004,0.05505,0.055325,0.0556,0.055874999999999994,0.05615,0.056425,0.0567,0.056975,0.057249999999999995,0.057525,0.057800000000000004,0.058075,0.05835,0.058625,0.058899999999999994,0.059175,0.059449999999999996,0.059725,0.06],"type":"scatter"},{"hovertemplate":"infeasible borrowing at saving rate<extra></extra>","line":{"color":"black","dash":"dot"},"mode":"lines","showlegend":false,"x":[0.1515,0.153,0.1545,0.156,0.1575,0.159,0.1605,0.162,0.1635,0.165,0.1665,0.168,0.1695,0.171,0.17250000000000001,0.174,0.1755,0.177,0.1785,0.18,0.1815,0.183,0.1845,0.186,0.1875,0.189,0.1905,0.192,0.1935,0.195,0.1965,0.198,0.1995,0.201,0.2025,0.20400000000000001,0.20550000000000002,0.20700000000000002,0.20850000000000002,0.21000000000000002,0.2115,0.213,0.2145,0.216,0.2175,0.219,0.2205,0.222,0.2235,0.22499999999999998,0.22649999999999998,0.22799999999999998,0.22949999999999998,0.23099999999999998,0.23249999999999998,0.23399999999999999,0.2355,0.237,0.2385,0.24,0.2415,0.243,0.2445,0.246,0.2475,0.249,0.2505,0.252,0.2535,0.255,0.2565,0.258,0.2595,0.261,0.2625,0.264,0.2655,0.267,0.2685,0.27,0.2715,0.273,0.2745,0.276,0.2775,0.279,0.2805,0.28200000000000003,0.28350000000000003,0.28500000000000003,0.28650000000000003,0.288,0.2895,0.291,0.2925,0.294,0.2955,0.297,0.2985,0.3],"y":[0.060399999999999995,0.06079999999999999,0.06119999999999999,0.0616,0.062,0.0624,0.0628,0.06319999999999999,0.0636,0.064,0.0644,0.0648,0.0652,0.06559999999999999,0.066,0.06639999999999999,0.06679999999999998,0.0672,0.0676,0.06799999999999999,0.06839999999999999,0.06879999999999999,0.0692,0.0696,0.06999999999999999,0.07039999999999999,0.07079999999999999,0.0712,0.0716,0.072,0.07239999999999999,0.07279999999999999,0.0732,0.0736,0.074,0.0744,0.07479999999999999,0.0752,0.0756,0.076,0.07639999999999998,0.0768,0.07719999999999999,0.07759999999999999,0.07799999999999999,0.07839999999999998,0.0788,0.07919999999999999,0.07959999999999999,0.07999999999999999,0.08039999999999999,0.0808,0.0812,0.08159999999999999,0.08199999999999999,0.08239999999999999,0.0828,0.0832,0.0836,0.08399999999999999,0.0844,0.0848,0.0852,0.0856,0.086,0.0864,0.08679999999999999,0.08719999999999999,0.0876,0.088,0.08839999999999999,0.08879999999999999,0.08919999999999999,0.0896,0.09,0.0904,0.09079999999999999,0.09119999999999999,0.0916,0.092,0.0924,0.0928,0.09319999999999999,0.0936,0.094,0.0944,0.0948,0.09519999999999999,0.09559999999999999,0.096,0.0964,0.09679999999999998,0.0972,0.09759999999999999,0.09799999999999999,0.09839999999999999,0.09879999999999999,0.0992,0.0996,0.09999999999999999],"type":"scatter"},{"hovertemplate":"wealth in market = 100%<extra></extra>","marker":{"size":15},"mode":"markers","name":"Market","x":[0.15],"y":[0.06],"type":"scatter"},{"hovertemplate":"wealth in market = 0%<extra></extra>","marker":{"size":15},"mode":"markers","name":"Risk-free (Saving)","x":[0],"y":[0.02],"type":"scatter"},{"hovertemplate":"Borrowing rate<extra></extra>","marker":{"size":15},"mode":"markers","name":"Risk-free (Borrowing)","x":[0],"y":[0.0325],"type":"scatter"}],                        {"template":{"data":{"histogram2dcontour":[{"type":"histogram2dcontour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"choropleth":[{"type":"choropleth","colorbar":{"outlinewidth":0,"ticks":""}}],"histogram2d":[{"type":"histogram2d","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmap":[{"type":"heatmap","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmapgl":[{"type":"heatmapgl","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"contourcarpet":[{"type":"contourcarpet","colorbar":{"outlinewidth":0,"ticks":""}}],"contour":[{"type":"contour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"surface":[{"type":"surface","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"mesh3d":[{"type":"mesh3d","colorbar":{"outlinewidth":0,"ticks":""}}],"scatter":[{"fillpattern":{"fillmode":"overlay","size":10,"solidity":0.2},"type":"scatter"}],"parcoords":[{"type":"parcoords","line":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolargl":[{"type":"scatterpolargl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"scattergeo":[{"type":"scattergeo","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolar":[{"type":"scatterpolar","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"scattergl":[{"type":"scattergl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatter3d":[{"type":"scatter3d","line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattermapbox":[{"type":"scattermapbox","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterternary":[{"type":"scatterternary","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattercarpet":[{"type":"scattercarpet","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"type":"carpet"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}],"barpolar":[{"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"pie":[{"automargin":true,"type":"pie"}]},"layout":{"autotypenumbers":"strict","colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"hovermode":"closest","hoverlabel":{"align":"left"},"paper_bgcolor":"white","plot_bgcolor":"#E5ECF6","polar":{"bgcolor":"#E5ECF6","angularaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"radialaxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"ternary":{"bgcolor":"#E5ECF6","aaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"baxis":{"gridcolor":"white","linecolor":"white","ticks":""},"caxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]]},"xaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"yaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"scene":{"xaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"yaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"zaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"geo":{"bgcolor":"white","landcolor":"#E5ECF6","subunitcolor":"white","showland":true,"showlakes":true,"lakecolor":"white"},"title":{"x":0.05},"mapbox":{"style":"light"}}},"xaxis":{"title":{"text":"Standard Deviation"},"tickformat":".0%"},"yaxis":{"title":{"text":"Expected Return"},"tickformat":".0%"},"legend":{"yanchor":"top","y":0.99,"xanchor":"left","x":0.01}},                        {"responsive": true}                    ).then(function(){
                            
var gd = document.getElementById('c5210fef-c441-4310-9c85-9aa153c44389');
var x = new MutationObserver(function (mutations, observer) {{
        var display = window.getComputedStyle(gd).display;
        if (!display || display === 'none') {{
            console.log([gd, 'removed!']);
            Plotly.purge(gd);
            observer.disconnect();
        }}
}});

// Listen for the removal of the full notebook cells
var notebookContainer = gd.closest('#notebook-container');
if (notebookContainer) {{
    x.observe(notebookContainer, {childList: true});
}}

// Listen for the clearing of the current output cell
var outputEl = gd.closest('.output');
if (outputEl) {{
    x.observe(outputEl, {childList: true});
}}

                        })                };                });            </script>        </div>
<p></p><figcaption class="figure-caption">Figure&nbsp;4.1: Capital Allocation Line</figcaption><p></p>
</figure>
</div>
</div>
</section>
<section id="optimal-portfolios" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="optimal-portfolios">Optimal Portfolios</h3>
<p>Under the more realistic assumption that <span class="math inline">\(r_f^{\text{borrow}}&gt;r_f^{\text{saving}}\)</span>, efficient portfolios fall into three regions, separated by blue dots in <a href="#fig-two-asset-plus_rf_saveborrow">Figure&nbsp;<span class="quarto-unresolved-ref">fig-two-asset-plus_rf_saveborrow</span></a>.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> These blue dots indicate an efficient low risk portfolio and an efficient high mean portfolio, both comprised solely of risky assets. The efficient low risk portfolio is the tangency portfolio calculated using the savings rate, and the efficient high mean portfolio is the portfolio maximizing the Sharpe ratio with respect to the borrowing rate.</p>
<p>To the left of the efficient low risk portfolio, the efficient portfolios are scaled-down versions of the efficient low risk portfolio with some savings. To the right of the efficient high mean portfolio, the efficient portfolios are scaled-up versions of the efficient high mean portfolio with some borrowing. Both cases are shown as blue lines in the figure. The third region is the portion of the efficient frontier between the efficient low risk and efficient high mean portfolios. These portfolios do not involve saving or borrowing. Investors with different preferences will choose to invest in different locations across these three regions, as discussed in the next section.</p>
<div class="cell" data-execution_count="3">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.graph_objects <span class="im">as</span> go</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>mn_stock <span class="op">=</span> <span class="dv">6</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>mn_bond  <span class="op">=</span> <span class="fl">3.5</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>sd_stock <span class="op">=</span> <span class="dv">15</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>sd_bond  <span class="op">=</span> <span class="fl">3.5</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>corr <span class="op">=</span> <span class="op">-</span><span class="dv">5</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>rs <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>extra <span class="op">=</span> <span class="fl">1.25</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> data(mn1, mn2, sd1, sd2, c, rs, extra):</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    c <span class="op">=</span> c <span class="op">/</span> <span class="dv">100</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    rb <span class="op">=</span> rs <span class="op">+</span> extra   </span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>    rs <span class="op">=</span> rs<span class="op">/</span><span class="dv">100</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>    rb <span class="op">=</span> rb<span class="op">/</span><span class="dv">100</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>    mns <span class="op">=</span> [mn1, mn2]</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>    sds <span class="op">=</span> [sd1, sd2]</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>    grid <span class="op">=</span> np.linspace(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">121</span>)</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># grid = np.linspace(-0.2, 2, 121)</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>    ports <span class="op">=</span> [np.array([w, <span class="dv">1</span> <span class="op">-</span> w]) <span class="cf">for</span> w <span class="kw">in</span> grid]</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>    means <span class="op">=</span> [p.T <span class="op">@</span> np.array(mns) <span class="cf">for</span> p <span class="kw">in</span> ports]</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.DataFrame(means)</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>    df.columns <span class="op">=</span> [<span class="st">"mean"</span>]</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>    cov <span class="op">=</span> np.array(</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>        [[sds[<span class="dv">0</span>] <span class="op">**</span> <span class="dv">2</span>, sds[<span class="dv">0</span>] <span class="op">*</span> sds[<span class="dv">1</span>] <span class="op">*</span> c], [sds[<span class="dv">0</span>] <span class="op">*</span> sds[<span class="dv">1</span>] <span class="op">*</span> c, sds[<span class="dv">1</span>] <span class="op">**</span> <span class="dv">2</span>]]</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>    ).reshape(<span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"stdev"</span>] <span class="op">=</span> [np.sqrt(p.T <span class="op">@</span> cov <span class="op">@</span> p) <span class="cf">for</span> p <span class="kw">in</span> ports]</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"wt1"</span>] <span class="op">=</span> grid</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"wt2"</span>] <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> df.wt1</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> col <span class="kw">in</span> [<span class="st">"mean"</span>, <span class="st">"stdev"</span>]:</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>        df[col] <span class="op">=</span> df[col] <span class="op">/</span> <span class="dv">100</span></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"sr_s"</span>]<span class="op">=</span> (df[<span class="st">"mean"</span>] <span class="op">-</span> rs)<span class="op">/</span>df[<span class="st">"stdev"</span>]</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"sr_b"</span>]<span class="op">=</span> (df[<span class="st">"mean"</span>] <span class="op">-</span> rb)<span class="op">/</span>df[<span class="st">"stdev"</span>]</span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> rf_plus_risky(mn, sd, rs, rb, w_min, w_max):</span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>    mn <span class="op">/=</span> <span class="dv">100</span></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>    sd <span class="op">/=</span> <span class="dv">100</span></span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>    rs <span class="op">/=</span> <span class="dv">100</span></span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>    rb <span class="op">/=</span> <span class="dv">100</span></span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>    grid <span class="op">=</span> np.linspace(w_min, w_max, <span class="dv">201</span>)</span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>    mns <span class="op">=</span> [(rs <span class="op">+</span> w <span class="op">*</span> (mn <span class="op">-</span> rs) <span class="cf">if</span> w <span class="op">&lt;=</span> <span class="dv">1</span> <span class="cf">else</span> rb <span class="op">+</span> w <span class="op">*</span> (mn <span class="op">-</span> rb)) <span class="cf">for</span> w <span class="kw">in</span> grid]</span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>    sds <span class="op">=</span> [w <span class="op">*</span> sd <span class="cf">for</span> w <span class="kw">in</span> grid]</span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>    srs <span class="op">=</span> (mn <span class="op">-</span> rs)<span class="op">/</span>sd</span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>    srb <span class="op">=</span> (mn <span class="op">-</span> rb)<span class="op">/</span>sd</span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> grid, mns, sds, srs, srb</span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> rf_plus_risky_nokink(mn, sd, rf, w_min, w_max):</span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a>    mn <span class="op">/=</span> <span class="dv">100</span></span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a>    sd <span class="op">/=</span> <span class="dv">100</span></span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a>    rf <span class="op">/=</span> <span class="dv">100</span></span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a>    grid <span class="op">=</span> np.linspace(w_min, w_max, <span class="dv">201</span>)</span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a>    mns <span class="op">=</span> [(rf <span class="op">+</span> w <span class="op">*</span> (mn <span class="op">-</span> rf)) <span class="cf">for</span> w <span class="kw">in</span> grid]</span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a>    sds <span class="op">=</span> [w <span class="op">*</span> sd <span class="cf">for</span> w <span class="kw">in</span> grid]</span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> grid, mns, sds</span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> figtbl(mn1, mn2, sd1, sd2, c, rs, extra, asset1_name, asset2_name):</span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> data(mn1, mn2, sd1, sd2, c, rs, extra)</span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Plot the portfolios of the two assets</span></span>
<span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a>    trace1 <span class="op">=</span> go.Scatter(</span>
<span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span>df[<span class="st">"stdev"</span>],</span>
<span id="cb2-69"><a href="#cb2-69" aria-hidden="true" tabindex="-1"></a>        y<span class="op">=</span>df[<span class="st">"mean"</span>],</span>
<span id="cb2-70"><a href="#cb2-70" aria-hidden="true" tabindex="-1"></a>        mode<span class="op">=</span><span class="st">"lines"</span>,</span>
<span id="cb2-71"><a href="#cb2-71" aria-hidden="true" tabindex="-1"></a>        <span class="co"># line={'color': green},</span></span>
<span id="cb2-72"><a href="#cb2-72" aria-hidden="true" tabindex="-1"></a>        text<span class="op">=</span><span class="dv">100</span> <span class="op">*</span> df[<span class="st">"wt1"</span>],</span>
<span id="cb2-73"><a href="#cb2-73" aria-hidden="true" tabindex="-1"></a>        customdata<span class="op">=</span><span class="dv">100</span> <span class="op">*</span> df[<span class="st">"wt2"</span>],</span>
<span id="cb2-74"><a href="#cb2-74" aria-hidden="true" tabindex="-1"></a>        hovertemplate<span class="op">=</span>asset1_name<span class="op">+</span><span class="st">": %</span><span class="sc">{text:.0f}</span><span class="st">%&lt;br&gt;"</span><span class="op">+</span>asset2_name<span class="op">+</span><span class="st">": %</span><span class="sc">{customdata:.0f}</span><span class="st">%&lt;extra&gt;&lt;/extra&gt;"</span>,</span>
<span id="cb2-75"><a href="#cb2-75" aria-hidden="true" tabindex="-1"></a>        line<span class="op">=</span><span class="bu">dict</span>(color<span class="op">=</span><span class="st">"black"</span>),</span>
<span id="cb2-76"><a href="#cb2-76" aria-hidden="true" tabindex="-1"></a>        name<span class="op">=</span><span class="st">"Stock &amp; Bond Frontier"</span></span>
<span id="cb2-77"><a href="#cb2-77" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb2-78"><a href="#cb2-78" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-79"><a href="#cb2-79" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plot the two assets</span></span>
<span id="cb2-80"><a href="#cb2-80" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df[df.wt1.isin([<span class="dv">0</span>, <span class="dv">1</span>])]</span>
<span id="cb2-81"><a href="#cb2-81" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"text"</span>] <span class="op">=</span> np.where(df.wt1 <span class="op">==</span> <span class="dv">1</span>, asset1_name, asset2_name)</span>
<span id="cb2-82"><a href="#cb2-82" aria-hidden="true" tabindex="-1"></a>    trace2a <span class="op">=</span> go.Scatter(</span>
<span id="cb2-83"><a href="#cb2-83" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span>df[df.wt1<span class="op">==</span><span class="dv">1</span>][<span class="st">"stdev"</span>],</span>
<span id="cb2-84"><a href="#cb2-84" aria-hidden="true" tabindex="-1"></a>        y<span class="op">=</span>df[df.wt1<span class="op">==</span><span class="dv">1</span>][<span class="st">"mean"</span>],</span>
<span id="cb2-85"><a href="#cb2-85" aria-hidden="true" tabindex="-1"></a>        mode<span class="op">=</span><span class="st">"markers"</span>,</span>
<span id="cb2-86"><a href="#cb2-86" aria-hidden="true" tabindex="-1"></a>        text<span class="op">=</span>df[df.wt1<span class="op">==</span><span class="dv">1</span>][<span class="st">"text"</span>],</span>
<span id="cb2-87"><a href="#cb2-87" aria-hidden="true" tabindex="-1"></a>        hovertemplate<span class="op">=</span><span class="st">"%</span><span class="sc">{text}</span><span class="st">&lt;extra&gt;&lt;/extra&gt;"</span>,</span>
<span id="cb2-88"><a href="#cb2-88" aria-hidden="true" tabindex="-1"></a>        marker<span class="op">=</span><span class="bu">dict</span>(size<span class="op">=</span><span class="dv">10</span>, color<span class="op">=</span><span class="st">"orange"</span>),</span>
<span id="cb2-89"><a href="#cb2-89" aria-hidden="true" tabindex="-1"></a>        name<span class="op">=</span>asset1_name</span>
<span id="cb2-90"><a href="#cb2-90" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb2-91"><a href="#cb2-91" aria-hidden="true" tabindex="-1"></a>    trace2b <span class="op">=</span> go.Scatter(</span>
<span id="cb2-92"><a href="#cb2-92" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span>df[df.wt1<span class="op">==</span><span class="dv">0</span>][<span class="st">"stdev"</span>],</span>
<span id="cb2-93"><a href="#cb2-93" aria-hidden="true" tabindex="-1"></a>        y<span class="op">=</span>df[df.wt1<span class="op">==</span><span class="dv">0</span>][<span class="st">"mean"</span>],</span>
<span id="cb2-94"><a href="#cb2-94" aria-hidden="true" tabindex="-1"></a>        mode<span class="op">=</span><span class="st">"markers"</span>,</span>
<span id="cb2-95"><a href="#cb2-95" aria-hidden="true" tabindex="-1"></a>        text<span class="op">=</span>df[df.wt1<span class="op">==</span><span class="dv">0</span>][<span class="st">"text"</span>],</span>
<span id="cb2-96"><a href="#cb2-96" aria-hidden="true" tabindex="-1"></a>        hovertemplate<span class="op">=</span><span class="st">"%</span><span class="sc">{text}</span><span class="st">&lt;extra&gt;&lt;/extra&gt;"</span>,</span>
<span id="cb2-97"><a href="#cb2-97" aria-hidden="true" tabindex="-1"></a>        marker<span class="op">=</span><span class="bu">dict</span>(size<span class="op">=</span><span class="dv">10</span>, color<span class="op">=</span><span class="st">"red"</span>),</span>
<span id="cb2-98"><a href="#cb2-98" aria-hidden="true" tabindex="-1"></a>        name<span class="op">=</span>asset2_name</span>
<span id="cb2-99"><a href="#cb2-99" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb2-100"><a href="#cb2-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-101"><a href="#cb2-101" aria-hidden="true" tabindex="-1"></a>    fig <span class="op">=</span> go.Figure()</span>
<span id="cb2-102"><a href="#cb2-102" aria-hidden="true" tabindex="-1"></a>    fig.add_trace(trace2a)</span>
<span id="cb2-103"><a href="#cb2-103" aria-hidden="true" tabindex="-1"></a>    fig.add_trace(trace2b)</span>
<span id="cb2-104"><a href="#cb2-104" aria-hidden="true" tabindex="-1"></a>    fig.add_trace(trace1)</span>
<span id="cb2-105"><a href="#cb2-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-106"><a href="#cb2-106" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plot the combination of the risk-free and each asset (CAL for each asset)</span></span>
<span id="cb2-107"><a href="#cb2-107" aria-hidden="true" tabindex="-1"></a>    grid, mns_cal, sds_cal, srs_cal, srb_cal <span class="op">=</span> rf_plus_risky(mn1, sd1, rs, rs <span class="op">+</span> extra, <span class="dv">0</span>, <span class="fl">1.0</span>)</span>
<span id="cb2-108"><a href="#cb2-108" aria-hidden="true" tabindex="-1"></a>    string <span class="op">=</span> <span class="st">"wealth in "</span><span class="op">+</span>asset1_name<span class="op">+</span><span class="st">"= %</span><span class="sc">{text:.0f}</span><span class="st">%&lt;br&gt;"</span> <span class="op">+</span> <span class="st">"Sharpe ratio: "</span> <span class="op">+</span> <span class="st">"</span><span class="sc">{:.4f}</span><span class="st">"</span>.<span class="bu">format</span>(srs_cal) <span class="op">+</span><span class="st">"&lt;extra&gt;&lt;/extra&gt;"</span></span>
<span id="cb2-109"><a href="#cb2-109" aria-hidden="true" tabindex="-1"></a>    trace3 <span class="op">=</span> go.Scatter(</span>
<span id="cb2-110"><a href="#cb2-110" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span>sds_cal, </span>
<span id="cb2-111"><a href="#cb2-111" aria-hidden="true" tabindex="-1"></a>        y<span class="op">=</span>mns_cal, </span>
<span id="cb2-112"><a href="#cb2-112" aria-hidden="true" tabindex="-1"></a>        mode<span class="op">=</span><span class="st">"lines"</span>, </span>
<span id="cb2-113"><a href="#cb2-113" aria-hidden="true" tabindex="-1"></a>        text<span class="op">=</span><span class="dv">100</span> <span class="op">*</span> grid, </span>
<span id="cb2-114"><a href="#cb2-114" aria-hidden="true" tabindex="-1"></a>        hovertemplate<span class="op">=</span>string, </span>
<span id="cb2-115"><a href="#cb2-115" aria-hidden="true" tabindex="-1"></a>        line<span class="op">=</span><span class="bu">dict</span>(color<span class="op">=</span><span class="st">"orange"</span>),</span>
<span id="cb2-116"><a href="#cb2-116" aria-hidden="true" tabindex="-1"></a>        name<span class="op">=</span><span class="st">"CAL: "</span><span class="op">+</span>asset1_name</span>
<span id="cb2-117"><a href="#cb2-117" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb2-118"><a href="#cb2-118" aria-hidden="true" tabindex="-1"></a>    grid, mns_cal, sds_cal, srs_cal, srb_cal <span class="op">=</span> rf_plus_risky(mn2, sd2, rs, rs <span class="op">+</span> extra, <span class="dv">0</span>, <span class="fl">1.0</span>)</span>
<span id="cb2-119"><a href="#cb2-119" aria-hidden="true" tabindex="-1"></a>    string <span class="op">=</span> <span class="st">"wealth in "</span><span class="op">+</span>asset2_name<span class="op">+</span><span class="st">"= %</span><span class="sc">{text:.0f}</span><span class="st">%&lt;br&gt;"</span> <span class="op">+</span> <span class="st">"Sharpe ratio : "</span> <span class="op">+</span> <span class="st">"</span><span class="sc">{:.4f}</span><span class="st">"</span>.<span class="bu">format</span>(srs_cal) <span class="op">+</span><span class="st">"&lt;extra&gt;&lt;/extra&gt;"</span></span>
<span id="cb2-120"><a href="#cb2-120" aria-hidden="true" tabindex="-1"></a>    trace4 <span class="op">=</span> go.Scatter(</span>
<span id="cb2-121"><a href="#cb2-121" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span>sds_cal, </span>
<span id="cb2-122"><a href="#cb2-122" aria-hidden="true" tabindex="-1"></a>        y<span class="op">=</span>mns_cal, </span>
<span id="cb2-123"><a href="#cb2-123" aria-hidden="true" tabindex="-1"></a>        mode<span class="op">=</span><span class="st">"lines"</span>, </span>
<span id="cb2-124"><a href="#cb2-124" aria-hidden="true" tabindex="-1"></a>        text<span class="op">=</span><span class="dv">100</span> <span class="op">*</span> grid, </span>
<span id="cb2-125"><a href="#cb2-125" aria-hidden="true" tabindex="-1"></a>        hovertemplate<span class="op">=</span>string, </span>
<span id="cb2-126"><a href="#cb2-126" aria-hidden="true" tabindex="-1"></a>        line<span class="op">=</span><span class="bu">dict</span>(color<span class="op">=</span><span class="st">"red"</span>),</span>
<span id="cb2-127"><a href="#cb2-127" aria-hidden="true" tabindex="-1"></a>        name<span class="op">=</span><span class="st">"CAL: "</span><span class="op">+</span>asset2_name</span>
<span id="cb2-128"><a href="#cb2-128" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb2-129"><a href="#cb2-129" aria-hidden="true" tabindex="-1"></a>    <span class="co"># fig.add_trace(trace3)</span></span>
<span id="cb2-130"><a href="#cb2-130" aria-hidden="true" tabindex="-1"></a>    <span class="co"># fig.add_trace(trace4)  </span></span>
<span id="cb2-131"><a href="#cb2-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-132"><a href="#cb2-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-133"><a href="#cb2-133" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> custom(string, ports,srTang,borrow_flag):</span>
<span id="cb2-134"><a href="#cb2-134" aria-hidden="true" tabindex="-1"></a>        <span class="co"># borrow_flag=1 adds statement about "relative to borrowing rate"</span></span>
<span id="cb2-135"><a href="#cb2-135" aria-hidden="true" tabindex="-1"></a>        cd <span class="op">=</span> np.empty(shape<span class="op">=</span>(<span class="bu">len</span>(ports), N<span class="op">+</span><span class="dv">1</span>, <span class="dv">1</span>), dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb2-136"><a href="#cb2-136" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(N):</span>
<span id="cb2-137"><a href="#cb2-137" aria-hidden="true" tabindex="-1"></a>            cd[:, i] <span class="op">=</span> np.array([w[i] <span class="cf">for</span> w <span class="kw">in</span> ports]).reshape(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb2-138"><a href="#cb2-138" aria-hidden="true" tabindex="-1"></a>        cd[:,N] <span class="op">=</span> np.<span class="bu">round</span>(srTang,<span class="dv">4</span>)</span>
<span id="cb2-139"><a href="#cb2-139" aria-hidden="true" tabindex="-1"></a>        <span class="co"># print(cd)</span></span>
<span id="cb2-140"><a href="#cb2-140" aria-hidden="true" tabindex="-1"></a>        string <span class="op">+=</span> <span class="st">"&lt;br&gt;"</span></span>
<span id="cb2-141"><a href="#cb2-141" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(N):</span>
<span id="cb2-142"><a href="#cb2-142" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> i <span class="op">==</span><span class="dv">0</span>:</span>
<span id="cb2-143"><a href="#cb2-143" aria-hidden="true" tabindex="-1"></a>                string <span class="op">+=</span> asset1_name</span>
<span id="cb2-144"><a href="#cb2-144" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> i<span class="op">==</span><span class="dv">1</span>:</span>
<span id="cb2-145"><a href="#cb2-145" aria-hidden="true" tabindex="-1"></a>                string <span class="op">+=</span> asset2_name</span>
<span id="cb2-146"><a href="#cb2-146" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb2-147"><a href="#cb2-147" aria-hidden="true" tabindex="-1"></a>                string <span class="op">+=</span> <span class="st">"asset "</span> <span class="op">+</span> <span class="bu">str</span>(i <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb2-148"><a href="#cb2-148" aria-hidden="true" tabindex="-1"></a>            string <span class="op">+=</span> <span class="st">": %{customdata["</span></span>
<span id="cb2-149"><a href="#cb2-149" aria-hidden="true" tabindex="-1"></a>            string <span class="op">+=</span> <span class="bu">str</span>(i)</span>
<span id="cb2-150"><a href="#cb2-150" aria-hidden="true" tabindex="-1"></a>            string <span class="op">+=</span> <span class="st">"]:.1%}&lt;br&gt;"</span></span>
<span id="cb2-151"><a href="#cb2-151" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> borrow_flag<span class="op">==</span><span class="dv">1</span>:</span>
<span id="cb2-152"><a href="#cb2-152" aria-hidden="true" tabindex="-1"></a>            string <span class="op">+=</span> <span class="st">"Sharpe ratio (relative to borrowing rate): %{customdata["</span> <span class="op">+</span>  <span class="bu">str</span>(N) <span class="op">+</span> <span class="st">"]:.4f}&lt;br&gt;"</span>    </span>
<span id="cb2-153"><a href="#cb2-153" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb2-154"><a href="#cb2-154" aria-hidden="true" tabindex="-1"></a>            string <span class="op">+=</span> <span class="st">"Sharpe ratio: %{customdata["</span> <span class="op">+</span>  <span class="bu">str</span>(N) <span class="op">+</span> <span class="st">"]:.4f}&lt;br&gt;"</span></span>
<span id="cb2-155"><a href="#cb2-155" aria-hidden="true" tabindex="-1"></a>        string <span class="op">+=</span> <span class="st">"&lt;extra&gt;&lt;/extra&gt;"</span></span>
<span id="cb2-156"><a href="#cb2-156" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> string, cd  </span>
<span id="cb2-157"><a href="#cb2-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-158"><a href="#cb2-158" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plot the tangency portfolios</span></span>
<span id="cb2-159"><a href="#cb2-159" aria-hidden="true" tabindex="-1"></a>    c <span class="op">=</span> c <span class="op">/</span> <span class="dv">100</span></span>
<span id="cb2-160"><a href="#cb2-160" aria-hidden="true" tabindex="-1"></a>    rb <span class="op">=</span> rs <span class="op">+</span> extra     </span>
<span id="cb2-161"><a href="#cb2-161" aria-hidden="true" tabindex="-1"></a>    rs <span class="op">=</span> rs<span class="op">/</span><span class="dv">100</span></span>
<span id="cb2-162"><a href="#cb2-162" aria-hidden="true" tabindex="-1"></a>    rb <span class="op">=</span> rb<span class="op">/</span><span class="dv">100</span></span>
<span id="cb2-163"><a href="#cb2-163" aria-hidden="true" tabindex="-1"></a>    mns <span class="op">=</span> [mn1, mn2]</span>
<span id="cb2-164"><a href="#cb2-164" aria-hidden="true" tabindex="-1"></a>    mns <span class="op">=</span> np.array(mns) <span class="op">/</span> <span class="dv">100</span></span>
<span id="cb2-165"><a href="#cb2-165" aria-hidden="true" tabindex="-1"></a>    sds <span class="op">=</span> [sd1, sd2]</span>
<span id="cb2-166"><a href="#cb2-166" aria-hidden="true" tabindex="-1"></a>    sds <span class="op">=</span> np.array(sds) <span class="op">/</span> <span class="dv">100</span></span>
<span id="cb2-167"><a href="#cb2-167" aria-hidden="true" tabindex="-1"></a>    cov <span class="op">=</span> np.array(</span>
<span id="cb2-168"><a href="#cb2-168" aria-hidden="true" tabindex="-1"></a>        [[sds[<span class="dv">0</span>] <span class="op">**</span> <span class="dv">2</span>, sds[<span class="dv">0</span>] <span class="op">*</span> sds[<span class="dv">1</span>] <span class="op">*</span> c], [sds[<span class="dv">0</span>] <span class="op">*</span> sds[<span class="dv">1</span>] <span class="op">*</span> c, sds[<span class="dv">1</span>] <span class="op">**</span> <span class="dv">2</span>]]</span>
<span id="cb2-169"><a href="#cb2-169" aria-hidden="true" tabindex="-1"></a>    ).reshape(<span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb2-170"><a href="#cb2-170" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-171"><a href="#cb2-171" aria-hidden="true" tabindex="-1"></a>    Shorts <span class="op">=</span> <span class="va">True</span>     </span>
<span id="cb2-172"><a href="#cb2-172" aria-hidden="true" tabindex="-1"></a>    N <span class="op">=</span> <span class="bu">len</span>(mns)</span>
<span id="cb2-173"><a href="#cb2-173" aria-hidden="true" tabindex="-1"></a>    P <span class="op">=</span> portfolio(mns, cov, Shorts)    </span>
<span id="cb2-174"><a href="#cb2-174" aria-hidden="true" tabindex="-1"></a>    gmv <span class="op">=</span> P.GMV <span class="op">@</span> mns</span>
<span id="cb2-175"><a href="#cb2-175" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print('GMV return is: ',gmv)</span></span>
<span id="cb2-176"><a href="#cb2-176" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (rs <span class="op">&lt;</span> gmv) <span class="kw">or</span> (<span class="kw">not</span> Shorts):</span>
<span id="cb2-177"><a href="#cb2-177" aria-hidden="true" tabindex="-1"></a>        portTang <span class="op">=</span> P.tangency(rs)</span>
<span id="cb2-178"><a href="#cb2-178" aria-hidden="true" tabindex="-1"></a>        mnTang <span class="op">=</span> portTang <span class="op">@</span> mns</span>
<span id="cb2-179"><a href="#cb2-179" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> mnTang <span class="op">&lt;</span> np.<span class="bu">max</span>(mns):</span>
<span id="cb2-180"><a href="#cb2-180" aria-hidden="true" tabindex="-1"></a>            sdTang <span class="op">=</span> np.sqrt(portTang <span class="op">@</span> cov <span class="op">@</span> portTang)</span>
<span id="cb2-181"><a href="#cb2-181" aria-hidden="true" tabindex="-1"></a>            srTang <span class="op">=</span> (mnTang <span class="op">-</span> rs)<span class="op">/</span>sdTang</span>
<span id="cb2-182"><a href="#cb2-182" aria-hidden="true" tabindex="-1"></a>            string0 <span class="op">=</span> <span class="st">'tangency portfolio'</span> <span class="cf">if</span> rb <span class="op">==</span> rs <span class="cf">else</span> <span class="st">'efficient low risk'</span> <span class="cf">if</span> rb <span class="op">!=</span> rs <span class="cf">else</span> <span class="st">'tangency portfolio'</span></span>
<span id="cb2-183"><a href="#cb2-183" aria-hidden="true" tabindex="-1"></a>            string, cd <span class="op">=</span> custom(string0, [portTang], srTang,<span class="dv">0</span>)</span>
<span id="cb2-184"><a href="#cb2-184" aria-hidden="true" tabindex="-1"></a>            trace <span class="op">=</span> go.Scatter(</span>
<span id="cb2-185"><a href="#cb2-185" aria-hidden="true" tabindex="-1"></a>                x<span class="op">=</span>[sdTang],</span>
<span id="cb2-186"><a href="#cb2-186" aria-hidden="true" tabindex="-1"></a>                y<span class="op">=</span>[mnTang],</span>
<span id="cb2-187"><a href="#cb2-187" aria-hidden="true" tabindex="-1"></a>                mode<span class="op">=</span><span class="st">"markers"</span>,</span>
<span id="cb2-188"><a href="#cb2-188" aria-hidden="true" tabindex="-1"></a>                customdata<span class="op">=</span>cd,</span>
<span id="cb2-189"><a href="#cb2-189" aria-hidden="true" tabindex="-1"></a>                hovertemplate<span class="op">=</span>string,</span>
<span id="cb2-190"><a href="#cb2-190" aria-hidden="true" tabindex="-1"></a>                marker<span class="op">=</span><span class="bu">dict</span>(size<span class="op">=</span><span class="dv">10</span>, color<span class="op">=</span><span class="st">"blue"</span>),</span>
<span id="cb2-191"><a href="#cb2-191" aria-hidden="true" tabindex="-1"></a>                name<span class="op">=</span>string0</span>
<span id="cb2-192"><a href="#cb2-192" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb2-193"><a href="#cb2-193" aria-hidden="true" tabindex="-1"></a>            fig.add_trace(trace)</span>
<span id="cb2-194"><a href="#cb2-194" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb2-195"><a href="#cb2-195" aria-hidden="true" tabindex="-1"></a>            <span class="co">#Plot CAL (no leverage)</span></span>
<span id="cb2-196"><a href="#cb2-196" aria-hidden="true" tabindex="-1"></a>            grid, mns_cal, sds_cal <span class="op">=</span> rf_plus_risky_nokink(mnTang<span class="op">*</span><span class="dv">100</span>, sdTang<span class="op">*</span><span class="dv">100</span>, rs<span class="op">*</span><span class="dv">100</span>,<span class="dv">0</span>, <span class="fl">1.0</span>)</span>
<span id="cb2-197"><a href="#cb2-197" aria-hidden="true" tabindex="-1"></a>            portlabel <span class="op">=</span> <span class="st">'tangency portfolio'</span> <span class="cf">if</span> rb <span class="op">==</span> rs <span class="cf">else</span> <span class="st">'efficient low risk'</span> <span class="cf">if</span> rb <span class="op">!=</span> rs <span class="cf">else</span> <span class="st">'tangency portfolio'</span></span>
<span id="cb2-198"><a href="#cb2-198" aria-hidden="true" tabindex="-1"></a>            string <span class="op">=</span> <span class="st">"wealth in "</span><span class="op">+</span>portlabel <span class="op">+</span> <span class="st">" = %</span><span class="sc">{text:.0f}</span><span class="st">%&lt;br&gt;"</span> <span class="op">+</span> <span class="st">"Sharpe ratio: "</span> <span class="op">+</span>  <span class="st">"</span><span class="sc">{:.4f}</span><span class="st">"</span>.<span class="bu">format</span>(srTang) <span class="op">+</span><span class="st">"&lt;extra&gt;&lt;/extra&gt;"</span></span>
<span id="cb2-199"><a href="#cb2-199" aria-hidden="true" tabindex="-1"></a>            trace5 <span class="op">=</span> go.Scatter(</span>
<span id="cb2-200"><a href="#cb2-200" aria-hidden="true" tabindex="-1"></a>                x<span class="op">=</span>sds_cal, </span>
<span id="cb2-201"><a href="#cb2-201" aria-hidden="true" tabindex="-1"></a>                y<span class="op">=</span>mns_cal, </span>
<span id="cb2-202"><a href="#cb2-202" aria-hidden="true" tabindex="-1"></a>                mode<span class="op">=</span><span class="st">"lines"</span>, </span>
<span id="cb2-203"><a href="#cb2-203" aria-hidden="true" tabindex="-1"></a>                text<span class="op">=</span><span class="dv">100</span> <span class="op">*</span> grid, </span>
<span id="cb2-204"><a href="#cb2-204" aria-hidden="true" tabindex="-1"></a>                hovertemplate<span class="op">=</span>string, </span>
<span id="cb2-205"><a href="#cb2-205" aria-hidden="true" tabindex="-1"></a>                line<span class="op">=</span><span class="bu">dict</span>(color<span class="op">=</span><span class="st">"blue"</span>),</span>
<span id="cb2-206"><a href="#cb2-206" aria-hidden="true" tabindex="-1"></a>                name<span class="op">=</span><span class="st">"CAL: "</span> <span class="op">+</span> portlabel</span>
<span id="cb2-207"><a href="#cb2-207" aria-hidden="true" tabindex="-1"></a>            )           </span>
<span id="cb2-208"><a href="#cb2-208" aria-hidden="true" tabindex="-1"></a>            fig.add_trace(trace5)</span>
<span id="cb2-209"><a href="#cb2-209" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb2-210"><a href="#cb2-210" aria-hidden="true" tabindex="-1"></a>            <span class="co">#Plot CAL (with leverage)</span></span>
<span id="cb2-211"><a href="#cb2-211" aria-hidden="true" tabindex="-1"></a>            grid, mns_cal, sds_cal <span class="op">=</span> rf_plus_risky_nokink(mnTang<span class="op">*</span><span class="dv">100</span>, sdTang<span class="op">*</span><span class="dv">100</span>, rs<span class="op">*</span><span class="dv">100</span>,<span class="fl">1.0</span>, <span class="fl">1.5</span>)</span>
<span id="cb2-212"><a href="#cb2-212" aria-hidden="true" tabindex="-1"></a>            trace5a <span class="op">=</span> go.Scatter(</span>
<span id="cb2-213"><a href="#cb2-213" aria-hidden="true" tabindex="-1"></a>                x<span class="op">=</span>sds_cal, </span>
<span id="cb2-214"><a href="#cb2-214" aria-hidden="true" tabindex="-1"></a>                y<span class="op">=</span>mns_cal, </span>
<span id="cb2-215"><a href="#cb2-215" aria-hidden="true" tabindex="-1"></a>                mode<span class="op">=</span><span class="st">"lines"</span>, </span>
<span id="cb2-216"><a href="#cb2-216" aria-hidden="true" tabindex="-1"></a>                text<span class="op">=</span><span class="dv">100</span> <span class="op">*</span> grid, </span>
<span id="cb2-217"><a href="#cb2-217" aria-hidden="true" tabindex="-1"></a>                hovertemplate<span class="op">=</span>string, </span>
<span id="cb2-218"><a href="#cb2-218" aria-hidden="true" tabindex="-1"></a>                line<span class="op">=</span><span class="bu">dict</span>(color<span class="op">=</span><span class="st">"blue"</span>,dash<span class="op">=</span><span class="st">'dot'</span>),</span>
<span id="cb2-219"><a href="#cb2-219" aria-hidden="true" tabindex="-1"></a>                name<span class="op">=</span><span class="st">"CAL: "</span>  <span class="op">+</span> portlabel <span class="op">+</span> <span class="st">" (levered)"</span></span>
<span id="cb2-220"><a href="#cb2-220" aria-hidden="true" tabindex="-1"></a>                <span class="co"># showlegend=False</span></span>
<span id="cb2-221"><a href="#cb2-221" aria-hidden="true" tabindex="-1"></a>            )           </span>
<span id="cb2-222"><a href="#cb2-222" aria-hidden="true" tabindex="-1"></a>            <span class="co"># fig.add_trace(trace5a)         </span></span>
<span id="cb2-223"><a href="#cb2-223" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb2-224"><a href="#cb2-224" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb2-225"><a href="#cb2-225" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb2-226"><a href="#cb2-226" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb2-227"><a href="#cb2-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-228"><a href="#cb2-228" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (rb <span class="op">!=</span> rs) <span class="kw">and</span> ((gmv <span class="op">&gt;</span> rb) <span class="kw">or</span> (<span class="kw">not</span> Shorts)):</span>
<span id="cb2-229"><a href="#cb2-229" aria-hidden="true" tabindex="-1"></a>        portTang <span class="op">=</span> P.tangency(rb)</span>
<span id="cb2-230"><a href="#cb2-230" aria-hidden="true" tabindex="-1"></a>        mnTang <span class="op">=</span> portTang <span class="op">@</span> mns</span>
<span id="cb2-231"><a href="#cb2-231" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> mnTang <span class="op">&lt;</span> np.<span class="bu">max</span>(mns):</span>
<span id="cb2-232"><a href="#cb2-232" aria-hidden="true" tabindex="-1"></a>            sdTang <span class="op">=</span> np.sqrt(portTang <span class="op">@</span> cov <span class="op">@</span> portTang)</span>
<span id="cb2-233"><a href="#cb2-233" aria-hidden="true" tabindex="-1"></a>            srTang <span class="op">=</span> (mnTang <span class="op">-</span> rb)<span class="op">/</span>sdTang</span>
<span id="cb2-234"><a href="#cb2-234" aria-hidden="true" tabindex="-1"></a>            string <span class="op">=</span> <span class="st">'efficient high mean portfolio'</span></span>
<span id="cb2-235"><a href="#cb2-235" aria-hidden="true" tabindex="-1"></a>            string, cd <span class="op">=</span> custom(string, [portTang], srTang,<span class="dv">1</span>)</span>
<span id="cb2-236"><a href="#cb2-236" aria-hidden="true" tabindex="-1"></a>            trace <span class="op">=</span> go.Scatter(</span>
<span id="cb2-237"><a href="#cb2-237" aria-hidden="true" tabindex="-1"></a>                x<span class="op">=</span>[sdTang],</span>
<span id="cb2-238"><a href="#cb2-238" aria-hidden="true" tabindex="-1"></a>                y<span class="op">=</span>[mnTang],</span>
<span id="cb2-239"><a href="#cb2-239" aria-hidden="true" tabindex="-1"></a>                mode<span class="op">=</span><span class="st">"markers"</span>,</span>
<span id="cb2-240"><a href="#cb2-240" aria-hidden="true" tabindex="-1"></a>                customdata<span class="op">=</span>cd,</span>
<span id="cb2-241"><a href="#cb2-241" aria-hidden="true" tabindex="-1"></a>                hovertemplate<span class="op">=</span>string,</span>
<span id="cb2-242"><a href="#cb2-242" aria-hidden="true" tabindex="-1"></a>                marker<span class="op">=</span><span class="bu">dict</span>(size<span class="op">=</span><span class="dv">10</span>, color<span class="op">=</span><span class="st">"blue"</span>),</span>
<span id="cb2-243"><a href="#cb2-243" aria-hidden="true" tabindex="-1"></a>                name<span class="op">=</span><span class="st">"efficient high mean portfolio"</span></span>
<span id="cb2-244"><a href="#cb2-244" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb2-245"><a href="#cb2-245" aria-hidden="true" tabindex="-1"></a>            fig.add_trace(trace)</span>
<span id="cb2-246"><a href="#cb2-246" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb2-247"><a href="#cb2-247" aria-hidden="true" tabindex="-1"></a>            <span class="co">#Plot CAL (with leverage)            </span></span>
<span id="cb2-248"><a href="#cb2-248" aria-hidden="true" tabindex="-1"></a>            grid, mns_cal, sds_cal <span class="op">=</span> rf_plus_risky_nokink(mnTang<span class="op">*</span><span class="dv">100</span>, sdTang<span class="op">*</span><span class="dv">100</span>, rb<span class="op">*</span><span class="dv">100</span>, <span class="fl">1.0</span>, <span class="fl">3.0</span>)</span>
<span id="cb2-249"><a href="#cb2-249" aria-hidden="true" tabindex="-1"></a>            string <span class="op">=</span> <span class="st">"wealth in efficient high mean = %</span><span class="sc">{text:.0f}</span><span class="st">%&lt;br&gt;"</span> <span class="op">+</span> <span class="st">"Sharpe ratio (relative to borrowing rate): "</span> <span class="op">+</span> <span class="st">"</span><span class="sc">{:.4f}</span><span class="st">"</span>.<span class="bu">format</span>(srTang) <span class="op">+</span><span class="st">"&lt;extra&gt;&lt;/extra&gt;"</span></span>
<span id="cb2-250"><a href="#cb2-250" aria-hidden="true" tabindex="-1"></a>            trace6 <span class="op">=</span> go.Scatter(</span>
<span id="cb2-251"><a href="#cb2-251" aria-hidden="true" tabindex="-1"></a>                x<span class="op">=</span>sds_cal, </span>
<span id="cb2-252"><a href="#cb2-252" aria-hidden="true" tabindex="-1"></a>                y<span class="op">=</span>mns_cal, </span>
<span id="cb2-253"><a href="#cb2-253" aria-hidden="true" tabindex="-1"></a>                mode<span class="op">=</span><span class="st">"lines"</span>, </span>
<span id="cb2-254"><a href="#cb2-254" aria-hidden="true" tabindex="-1"></a>                text<span class="op">=</span><span class="dv">100</span> <span class="op">*</span> grid, </span>
<span id="cb2-255"><a href="#cb2-255" aria-hidden="true" tabindex="-1"></a>                hovertemplate<span class="op">=</span>string,</span>
<span id="cb2-256"><a href="#cb2-256" aria-hidden="true" tabindex="-1"></a>                line<span class="op">=</span><span class="bu">dict</span>(color<span class="op">=</span><span class="st">"blue"</span>),</span>
<span id="cb2-257"><a href="#cb2-257" aria-hidden="true" tabindex="-1"></a>                name <span class="op">=</span> <span class="st">"CAL: efficient high mean"</span></span>
<span id="cb2-258"><a href="#cb2-258" aria-hidden="true" tabindex="-1"></a>            )           </span>
<span id="cb2-259"><a href="#cb2-259" aria-hidden="true" tabindex="-1"></a>            fig.add_trace(trace6)   </span>
<span id="cb2-260"><a href="#cb2-260" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb2-261"><a href="#cb2-261" aria-hidden="true" tabindex="-1"></a>            <span class="co">#Plot CAL (without leverage) </span></span>
<span id="cb2-262"><a href="#cb2-262" aria-hidden="true" tabindex="-1"></a>            grid, mns_cal, sds_cal <span class="op">=</span> rf_plus_risky_nokink(mnTang<span class="op">*</span><span class="dv">100</span>, sdTang<span class="op">*</span><span class="dv">100</span>, rb<span class="op">*</span><span class="dv">100</span>, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb2-263"><a href="#cb2-263" aria-hidden="true" tabindex="-1"></a>            trace6a <span class="op">=</span> go.Scatter(</span>
<span id="cb2-264"><a href="#cb2-264" aria-hidden="true" tabindex="-1"></a>                x<span class="op">=</span>sds_cal, </span>
<span id="cb2-265"><a href="#cb2-265" aria-hidden="true" tabindex="-1"></a>                y<span class="op">=</span>mns_cal, </span>
<span id="cb2-266"><a href="#cb2-266" aria-hidden="true" tabindex="-1"></a>                mode<span class="op">=</span><span class="st">"lines"</span>, </span>
<span id="cb2-267"><a href="#cb2-267" aria-hidden="true" tabindex="-1"></a>                text<span class="op">=</span><span class="dv">100</span> <span class="op">*</span> grid, </span>
<span id="cb2-268"><a href="#cb2-268" aria-hidden="true" tabindex="-1"></a>                hovertemplate<span class="op">=</span>string, </span>
<span id="cb2-269"><a href="#cb2-269" aria-hidden="true" tabindex="-1"></a>                line<span class="op">=</span><span class="bu">dict</span>(color<span class="op">=</span><span class="st">"blue"</span>, dash<span class="op">=</span><span class="st">'dot'</span>),</span>
<span id="cb2-270"><a href="#cb2-270" aria-hidden="true" tabindex="-1"></a>                name <span class="op">=</span> <span class="st">"CAL: efficient high mean (unlevered)"</span></span>
<span id="cb2-271"><a href="#cb2-271" aria-hidden="true" tabindex="-1"></a>            )           </span>
<span id="cb2-272"><a href="#cb2-272" aria-hidden="true" tabindex="-1"></a>            <span class="co"># fig.add_trace(trace6a)      </span></span>
<span id="cb2-273"><a href="#cb2-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-274"><a href="#cb2-274" aria-hidden="true" tabindex="-1"></a>    string <span class="op">=</span> <span class="st">"Saving rate&lt;extra&gt;&lt;/extra&gt;"</span></span>
<span id="cb2-275"><a href="#cb2-275" aria-hidden="true" tabindex="-1"></a>    trace7 <span class="op">=</span> go.Scatter(</span>
<span id="cb2-276"><a href="#cb2-276" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span>[<span class="dv">0</span>], y<span class="op">=</span>[rs], mode<span class="op">=</span><span class="st">"markers"</span>, hovertemplate<span class="op">=</span>string, marker<span class="op">=</span><span class="bu">dict</span>(size<span class="op">=</span><span class="dv">10</span>, color<span class="op">=</span><span class="st">"black"</span>), name<span class="op">=</span><span class="st">'Risk-free (Saving)'</span></span>
<span id="cb2-277"><a href="#cb2-277" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb2-278"><a href="#cb2-278" aria-hidden="true" tabindex="-1"></a>    fig.add_trace(trace7)     </span>
<span id="cb2-279"><a href="#cb2-279" aria-hidden="true" tabindex="-1"></a>    string <span class="op">=</span> <span class="st">"Borrowing rate&lt;extra&gt;&lt;/extra&gt;"</span></span>
<span id="cb2-280"><a href="#cb2-280" aria-hidden="true" tabindex="-1"></a>    trace8 <span class="op">=</span> go.Scatter(</span>
<span id="cb2-281"><a href="#cb2-281" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span>[<span class="dv">0</span>], y<span class="op">=</span>[rb], mode<span class="op">=</span><span class="st">"markers"</span>, hovertemplate<span class="op">=</span>string, marker<span class="op">=</span><span class="bu">dict</span>(size<span class="op">=</span><span class="dv">10</span>, color<span class="op">=</span><span class="st">"DarkGrey"</span>), name<span class="op">=</span><span class="st">'Risk-free (Borrowing)'</span></span>
<span id="cb2-282"><a href="#cb2-282" aria-hidden="true" tabindex="-1"></a>    )  </span>
<span id="cb2-283"><a href="#cb2-283" aria-hidden="true" tabindex="-1"></a>    fig.add_trace(trace8)   </span>
<span id="cb2-284"><a href="#cb2-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-285"><a href="#cb2-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-286"><a href="#cb2-286" aria-hidden="true" tabindex="-1"></a>    fig.layout.xaxis[<span class="st">"title"</span>] <span class="op">=</span> <span class="st">"Standard Deviation"</span></span>
<span id="cb2-287"><a href="#cb2-287" aria-hidden="true" tabindex="-1"></a>    fig.layout.yaxis[<span class="st">"title"</span>] <span class="op">=</span> <span class="st">"Expected Return"</span></span>
<span id="cb2-288"><a href="#cb2-288" aria-hidden="true" tabindex="-1"></a>    fig.update_xaxes(<span class="bu">range</span><span class="op">=</span>[<span class="op">-</span><span class="fl">0.005</span>, <span class="fl">1.25</span> <span class="op">*</span> df[<span class="st">"stdev"</span>].<span class="bu">max</span>()])</span>
<span id="cb2-289"><a href="#cb2-289" aria-hidden="true" tabindex="-1"></a>    fig.update_yaxes(<span class="bu">range</span><span class="op">=</span>[<span class="dv">0</span>, <span class="fl">1.15</span> <span class="op">*</span> df[<span class="st">"mean"</span>].<span class="bu">max</span>()])</span>
<span id="cb2-290"><a href="#cb2-290" aria-hidden="true" tabindex="-1"></a>    fig.update_yaxes(tickformat<span class="op">=</span><span class="st">".0%"</span>)</span>
<span id="cb2-291"><a href="#cb2-291" aria-hidden="true" tabindex="-1"></a>    fig.update_xaxes(tickformat<span class="op">=</span><span class="st">".0%"</span>)</span>
<span id="cb2-292"><a href="#cb2-292" aria-hidden="true" tabindex="-1"></a>    fig.update_layout(legend<span class="op">=</span><span class="bu">dict</span>(yanchor<span class="op">=</span><span class="st">"top"</span>, y <span class="op">=</span><span class="fl">0.65</span>, xanchor<span class="op">=</span><span class="st">"left"</span>, x<span class="op">=</span><span class="fl">0.535</span>))</span>
<span id="cb2-293"><a href="#cb2-293" aria-hidden="true" tabindex="-1"></a>    fig.show()</span>
<span id="cb2-294"><a href="#cb2-294" aria-hidden="true" tabindex="-1"></a>figtbl(mn_stock,mn_bond,sd_stock,sd_bond,corr,rs,extra,<span class="st">"Stock"</span>,<span class="st">"Bond"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-two-asset-plus_rf_saveborrow" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">

<div>                            <div id="23144d4b-cabe-48f9-9194-9c31a485657b" class="plotly-graph-div" style="height:525px; width:100%;"></div>            <script type="text/javascript">                require(["plotly"], function(Plotly) {                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("23144d4b-cabe-48f9-9194-9c31a485657b")) {                    Plotly.newPlot(                        "23144d4b-cabe-48f9-9194-9c31a485657b",                        [{"hovertemplate":"%{text}<extra></extra>","marker":{"color":"orange","size":10},"mode":"markers","name":"Stock","text":["Stock"],"x":[0.15],"y":[0.06],"type":"scatter"},{"hovertemplate":"%{text}<extra></extra>","marker":{"color":"red","size":10},"mode":"markers","name":"Bond","text":["Bond"],"x":[0.035],"y":[0.035],"type":"scatter"},{"customdata":[100.0,99.16666666666667,98.33333333333333,97.5,96.66666666666667,95.83333333333334,95.0,94.16666666666667,93.33333333333333,92.5,91.66666666666666,90.83333333333333,90.0,89.16666666666666,88.33333333333333,87.5,86.66666666666667,85.83333333333334,85.0,84.16666666666667,83.33333333333334,82.5,81.66666666666667,80.83333333333333,80.0,79.16666666666666,78.33333333333333,77.5,76.66666666666666,75.83333333333333,75.0,74.16666666666667,73.33333333333334,72.5,71.66666666666667,70.83333333333333,70.0,69.16666666666667,68.33333333333333,67.5,66.66666666666667,65.83333333333333,65.0,64.16666666666666,63.33333333333333,62.5,61.66666666666667,60.83333333333334,60.0,59.166666666666664,58.33333333333333,57.49999999999999,56.666666666666664,55.833333333333336,55.00000000000001,54.16666666666667,53.333333333333336,52.5,51.66666666666666,50.83333333333333,50.0,49.16666666666667,48.33333333333334,47.5,46.666666666666664,45.833333333333336,44.99999999999999,44.166666666666664,43.333333333333336,42.50000000000001,41.666666666666664,40.833333333333336,40.0,39.16666666666667,38.33333333333333,37.5,36.66666666666667,35.83333333333334,35.0,34.166666666666664,33.333333333333336,32.49999999999999,31.666666666666664,30.833333333333336,30.000000000000004,29.166666666666664,28.333333333333332,27.500000000000004,26.66666666666667,25.83333333333333,25.0,24.16666666666667,23.33333333333334,22.499999999999996,21.666666666666668,20.833333333333336,19.999999999999996,19.166666666666664,18.333333333333336,17.500000000000004,16.666666666666664,15.833333333333332,15.000000000000002,14.166666666666671,13.33333333333333,12.5,11.66666666666667,10.83333333333334,9.999999999999998,9.166666666666668,8.333333333333337,7.500000000000007,6.666666666666665,5.833333333333335,5.000000000000004,4.1666666666666625,3.3333333333333326,2.500000000000002,1.6666666666666718,0.8333333333333304,0.0],"hovertemplate":"Stock: %{text:.0f}%<br>Bond: %{customdata:.0f}%<extra></extra>","line":{"color":"black"},"mode":"lines","name":"Stock & Bond Frontier","text":[0.0,0.8333333333333334,1.6666666666666667,2.5,3.3333333333333335,4.166666666666666,5.0,5.833333333333333,6.666666666666667,7.5,8.333333333333332,9.166666666666666,10.0,10.833333333333334,11.666666666666666,12.5,13.333333333333334,14.166666666666666,15.0,15.833333333333332,16.666666666666664,17.5,18.333333333333332,19.166666666666664,20.0,20.833333333333336,21.666666666666668,22.5,23.333333333333332,24.166666666666668,25.0,25.83333333333333,26.666666666666668,27.500000000000004,28.333333333333332,29.166666666666668,30.0,30.833333333333336,31.666666666666664,32.5,33.33333333333333,34.166666666666664,35.0,35.833333333333336,36.666666666666664,37.5,38.33333333333333,39.166666666666664,40.0,40.833333333333336,41.66666666666667,42.5,43.333333333333336,44.166666666666664,45.0,45.83333333333333,46.666666666666664,47.5,48.333333333333336,49.166666666666664,50.0,50.83333333333333,51.66666666666666,52.5,53.333333333333336,54.166666666666664,55.00000000000001,55.833333333333336,56.666666666666664,57.49999999999999,58.333333333333336,59.166666666666664,60.0,60.83333333333333,61.66666666666667,62.5,63.33333333333333,64.16666666666666,65.0,65.83333333333333,66.66666666666666,67.5,68.33333333333333,69.16666666666667,70.0,70.83333333333334,71.66666666666667,72.5,73.33333333333333,74.16666666666667,75.0,75.83333333333333,76.66666666666666,77.5,78.33333333333333,79.16666666666666,80.0,80.83333333333333,81.66666666666667,82.5,83.33333333333334,84.16666666666667,85.0,85.83333333333333,86.66666666666667,87.5,88.33333333333333,89.16666666666666,90.0,90.83333333333333,91.66666666666666,92.5,93.33333333333333,94.16666666666667,95.0,95.83333333333334,96.66666666666667,97.5,98.33333333333333,99.16666666666667,100.0],"x":[0.035,0.03466831927150653,0.03438244868792474,0.03414353892027011,0.03395258131243894,0.03381038836084423,0.03371757701852254,0.033674555593867075,0.03368151487751767,0.03373842394066445,0.033845030818587106,0.03400086804447466,0.03420526275297414,0.03445735085257974,0.03475609458945454,0.03510030270524743,0.035488652333449416,0.03591971178119953,0.03639196339853072,0.03690382583298256,0.037453675090407056,0.038039863958747276,0.03866073948824282,0.03931465834915917,0.04,0.04071517769142662,0.041458647402495476,0.042228914857002905,0.04302454080070014,0.04384414473767025,0.0446864073292987,0.04555007165502353,0.04643394352315029,0.047336891004796676,0.04825784334638717,0.049195789397512915,0.05014977567247933,0.05111890414622668,0.05210232986899701,0.053099258469398614,0.05410894360249308,0.05513068438819811,0.05616382287558424,0.05720774156042558,0.05826186097649511,0.05932563737542143,0.060398560505289446,0.06148015149442768,0.06256996084384263,0.0636675665294173,0.06477257221317609,0.06588460556154221,0.06700331666749375,0.06812837657279414,0.06925947588597534,0.07039632349143747,0.07153864534486082,0.07268618335007004,0.07383869431252003,0.07499594896466816,0.07615773105863909,0.07732383652176374,0.07849407267077205,0.07966825748063026,0.0808462189042327,0.08202779423937827,0.08321282953968097,0.08440117906627714,0.08559270477739975,0.08678727585308804,0.08798476825249041,0.08918506430139772,0.09038805230781334,0.09159362620352526,0.09280168520979443,0.09401213352541254,0.09522488003551265,0.09643983803963542,0.09765692499766722,0.09887606229236905,0.100097175007312,0.10132019171912379,0.10254504430303353,0.1037716677507776,0.105,0.10622998177434552,0.10746155643350376,0.10869466983251755,0.10992927018971992,0.1111653079627113,0.11240273573183172,0.1136415080906229,0.11488158154281206,0.11612291440538342,0.11736546671733462,0.11860920015374488,0.11985407794480754,0.12110006479950557,0.12234712683363039,0.12359523150186659,0.12484434753368337,0.12609444487279278,0.12734549461995112,0.12859746897889468,0.12985034120521638,0.13110408555800235,0.1323586772540601,0.1336140924245809,0.1348703080740902,0.136127302041549,0.13738505296347844,0.1386435402389884,0.13990274399659852,0.1411626450627471,0.14242322493189094,0.14368446573810423,0.1449463502280911,0.1462088617355323,0.14747198415669027,0.148735701927203,0.15],"y":[0.035,0.035208333333333335,0.035416666666666666,0.035625,0.035833333333333335,0.036041666666666666,0.03625,0.03645833333333333,0.03666666666666667,0.036875,0.03708333333333333,0.03729166666666667,0.0375,0.03770833333333333,0.03791666666666667,0.038125,0.03833333333333334,0.03854166666666667,0.03875,0.03895833333333334,0.03916666666666667,0.03937499999999999,0.03958333333333333,0.03979166666666666,0.04,0.04020833333333333,0.04041666666666667,0.040625,0.04083333333333333,0.041041666666666664,0.04125,0.04145833333333333,0.04166666666666667,0.041875,0.042083333333333334,0.04229166666666666,0.0425,0.04270833333333333,0.04291666666666667,0.043125,0.04333333333333334,0.04354166666666666,0.04375,0.04395833333333333,0.04416666666666666,0.044375,0.04458333333333333,0.04479166666666667,0.045,0.045208333333333336,0.04541666666666666,0.045625,0.04583333333333333,0.04604166666666667,0.04625,0.04645833333333334,0.04666666666666666,0.046875,0.04708333333333333,0.04729166666666666,0.0475,0.04770833333333333,0.04791666666666666,0.048125,0.04833333333333334,0.04854166666666667,0.04875,0.04895833333333333,0.04916666666666667,0.049375,0.04958333333333333,0.04979166666666666,0.05,0.05020833333333333,0.05041666666666667,0.050625,0.05083333333333333,0.05104166666666666,0.05125,0.05145833333333334,0.051666666666666666,0.05187500000000001,0.05208333333333333,0.05229166666666667,0.05249999999999999,0.05270833333333333,0.05291666666666666,0.053125,0.05333333333333333,0.05354166666666667,0.05375,0.05395833333333333,0.05416666666666666,0.054375,0.05458333333333334,0.05479166666666667,0.05500000000000001,0.05520833333333333,0.05541666666666667,0.055624999999999994,0.05583333333333333,0.05604166666666666,0.05625,0.05645833333333333,0.05666666666666667,0.056875,0.05708333333333333,0.05729166666666666,0.0575,0.05770833333333334,0.05791666666666667,0.058125,0.05833333333333333,0.05854166666666667,0.05874999999999999,0.05895833333333333,0.05916666666666666,0.059375,0.05958333333333333,0.05979166666666667,0.06],"type":"scatter"},{"customdata":[[[0.13203429462197971],[0.8679657053780202],[0.5166]]],"hovertemplate":"efficient low risk<br>Stock: %{customdata[0]:.1%}<br>Bond: %{customdata[1]:.1%}<br>Sharpe ratio: %{customdata[2]:.4f}<br><extra></extra>","marker":{"color":"blue","size":10},"mode":"markers","name":"efficient low risk","x":[0.03542526719998681],"y":[0.038300857365549494],"type":"scatter"},{"hovertemplate":"wealth in efficient low risk = %{text:.0f}%<br>Sharpe ratio: 0.5166<extra></extra>","line":{"color":"blue"},"mode":"lines","name":"CAL: efficient low risk","text":[0.0,0.5,1.0,1.5,2.0,2.5,3.0,3.5000000000000004,4.0,4.5,5.0,5.5,6.0,6.5,7.000000000000001,7.5,8.0,8.5,9.0,9.5,10.0,10.5,11.0,11.5,12.0,12.5,13.0,13.5,14.000000000000002,14.499999999999998,15.0,15.5,16.0,16.5,17.0,17.5,18.0,18.5,19.0,19.5,20.0,20.5,21.0,21.5,22.0,22.5,23.0,23.5,24.0,24.5,25.0,25.5,26.0,26.5,27.0,27.500000000000004,28.000000000000004,28.500000000000004,28.999999999999996,29.5,30.0,30.5,31.0,31.5,32.0,32.5,33.0,33.5,34.0,34.5,35.0,35.5,36.0,36.5,37.0,37.5,38.0,38.5,39.0,39.5,40.0,40.5,41.0,41.5,42.0,42.5,43.0,43.5,44.0,44.5,45.0,45.5,46.0,46.5,47.0,47.5,48.0,48.5,49.0,49.5,50.0,50.5,51.0,51.5,52.0,52.5,53.0,53.5,54.0,54.50000000000001,55.00000000000001,55.50000000000001,56.00000000000001,56.50000000000001,57.00000000000001,57.50000000000001,57.99999999999999,58.5,59.0,59.5,60.0,60.5,61.0,61.5,62.0,62.5,63.0,63.5,64.0,64.5,65.0,65.5,66.0,66.5,67.0,67.5,68.0,68.5,69.0,69.5,70.0,70.5,71.0,71.5,72.0,72.5,73.0,73.5,74.0,74.5,75.0,75.5,76.0,76.5,77.0,77.5,78.0,78.5,79.0,79.5,80.0,80.5,81.0,81.5,82.0,82.5,83.0,83.5,84.0,84.5,85.0,85.5,86.0,86.5,87.0,87.5,88.0,88.5,89.0,89.5,90.0,90.5,91.0,91.5,92.0,92.5,93.0,93.5,94.0,94.5,95.0,95.5,96.0,96.5,97.0,97.5,98.0,98.5,99.0,99.5,100.0],"x":[0.0,0.00017712633599993404,0.0003542526719998681,0.0005313790079998021,0.0007085053439997361,0.0008856316799996703,0.0010627580159996042,0.0012398843519995384,0.0014170106879994723,0.0015941370239994062,0.0017712633599993406,0.0019483896959992745,0.0021255160319992084,0.0023026423679991426,0.0024797687039990767,0.0026568950399990104,0.0028340213759989446,0.0030111477119988787,0.0031882740479988124,0.003365400383998747,0.003542526719998681,0.003719653055998615,0.003896779391998549,0.004073905727998483,0.004251032063998417,0.004428158399998351,0.004605284735998285,0.004782411071998219,0.0049595374079981535,0.005136663743998087,0.005313790079998021,0.005490916415997955,0.005668042751997889,0.005845169087997823,0.0060222954239977575,0.006199421759997692,0.006376548095997625,0.006553674431997559,0.006730800767997494,0.006907927103997428,0.007085053439997362,0.0072621797759972965,0.00743930611199723,0.007616432447997164,0.007793558783997098,0.007970685119997031,0.008147811455996965,0.0083249377919969,0.008502064127996834,0.008679190463996768,0.008856316799996702,0.009033443135996636,0.00921056947199657,0.009387695807996504,0.009564822143996439,0.009741948479996373,0.009919074815996307,0.010096201151996241,0.010273327487996173,0.010450453823996108,0.010627580159996042,0.010804706495995976,0.01098183283199591,0.011158959167995844,0.011336085503995778,0.011513211839995713,0.011690338175995647,0.01186746451199558,0.012044590847995515,0.012221717183995449,0.012398843519995383,0.012575969855995316,0.01275309619199525,0.012930222527995184,0.013107348863995118,0.013284475199995052,0.013461601535994988,0.013638727871994922,0.013815854207994856,0.01399298054399479,0.014170106879994725,0.014347233215994659,0.014524359551994593,0.014701485887994527,0.01487861222399446,0.015055738559994394,0.015232864895994328,0.015409991231994262,0.015587117567994196,0.01576424390399413,0.015941370239994063,0.016118496575994,0.01629562291199393,0.016472749247993867,0.0166498755839938,0.016827001919993735,0.017004128255993668,0.0171812545919936,0.017358380927993536,0.017535507263993468,0.017712633599993404,0.01788975993599334,0.018066886271993272,0.01824401260799321,0.01842113894399314,0.018598265279993077,0.01877539161599301,0.018952517951992945,0.019129644287992877,0.019306770623992813,0.019483896959992746,0.01966102329599268,0.019838149631992614,0.02001527596799255,0.020192402303992482,0.020369528639992418,0.020546654975992347,0.020723781311992283,0.020900907647992215,0.02107803398399215,0.021255160319992084,0.02143228665599202,0.021609412991991952,0.021786539327991888,0.02196366566399182,0.022140791999991756,0.02231791833599169,0.022495044671991624,0.022672171007991557,0.022849297343991493,0.023026423679991425,0.02320355001599136,0.023380676351991293,0.02355780268799123,0.02373492902399116,0.023912055359991097,0.02408918169599103,0.024266308031990966,0.024443434367990898,0.024620560703990834,0.024797687039990766,0.0249748133759907,0.02515193971199063,0.025329066047990567,0.0255061923839905,0.025683318719990435,0.025860445055990368,0.026037571391990304,0.026214697727990236,0.026391824063990172,0.026568950399990104,0.02674607673599004,0.026923203071989976,0.02710032940798991,0.027277455743989844,0.027454582079989777,0.027631708415989713,0.027808834751989645,0.02798596108798958,0.028163087423989513,0.02834021375998945,0.028517340095989382,0.028694466431989318,0.02887159276798925,0.029048719103989186,0.02922584543998912,0.029402971775989054,0.029580098111988983,0.02975722444798892,0.02993435078398885,0.030111477119988787,0.03028860345598872,0.030465729791988656,0.030642856127988588,0.030819982463988524,0.030997108799988456,0.031174235135988392,0.031351361471988325,0.03152848780798826,0.031705614143988196,0.031882740479988125,0.03205986681598806,0.032236993151988,0.03241411948798793,0.03259124582398786,0.0327683721599878,0.032945498495987734,0.03312262483198767,0.0332997511679876,0.033476877503987534,0.03365400383998747,0.033831130175987406,0.034008256511987335,0.03418538284798727,0.0343625091839872,0.034539635519987136,0.03471676185598707,0.03489388819198701,0.035071014527986936,0.03524814086398687,0.03542526719998681],"y":[0.02,0.02009150428682775,0.020183008573655497,0.02027451286048324,0.02036601714731099,0.020457521434138738,0.020549025720966486,0.02064053000779423,0.02073203429462198,0.020823538581449728,0.020915042868277476,0.02100654715510522,0.02109805144193297,0.021189555728760717,0.021281060015588465,0.021372564302416214,0.02146406858924396,0.021555572876071707,0.021647077162899455,0.021738581449727203,0.021830085736554948,0.021921590023382696,0.022013094310210445,0.022104598597038193,0.02219610288386594,0.022287607170693686,0.022379111457521434,0.022470615744349182,0.02256212003117693,0.022653624318004675,0.022745128604832424,0.022836632891660172,0.02292813717848792,0.02301964146531567,0.023111145752143413,0.02320265003897116,0.02329415432579891,0.023385658612626658,0.023477162899454403,0.02356866718628215,0.0236601714731099,0.023751675759937647,0.023843180046765396,0.02393468433359314,0.02402618862042089,0.024117692907248637,0.024209197194076385,0.02430070148090413,0.024392205767731878,0.024483710054559626,0.024575214341387375,0.024666718628215123,0.024758222915042868,0.024849727201870616,0.024941231488698364,0.025032735775526112,0.025124240062353857,0.025215744349181606,0.025307248636009354,0.025398752922837102,0.02549025720966485,0.025581761496492595,0.025673265783320343,0.02576477007014809,0.02585627435697584,0.025947778643803585,0.026039282930631333,0.02613078721745908,0.02622229150428683,0.026313795791114578,0.026405300077942326,0.02649680436477007,0.02658830865159782,0.026679812938425564,0.026771317225253312,0.02686282151208106,0.02695432579890881,0.027045830085736557,0.027137334372564305,0.02722883865939205,0.027320342946219798,0.027411847233047546,0.027503351519875294,0.02759485580670304,0.027686360093530787,0.027777864380358536,0.027869368667186284,0.027960872954014032,0.028052377240841777,0.028143881527669525,0.028235385814497273,0.028326890101325018,0.028418394388152766,0.028509898674980515,0.028601402961808263,0.02869290724863601,0.02878441153546376,0.028875915822291504,0.028967420109119252,0.029058924395946997,0.029150428682774746,0.029241932969602494,0.029333437256430242,0.02942494154325799,0.02951644583008574,0.029607950116913487,0.029699454403741235,0.02979095869056898,0.029882462977396728,0.029973967264224473,0.03006547155105222,0.03015697583787997,0.030248480124707718,0.030339984411535466,0.030431488698363214,0.030522992985190962,0.030614497272018704,0.030706001558846452,0.0307975058456742,0.03088901013250195,0.030980514419329697,0.031072018706157445,0.031163522992985193,0.03125502727981294,0.03134653156664069,0.03143803585346844,0.03152954014029618,0.03162104442712393,0.031712548713951676,0.031804053000779424,0.03189555728760717,0.03198706157443492,0.03207856586126267,0.03217007014809042,0.03226157443491816,0.032353078721745906,0.032444583008573655,0.0325360872954014,0.03262759158222915,0.0327190958690569,0.03281060015588465,0.032902104442712396,0.032993608729540144,0.033085113016367886,0.033176617303195634,0.03326812159002338,0.03335962587685113,0.03345113016367888,0.03354263445050663,0.033634138737334375,0.033725643024162116,0.033817147310989865,0.03390865159781761,0.03400015588464536,0.03409166017147311,0.03418316445830086,0.034274668745128606,0.034366173031956354,0.0344576773187841,0.03454918160561185,0.0346406858924396,0.03473219017926735,0.034823694466095095,0.03491519875292284,0.035006703039750585,0.03509820732657833,0.03518971161340608,0.03528121590023382,0.03537272018706157,0.03546422447388932,0.03555572876071707,0.035647233047544816,0.035738737334372564,0.03583024162120031,0.03592174590802806,0.03601325019485581,0.03610475448168356,0.036196258768511305,0.03628776305533905,0.0363792673421668,0.03647077162899455,0.03656227591582229,0.03665378020265004,0.03674528448947779,0.036836788776305536,0.036928293063133284,0.037019797349961026,0.037111301636788774,0.03720280592361652,0.03729431021044427,0.03738581449727202,0.03747731878409977,0.037568823070927515,0.03766032735775526,0.03775183164458301,0.03784333593141076,0.03793484021823851,0.038026344505066256,0.038117848791894,0.038209353078721746,0.038300857365549494],"type":"scatter"},{"customdata":[[[0.3511182108626197],[0.6488817891373803],[0.2003]]],"hovertemplate":"efficient high mean portfolio<br>Stock: %{customdata[0]:.1%}<br>Bond: %{customdata[1]:.1%}<br>Sharpe ratio (relative to borrowing rate): %{customdata[2]:.4f}<br><extra></extra>","marker":{"color":"blue","size":10},"mode":"markers","name":"efficient high mean portfolio","x":[0.05630328830688628],"y":[0.04377795527156549],"type":"scatter"},{"hovertemplate":"wealth in efficient high mean = %{text:.0f}%<br>Sharpe ratio (relative to borrowing rate): 0.2003<extra></extra>","line":{"color":"blue"},"mode":"lines","name":"CAL: efficient high mean","text":[100.0,101.0,102.0,103.0,104.0,105.0,106.0,107.0,108.0,109.00000000000001,110.00000000000001,111.00000000000001,112.00000000000001,112.99999999999999,114.00000000000001,114.99999999999999,115.99999999999999,117.0,118.0,119.0,120.0,121.0,122.0,123.0,124.0,125.0,126.0,127.0,128.0,129.0,130.0,131.0,132.0,133.0,134.0,135.0,136.0,137.0,138.0,139.0,140.0,141.0,142.0,143.0,144.0,145.0,146.0,147.0,148.0,149.0,150.0,151.0,152.0,153.0,154.0,155.0,156.0,157.0,158.0,159.0,160.0,161.0,162.0,163.0,164.0,165.0,166.0,167.0,168.00000000000003,169.0,170.00000000000003,171.0,172.0,173.0,174.0,175.0,176.0,177.0,178.0,179.0,180.0,181.0,182.0,183.0,184.0,185.0,186.0,187.0,188.0,189.0,190.0,191.0,192.0,193.00000000000003,194.0,195.00000000000003,196.0,197.0,198.0,199.0,200.0,200.99999999999997,202.0,203.00000000000003,204.0,204.99999999999997,206.0,207.00000000000003,208.0,209.0,210.0,211.00000000000003,212.0,213.0,214.0,215.00000000000003,216.0,217.0,217.99999999999997,219.0,220.00000000000003,221.0,221.99999999999997,223.0,224.00000000000003,225.0,225.99999999999997,227.0,228.00000000000003,229.0,229.99999999999997,231.0,232.00000000000003,233.0,234.0,235.0,236.00000000000003,237.0,238.0,239.0,240.00000000000003,241.0,242.0,242.99999999999997,244.0,245.00000000000003,246.0,246.99999999999997,248.0,249.00000000000003,250.0,250.99999999999997,252.0,253.00000000000003,254.0,254.99999999999997,256.0,257.0,258.0,259.0,260.0,261.00000000000006,262.0,263.0,264.0,265.00000000000006,266.0,267.0,268.0,269.0,270.0,271.0,272.0,273.0,274.0,275.0,276.0,277.0,278.0,279.0,280.0,281.0,282.0,283.0,284.0,285.0,286.00000000000006,287.0,288.0,289.0,290.00000000000006,291.0,292.0,293.0,294.0,295.0,296.0,297.0,298.0,299.0,300.0],"x":[0.05630328830688627,0.05686632118995514,0.057429354073024,0.057992386956092865,0.058555419839161724,0.05911845272223059,0.059681485605299456,0.060244518488368315,0.06080755137143718,0.06137058425450604,0.061933617137574906,0.06249665002064377,0.06305968290371264,0.06362271578678148,0.06418574866985036,0.06474878155291922,0.06531181443598807,0.06587484731905693,0.06643788020212579,0.06700091308519467,0.06756394596826353,0.06812697885133238,0.06869001173440126,0.06925304461747012,0.06981607750053898,0.07037911038360783,0.07094214326667671,0.07150517614974557,0.07206820903281443,0.0726312419158833,0.07319427479895216,0.07375730768202102,0.07432034056508989,0.07488337344815875,0.07544640633122761,0.07600943921429647,0.07657247209736533,0.0771355049804342,0.07769853786350304,0.07826157074657193,0.07882460362964078,0.07938763651270965,0.07995066939577851,0.08051370227884737,0.08107673516191623,0.0816397680449851,0.08220280092805396,0.08276583381112282,0.08332886669419168,0.08389189957726055,0.08445493246032941,0.08501796534339827,0.08558099822646714,0.086144031109536,0.08670706399260486,0.08727009687567372,0.08783312975874259,0.08839616264181145,0.08895919552488031,0.08952222840794917,0.09008526129101804,0.09064829417408689,0.09121132705715577,0.09177435994022462,0.0923373928232935,0.09290042570636235,0.09346345858943123,0.09402649147250007,0.09458952435556894,0.0951525572386378,0.09571559012170668,0.09627862300477552,0.0968416558878444,0.09740468877091325,0.09796772165398211,0.09853075453705099,0.09909378742011984,0.0996568203031887,0.10021985318625756,0.10078288606932644,0.1013459189523953,0.10190895183546415,0.10247198471853303,0.10303501760160189,0.10359805048467073,0.1041610833677396,0.10472411625080846,0.10528714913387734,0.10585018201694618,0.10641321490001507,0.10697624778308391,0.10753928066615279,0.10810231354922165,0.10866534643229052,0.10922837931535936,0.10979141219842824,0.1103544450814971,0.11091747796456596,0.11148051084763481,0.11204354373070369,0.11260657661377255,0.11316960949684139,0.11373264237991028,0.11429567526297915,0.114858708146048,0.11542174102911686,0.11598477391218573,0.1165478067952546,0.11711083967832345,0.1176738725613923,0.11823690544446118,0.11879993832753005,0.11936297121059891,0.11992600409366776,0.12048903697673663,0.1210520698598055,0.12161510274287436,0.12217813562594321,0.12274116850901207,0.12330420139208094,0.12386723427514981,0.12443026715821866,0.12499330004128752,0.1255563329243564,0.12611936580742528,0.1266823986904941,0.12724543157356297,0.12780846445663185,0.1283714973397007,0.12893453022276957,0.12949756310583843,0.1300605959889073,0.13062362887197618,0.131186661755045,0.13174969463811387,0.13231272752118275,0.1328757604042516,0.13343879328732047,0.13400182617038933,0.1345648590534582,0.13512789193652708,0.13569092481959594,0.13625395770266477,0.13681699058573363,0.13738002346880251,0.13794305635187137,0.13850608923494023,0.1390691221180091,0.13963215500107795,0.14019518788414684,0.14075822076721567,0.14132125365028453,0.14188428653335342,0.14244731941642227,0.14301035229949113,0.14357338518256,0.14413641806562885,0.14469945094869774,0.1452624838317666,0.14582551671483543,0.14638854959790432,0.1469515824809732,0.14751461536404203,0.1480776482471109,0.14864068113017978,0.14920371401324864,0.1497667468963175,0.15032977977938636,0.1508928126624552,0.15145584554552408,0.15201887842859294,0.1525819113116618,0.15314494419473065,0.1537079770777995,0.1542710099608684,0.15483404284393726,0.1553970757270061,0.15596010861007498,0.15652314149314386,0.1570861743762127,0.15764920725928155,0.15821224014235044,0.1587752730254193,0.15933830590848816,0.15990133879155702,0.16046437167462588,0.16102740455769476,0.16159043744076362,0.16215347032383245,0.16271650320690134,0.1632795360899702,0.16384256897303906,0.16440560185610792,0.16496863473917678,0.16553166762224564,0.16609470050531452,0.16665773338838336,0.16722076627145221,0.1677837991545211,0.16834683203758996,0.16890986492065882],"y":[0.04377795527156549,0.043890734824281144,0.0440035143769968,0.04411629392971246,0.04422907348242811,0.04434185303514376,0.04445463258785942,0.04456741214057508,0.04468019169329073,0.04479297124600639,0.04490575079872204,0.0450185303514377,0.04513130990415335,0.045244089456869,0.04535686900958466,0.04546964856230032,0.04558242811501597,0.04569520766773162,0.04580798722044728,0.04592076677316294,0.04603354632587859,0.04614632587859425,0.0462591054313099,0.04637188498402556,0.04648466453674121,0.04659744408945687,0.04671022364217252,0.04682300319488818,0.04693578274760383,0.04704856230031949,0.04716134185303514,0.047274121405750796,0.047386900958466455,0.047499680511182106,0.04761246006389776,0.047725239616613416,0.04783801916932907,0.047950798722044725,0.04806357827476038,0.048176357827476035,0.04828913738019169,0.048401916932907345,0.048514696485622996,0.048627476038338655,0.04874025559105431,0.048853035143769964,0.048965814696485616,0.049078594249201274,0.04919137380191693,0.049304153354632584,0.049416932907348235,0.04952971246006389,0.04964249201277955,0.0497552715654952,0.049868051118210854,0.04998083067092651,0.05009361022364217,0.05020638977635782,0.050319169329073474,0.05043194888178913,0.05054472843450479,0.05065750798722044,0.0507702875399361,0.05088306709265175,0.05099584664536741,0.05110862619808306,0.05122140575079872,0.05133418530351437,0.05144696485623003,0.05155974440894568,0.05167252396166134,0.05178530351437699,0.05189808306709265,0.0520108626198083,0.05212364217252395,0.05223642172523961,0.05234920127795527,0.052461980830670926,0.05257476038338658,0.05268753993610223,0.05280031948881789,0.052913099041533546,0.0530258785942492,0.05313865814696485,0.05325143769968051,0.053364217252396165,0.05347699680511181,0.05358977635782747,0.053702555910543126,0.053815335463258784,0.053928115015974436,0.05404089456869009,0.054153674121405745,0.054266453674121404,0.054379233226837055,0.054492012779552707,0.054604792332268365,0.05471757188498402,0.054830351437699675,0.054943130990415326,0.055055910543130984,0.055168690095846636,0.055281469648562294,0.05539424920127795,0.055507028753993604,0.05561980830670926,0.05573258785942491,0.05584536741214057,0.05595814696485622,0.05607092651757188,0.05618370607028753,0.05629648562300319,0.05640926517571884,0.0565220447284345,0.05663482428115016,0.05674760383386581,0.05686038338658146,0.05697316293929712,0.057085942492012764,0.05719872204472842,0.05731150159744408,0.05742428115015974,0.05753706070287539,0.05764984025559104,0.0577626198083067,0.05787539936102236,0.05798817891373801,0.05810095846645367,0.05821373801916932,0.05832651757188498,0.05843929712460063,0.05855207667731629,0.058664856230031946,0.0587776357827476,0.05889041533546325,0.05900319488817891,0.059115974440894566,0.05922875399361022,0.05934153354632587,0.05945431309904153,0.059567092651757185,0.059679872204472836,0.059792651757188495,0.05990543130990414,0.0600182108626198,0.060130990415335456,0.060243769968051114,0.06035654952076676,0.06046932907348242,0.060582108626198075,0.06069488817891373,0.06080766773162938,0.060920447284345036,0.061033226837060695,0.06114600638977635,0.061258785942492004,0.061371565495207656,0.061484345047923314,0.06159712460063897,0.061709904153354624,0.061822683706070275,0.06193546325878593,0.06204824281150159,0.06216102236421724,0.0622738019169329,0.06238658146964855,0.06249936102236421,0.06261214057507986,0.06272492012779551,0.06283769968051117,0.06295047923322683,0.06306325878594249,0.06317603833865813,0.06328881789137379,0.06340159744408945,0.0635143769968051,0.06362715654952075,0.06373993610223641,0.06385271565495207,0.06396549520766773,0.06407827476038339,0.06419105431309903,0.06430383386581469,0.06441661341853033,0.06452939297124599,0.06464217252396165,0.06475495207667731,0.06486773162939297,0.06498051118210862,0.06509329073482428,0.06520607028753993,0.06531884984025559,0.06543162939297123,0.06554440894568689,0.06565718849840255,0.0657699680511182,0.06588274760383386,0.06599552715654951,0.06610830670926517,0.06622108626198082,0.06633386581469647],"type":"scatter"},{"hovertemplate":"Saving rate<extra></extra>","marker":{"color":"black","size":10},"mode":"markers","name":"Risk-free (Saving)","x":[0],"y":[0.02],"type":"scatter"},{"hovertemplate":"Borrowing rate<extra></extra>","marker":{"color":"DarkGrey","size":10},"mode":"markers","name":"Risk-free (Borrowing)","x":[0],"y":[0.0325],"type":"scatter"}],                        {"template":{"data":{"histogram2dcontour":[{"type":"histogram2dcontour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"choropleth":[{"type":"choropleth","colorbar":{"outlinewidth":0,"ticks":""}}],"histogram2d":[{"type":"histogram2d","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmap":[{"type":"heatmap","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmapgl":[{"type":"heatmapgl","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"contourcarpet":[{"type":"contourcarpet","colorbar":{"outlinewidth":0,"ticks":""}}],"contour":[{"type":"contour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"surface":[{"type":"surface","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"mesh3d":[{"type":"mesh3d","colorbar":{"outlinewidth":0,"ticks":""}}],"scatter":[{"fillpattern":{"fillmode":"overlay","size":10,"solidity":0.2},"type":"scatter"}],"parcoords":[{"type":"parcoords","line":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolargl":[{"type":"scatterpolargl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"scattergeo":[{"type":"scattergeo","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolar":[{"type":"scatterpolar","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"scattergl":[{"type":"scattergl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatter3d":[{"type":"scatter3d","line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattermapbox":[{"type":"scattermapbox","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterternary":[{"type":"scatterternary","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattercarpet":[{"type":"scattercarpet","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"type":"carpet"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}],"barpolar":[{"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"pie":[{"automargin":true,"type":"pie"}]},"layout":{"autotypenumbers":"strict","colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"hovermode":"closest","hoverlabel":{"align":"left"},"paper_bgcolor":"white","plot_bgcolor":"#E5ECF6","polar":{"bgcolor":"#E5ECF6","angularaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"radialaxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"ternary":{"bgcolor":"#E5ECF6","aaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"baxis":{"gridcolor":"white","linecolor":"white","ticks":""},"caxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]]},"xaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"yaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"scene":{"xaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"yaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"zaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"geo":{"bgcolor":"white","landcolor":"#E5ECF6","subunitcolor":"white","showland":true,"showlakes":true,"lakecolor":"white"},"title":{"x":0.05},"mapbox":{"style":"light"}}},"xaxis":{"title":{"text":"Standard Deviation"},"range":[-0.005,0.1875],"tickformat":".0%"},"yaxis":{"title":{"text":"Expected Return"},"range":[0,0.06899999999999999],"tickformat":".0%"},"legend":{"yanchor":"top","y":0.65,"xanchor":"left","x":0.535}},                        {"responsive": true}                    ).then(function(){
                            
var gd = document.getElementById('23144d4b-cabe-48f9-9194-9c31a485657b');
var x = new MutationObserver(function (mutations, observer) {{
        var display = window.getComputedStyle(gd).display;
        if (!display || display === 'none') {{
            console.log([gd, 'removed!']);
            Plotly.purge(gd);
            observer.disconnect();
        }}
}});

// Listen for the removal of the full notebook cells
var notebookContainer = gd.closest('#notebook-container');
if (notebookContainer) {{
    x.observe(notebookContainer, {childList: true});
}}

// Listen for the clearing of the current output cell
var outputEl = gd.closest('.output');
if (outputEl) {{
    x.observe(outputEl, {childList: true});
}}

                        })                };                });            </script>        </div>
<p></p><figcaption class="figure-caption">Figure&nbsp;4.2: Portfolios of two risky assets and risk-free saving and borrowing</figcaption><p></p>
</figure>
</div>
</div>
</section>
<section id="optimal-capital-allocation" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="optimal-capital-allocation">Optimal Capital Allocation</h3>
<p>Where do investors with different risk aversions choose to invest when faced with this investment opportunity set? The answer depends on the investor’s risk aversion and the Sharpe ratios of the efficient low risk and high mean portfolios. First, consider investors risk aversion greater than the Sharpe ratio of the efficient low risk portfolio, calculated with respect to the savings rate.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> These high risk aversion investors invest a fraction <span class="math inline">\(w^*\)</span> of their wealth in the efficient low risk portfolio and the remainder is saved as the savings rate. The optimal fraction of wealth in the efficient low risk portfolio as a function of risk aversion is: <span class="math display">\[ w^*_{\text{low}} = \frac{E[r_{\text{low}}-r_f^{\text{saving}}]}{A \cdot \text{var}_{\text{low}}}.\]</span></p>
<p>Second, consider investors with risk aversion less than the Sharpe ratio of the efficient high mean portfolio, calculated with respect to the borrowing rate.<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a> These low risk aversion investors borrow money and hold a levered position in the efficient high mean portfolio. The optimal weight in the efficient high mean portfolio is: <span class="math display">\[ w^*_{\text{high}} = \frac{E[r_{\text{high}}-r_f^{\text{borrow}}]}{A \cdot \text{var}_{\text{high}}}.\]</span></p>
<p>The third group of investors are those with intermediate risk aversion (i.e., risk aversion falling between the savings rate efficient low risk Sharpe ratio and the borrowing rate efficient high mean Sharpe ratio). These investors hold a portfolio that is a combination of the efficient low risk and high mean portfolios. They do not borrow or save. The optimal weight in the low-risk portfolio is: <span id="eq-frontier-optimal"><span class="math display">\[ a^* = \frac{E[r_{\text{low}} - r_{\text{high}}] - A (\text{cov}[r_{\text{low}}, r_{\text{high}}]-\text{var}[r_{\text{high}}])}{A (\text{var}[r_{\text{low}}]+\text{var}[r_{\text{high}}]-2\text{cov}[r_{\text{low}}, r_{\text{high}}])}\,, \tag{4.1}\]</span></span> and <span class="math inline">\(1-a^*\)</span> is the efficient high mean portfolio weight.<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a></p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Deriving <span class="math inline">\(a^*\)</span>
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>For intermediate risk aversion levels, the optimal weight in the efficient low-risk portfolio solves <span class="math display">\[ \underset{a}\max E[a\cdot r_{\text{low}} + (1-a)\cdot r_{\text{high}}] - 0.5\cdot A \cdot \text{var}[a\cdot r_{\text{low}} + (1-a)\cdot r_{\text{high}}]\,. \]</span> <a href="#eq-frontier-optimal">Equation&nbsp;<span class="quarto-unresolved-ref">eq-frontier-optimal</span></a> is found by taking the derivative of the mean-variance utility with respect to <span class="math inline">\(a\)</span> and solving the first-order condition for <span class="math inline">\(a\)</span>.</p>
</div>
</div>
</div>
<p><a href="#fig-diffsaveborrow-and-preferences">Figure&nbsp;<span class="quarto-unresolved-ref">fig-diffsaveborrow-and-preferences</span></a> shows indifference curves at the highest possible utility level for investors with the indicated risk aversions. The portfolio where each indifference curve intersects the efficient frontier is that investor’s optimal portfolio.</p>
<div class="cell" data-execution_count="4">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.graph_objects <span class="im">as</span> go</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>mn_stock <span class="op">=</span> <span class="dv">6</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>mn_bond  <span class="op">=</span> <span class="fl">3.5</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>sd_stock <span class="op">=</span> <span class="dv">15</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>sd_bond  <span class="op">=</span> <span class="fl">3.5</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>corr <span class="op">=</span> <span class="op">-</span><span class="dv">5</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>rs <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>extra <span class="op">=</span> <span class="fl">1.25</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>raver1 <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>raver2 <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> data(mn1, mn2, sd1, sd2, c, rs, extra):</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>    c <span class="op">=</span> c <span class="op">/</span> <span class="dv">100</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>    rb <span class="op">=</span> rs <span class="op">+</span> extra   </span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>    rs <span class="op">=</span> rs<span class="op">/</span><span class="dv">100</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>    rb <span class="op">=</span> rb<span class="op">/</span><span class="dv">100</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>    mns <span class="op">=</span> [mn1, mn2]</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>    sds <span class="op">=</span> [sd1, sd2]</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>    grid <span class="op">=</span> np.linspace(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">101</span>)</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>    ports <span class="op">=</span> [np.array([w, <span class="dv">1</span> <span class="op">-</span> w]) <span class="cf">for</span> w <span class="kw">in</span> grid]</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>    means <span class="op">=</span> [p.T <span class="op">@</span> np.array(mns) <span class="cf">for</span> p <span class="kw">in</span> ports]</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.DataFrame(means)</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>    df.columns <span class="op">=</span> [<span class="st">"mean"</span>]</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>    cov <span class="op">=</span> np.array(</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>        [[sds[<span class="dv">0</span>] <span class="op">**</span> <span class="dv">2</span>, sds[<span class="dv">0</span>] <span class="op">*</span> sds[<span class="dv">1</span>] <span class="op">*</span> c], [sds[<span class="dv">0</span>] <span class="op">*</span> sds[<span class="dv">1</span>] <span class="op">*</span> c, sds[<span class="dv">1</span>] <span class="op">**</span> <span class="dv">2</span>]]</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>    ).reshape(<span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"stdev"</span>] <span class="op">=</span> [np.sqrt(p.T <span class="op">@</span> cov <span class="op">@</span> p) <span class="cf">for</span> p <span class="kw">in</span> ports]</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"wt1"</span>] <span class="op">=</span> grid</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"wt2"</span>] <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> df.wt1</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> col <span class="kw">in</span> [<span class="st">"mean"</span>, <span class="st">"stdev"</span>]:</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>        df[col] <span class="op">=</span> df[col] <span class="op">/</span> <span class="dv">100</span></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"sr_s"</span>]<span class="op">=</span> (df[<span class="st">"mean"</span>] <span class="op">-</span> rs)<span class="op">/</span>df[<span class="st">"stdev"</span>]</span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"sr_b"</span>]<span class="op">=</span> (df[<span class="st">"mean"</span>] <span class="op">-</span> rb)<span class="op">/</span>df[<span class="st">"stdev"</span>]</span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> rf_plus_risky(mn, sd, rs, rb, w_min, w_max):</span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>    mn <span class="op">/=</span> <span class="dv">100</span></span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>    sd <span class="op">/=</span> <span class="dv">100</span></span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>    rs <span class="op">/=</span> <span class="dv">100</span></span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>    rb <span class="op">/=</span> <span class="dv">100</span></span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>    grid <span class="op">=</span> np.linspace(w_min, w_max, <span class="dv">201</span>)</span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>    mns <span class="op">=</span> [(rs <span class="op">+</span> w <span class="op">*</span> (mn <span class="op">-</span> rs) <span class="cf">if</span> w <span class="op">&lt;=</span> <span class="dv">1</span> <span class="cf">else</span> rb <span class="op">+</span> w <span class="op">*</span> (mn <span class="op">-</span> rb)) <span class="cf">for</span> w <span class="kw">in</span> grid]</span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a>    sds <span class="op">=</span> [w <span class="op">*</span> sd <span class="cf">for</span> w <span class="kw">in</span> grid]</span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a>    srs <span class="op">=</span> (mn <span class="op">-</span> rs)<span class="op">/</span>sd</span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a>    srb <span class="op">=</span> (mn <span class="op">-</span> rb)<span class="op">/</span>sd</span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> grid, mns, sds, srs, srb</span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> opt_utility(mns, cov, Shorts, s, b, A):</span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a>    <span class="co"># P is a portfolio object based on expected returns, covariance matrix, and shorts</span></span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a>    P <span class="op">=</span> portfolio(mns, cov, Shorts) </span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a>    gmv <span class="op">=</span> P.GMV <span class="op">@</span> mns</span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> s<span class="op">==</span>b:</span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a>        <span class="co">#tangency exp ret and sd</span></span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (s <span class="op">&lt;</span> gmv) <span class="kw">or</span> (<span class="kw">not</span> Shorts):</span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a>            portTang <span class="op">=</span> P.tangency(s)</span>
<span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a>            mnTang <span class="op">=</span> portTang <span class="op">@</span> mns</span>
<span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> mnTang <span class="op">&lt;</span> np.<span class="bu">max</span>(mns):</span>
<span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a>                sdTang <span class="op">=</span> np.sqrt(portTang <span class="op">@</span> cov <span class="op">@</span> portTang)</span>
<span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-66"><a href="#cb3-66" aria-hidden="true" tabindex="-1"></a>                <span class="co">#optimal weight in tangency based on risk-aversion</span></span>
<span id="cb3-67"><a href="#cb3-67" aria-hidden="true" tabindex="-1"></a>                wgt <span class="op">=</span> (mnTang <span class="op">-</span> s) <span class="op">/</span> (A <span class="op">*</span> (sdTang<span class="op">**</span><span class="dv">2</span>))</span>
<span id="cb3-68"><a href="#cb3-68" aria-hidden="true" tabindex="-1"></a>                expret<span class="op">=</span> wgt<span class="op">*</span>mnTang <span class="op">+</span> (<span class="dv">1</span><span class="op">-</span>wgt)<span class="op">*</span>s</span>
<span id="cb3-69"><a href="#cb3-69" aria-hidden="true" tabindex="-1"></a>                sdret <span class="op">=</span> wgt<span class="op">*</span>sdTang </span>
<span id="cb3-70"><a href="#cb3-70" aria-hidden="true" tabindex="-1"></a>                wgt_rf <span class="op">=</span> <span class="dv">1</span><span class="op">-</span>wgt</span>
<span id="cb3-71"><a href="#cb3-71" aria-hidden="true" tabindex="-1"></a>                wgt_lo <span class="op">=</span> wgt</span>
<span id="cb3-72"><a href="#cb3-72" aria-hidden="true" tabindex="-1"></a>                wgt_hi <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb3-73"><a href="#cb3-73" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb3-74"><a href="#cb3-74" aria-hidden="true" tabindex="-1"></a>        <span class="co">#efficient low-risk portfolio</span></span>
<span id="cb3-75"><a href="#cb3-75" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (s <span class="op">&lt;</span> gmv) <span class="kw">or</span> (<span class="kw">not</span> Shorts):</span>
<span id="cb3-76"><a href="#cb3-76" aria-hidden="true" tabindex="-1"></a>            portTangLowRisk <span class="op">=</span> P.tangency(s)</span>
<span id="cb3-77"><a href="#cb3-77" aria-hidden="true" tabindex="-1"></a>            mnTangLowRisk <span class="op">=</span> portTangLowRisk <span class="op">@</span> mns</span>
<span id="cb3-78"><a href="#cb3-78" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> mnTangLowRisk <span class="op">&lt;</span> np.<span class="bu">max</span>(mns):</span>
<span id="cb3-79"><a href="#cb3-79" aria-hidden="true" tabindex="-1"></a>                sdTangLowRisk <span class="op">=</span> np.sqrt(portTangLowRisk <span class="op">@</span> cov <span class="op">@</span> portTangLowRisk)</span>
<span id="cb3-80"><a href="#cb3-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-81"><a href="#cb3-81" aria-hidden="true" tabindex="-1"></a>        <span class="co">#efficient high-risk portfolio</span></span>
<span id="cb3-82"><a href="#cb3-82" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> ((b<span class="op">&lt;</span>gmv) <span class="kw">or</span> (<span class="kw">not</span> Shorts)):</span>
<span id="cb3-83"><a href="#cb3-83" aria-hidden="true" tabindex="-1"></a>            portTangHighRisk <span class="op">=</span> P.tangency(b)</span>
<span id="cb3-84"><a href="#cb3-84" aria-hidden="true" tabindex="-1"></a>            mnTangHighRisk <span class="op">=</span> portTangHighRisk <span class="op">@</span> mns</span>
<span id="cb3-85"><a href="#cb3-85" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> mnTangHighRisk <span class="op">&lt;</span> np.<span class="bu">max</span>(mns):</span>
<span id="cb3-86"><a href="#cb3-86" aria-hidden="true" tabindex="-1"></a>                sdTangHighRisk <span class="op">=</span> np.sqrt(portTangHighRisk <span class="op">@</span> cov <span class="op">@</span> portTangHighRisk)</span>
<span id="cb3-87"><a href="#cb3-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-88"><a href="#cb3-88" aria-hidden="true" tabindex="-1"></a>        <span class="co">#1st: efficient low risk CAL</span></span>
<span id="cb3-89"><a href="#cb3-89" aria-hidden="true" tabindex="-1"></a>        wgt <span class="op">=</span> (mnTangLowRisk <span class="op">-</span> s) <span class="op">/</span> (A <span class="op">*</span> (sdTangLowRisk<span class="op">**</span><span class="dv">2</span>))</span>
<span id="cb3-90"><a href="#cb3-90" aria-hidden="true" tabindex="-1"></a>        expret<span class="op">=</span> wgt<span class="op">*</span>mnTangLowRisk <span class="op">+</span> (<span class="dv">1</span><span class="op">-</span>wgt)<span class="op">*</span>s</span>
<span id="cb3-91"><a href="#cb3-91" aria-hidden="true" tabindex="-1"></a>        sdret <span class="op">=</span> wgt<span class="op">*</span>sdTangLowRisk </span>
<span id="cb3-92"><a href="#cb3-92" aria-hidden="true" tabindex="-1"></a>        wgt_rf <span class="op">=</span> <span class="dv">1</span><span class="op">-</span>wgt</span>
<span id="cb3-93"><a href="#cb3-93" aria-hidden="true" tabindex="-1"></a>        wgt_lo <span class="op">=</span> wgt</span>
<span id="cb3-94"><a href="#cb3-94" aria-hidden="true" tabindex="-1"></a>        wgt_hi <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb3-95"><a href="#cb3-95" aria-hidden="true" tabindex="-1"></a>        <span class="co"># print('Weight low risk CAL: ', wgt)</span></span>
<span id="cb3-96"><a href="#cb3-96" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> wgt <span class="op">&gt;</span> <span class="fl">1.0</span>:</span>
<span id="cb3-97"><a href="#cb3-97" aria-hidden="true" tabindex="-1"></a>            <span class="co">#2nd: efficient high risk CAL</span></span>
<span id="cb3-98"><a href="#cb3-98" aria-hidden="true" tabindex="-1"></a>            wgt <span class="op">=</span> (mnTangHighRisk <span class="op">-</span> b) <span class="op">/</span> (A <span class="op">*</span> (sdTangHighRisk<span class="op">**</span><span class="dv">2</span>))</span>
<span id="cb3-99"><a href="#cb3-99" aria-hidden="true" tabindex="-1"></a>            expret<span class="op">=</span> wgt<span class="op">*</span>mnTangHighRisk <span class="op">+</span> (<span class="dv">1</span><span class="op">-</span>wgt)<span class="op">*</span>b</span>
<span id="cb3-100"><a href="#cb3-100" aria-hidden="true" tabindex="-1"></a>            sdret <span class="op">=</span> wgt<span class="op">*</span>sdTangHighRisk </span>
<span id="cb3-101"><a href="#cb3-101" aria-hidden="true" tabindex="-1"></a>            wgt_rf <span class="op">=</span> <span class="dv">1</span><span class="op">-</span>wgt</span>
<span id="cb3-102"><a href="#cb3-102" aria-hidden="true" tabindex="-1"></a>            wgt_lo <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb3-103"><a href="#cb3-103" aria-hidden="true" tabindex="-1"></a>            wgt_hi <span class="op">=</span> wgt</span>
<span id="cb3-104"><a href="#cb3-104" aria-hidden="true" tabindex="-1"></a>            <span class="co"># print('Weight high risk CAL: ', wgt)</span></span>
<span id="cb3-105"><a href="#cb3-105" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> wgt <span class="op">&lt;</span> <span class="fl">1.0</span>:</span>
<span id="cb3-106"><a href="#cb3-106" aria-hidden="true" tabindex="-1"></a>                <span class="co">#3rd: risky asset frontier</span></span>
<span id="cb3-107"><a href="#cb3-107" aria-hidden="true" tabindex="-1"></a>                wgt <span class="op">=</span> <span class="dv">1</span> <span class="co">#This is should be interpreted as total weight in risky assets.</span></span>
<span id="cb3-108"><a href="#cb3-108" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Method 1: solve analytically for utility-maximizing mix of efficient low and high risk portfolios</span></span>
<span id="cb3-109"><a href="#cb3-109" aria-hidden="true" tabindex="-1"></a>                cov_hilo <span class="op">=</span> portTangLowRisk.T <span class="op">@</span>cov <span class="op">@</span> portTangHighRisk</span>
<span id="cb3-110"><a href="#cb3-110" aria-hidden="true" tabindex="-1"></a>                wgt_lo <span class="op">=</span> (mnTangLowRisk <span class="op">-</span> mnTangHighRisk <span class="op">-</span> A <span class="op">*</span>(cov_hilo  <span class="op">-</span> sdTangHighRisk<span class="op">**</span><span class="dv">2</span>))<span class="op">/</span>(A<span class="op">*</span>(sdTangLowRisk<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> sdTangHighRisk<span class="op">**</span><span class="dv">2</span> <span class="op">-</span> <span class="dv">2</span><span class="op">*</span>cov_hilo))</span>
<span id="cb3-111"><a href="#cb3-111" aria-hidden="true" tabindex="-1"></a>                expret <span class="op">=</span> wgt_lo<span class="op">*</span>mnTangLowRisk <span class="op">+</span> (<span class="dv">1</span><span class="op">-</span>wgt_lo)<span class="op">*</span> mnTangHighRisk</span>
<span id="cb3-112"><a href="#cb3-112" aria-hidden="true" tabindex="-1"></a>                sdret <span class="op">=</span> np.sqrt((wgt_lo<span class="op">**</span><span class="dv">2</span>) <span class="op">*</span>sdTangLowRisk<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> ((<span class="dv">1</span><span class="op">-</span>wgt_lo)<span class="op">**</span><span class="dv">2</span>) <span class="op">*</span> sdTangHighRisk<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> <span class="dv">2</span><span class="op">*</span>wgt_lo<span class="op">*</span>(<span class="dv">1</span><span class="op">-</span>wgt_lo)<span class="op">*</span>portTangLowRisk.T <span class="op">@</span>cov <span class="op">@</span> portTangHighRisk)</span>
<span id="cb3-113"><a href="#cb3-113" aria-hidden="true" tabindex="-1"></a>                wgt_hi <span class="op">=</span> <span class="dv">1</span><span class="op">-</span>wgt_lo</span>
<span id="cb3-114"><a href="#cb3-114" aria-hidden="true" tabindex="-1"></a>                wgt_rf <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb3-115"><a href="#cb3-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-116"><a href="#cb3-116" aria-hidden="true" tabindex="-1"></a>                <span class="co"># #Method 2: calculate frontier manually and choose max utility</span></span>
<span id="cb3-117"><a href="#cb3-117" aria-hidden="true" tabindex="-1"></a>                <span class="co"># eret_grid = np.linspace(mnTangLowRisk, mnTangHighRisk, 100)</span></span>
<span id="cb3-118"><a href="#cb3-118" aria-hidden="true" tabindex="-1"></a>                <span class="co"># df = pd.DataFrame(dtype='float', columns=['mn','sd','u'],index=np.arange(0,100))</span></span>
<span id="cb3-119"><a href="#cb3-119" aria-hidden="true" tabindex="-1"></a>                <span class="co"># for i,m in enumerate(eret_grid):</span></span>
<span id="cb3-120"><a href="#cb3-120" aria-hidden="true" tabindex="-1"></a>                <span class="co">#     portFrontier = P.frontier(m)</span></span>
<span id="cb3-121"><a href="#cb3-121" aria-hidden="true" tabindex="-1"></a>                <span class="co">#     df.loc[i,'mn'] = portFrontier @ mns</span></span>
<span id="cb3-122"><a href="#cb3-122" aria-hidden="true" tabindex="-1"></a>                <span class="co">#     df.loc[i,'sd'] = np.sqrt(portFrontier @ cov @ portFrontier)</span></span>
<span id="cb3-123"><a href="#cb3-123" aria-hidden="true" tabindex="-1"></a>                <span class="co"># df['u']  = df['mn'] - 0.5*A* df['sd']**2</span></span>
<span id="cb3-124"><a href="#cb3-124" aria-hidden="true" tabindex="-1"></a>                <span class="co"># opt_mn = df.loc[df['u'].idxmax(),'mn']</span></span>
<span id="cb3-125"><a href="#cb3-125" aria-hidden="true" tabindex="-1"></a>                <span class="co"># portFrontier = P.frontier(opt_mn)</span></span>
<span id="cb3-126"><a href="#cb3-126" aria-hidden="true" tabindex="-1"></a>                <span class="co"># expret = portFrontier @ mns</span></span>
<span id="cb3-127"><a href="#cb3-127" aria-hidden="true" tabindex="-1"></a>                <span class="co"># sdret  = np.sqrt(portFrontier @ cov @ portFrontier)</span></span>
<span id="cb3-128"><a href="#cb3-128" aria-hidden="true" tabindex="-1"></a>                <span class="co"># print('Weight frontier: ', wgt)</span></span>
<span id="cb3-129"><a href="#cb3-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-130"><a href="#cb3-130" aria-hidden="true" tabindex="-1"></a>    u <span class="op">=</span> expret <span class="op">-</span> <span class="fl">0.5</span><span class="op">*</span>A<span class="op">*</span>sdret<span class="op">**</span><span class="dv">2</span></span>
<span id="cb3-131"><a href="#cb3-131" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> u, wgt, wgt_rf, wgt_lo, wgt_hi</span>
<span id="cb3-132"><a href="#cb3-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-133"><a href="#cb3-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-134"><a href="#cb3-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-135"><a href="#cb3-135" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> figtbl(mn1, mn2, sd1, sd2, c, rs, extra, raver1, raver2, asset1_name, asset2_name):</span>
<span id="cb3-136"><a href="#cb3-136" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> data(mn1, mn2, sd1, sd2, c, rs, extra)</span>
<span id="cb3-137"><a href="#cb3-137" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-138"><a href="#cb3-138" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Plot the portfolios of the two assets</span></span>
<span id="cb3-139"><a href="#cb3-139" aria-hidden="true" tabindex="-1"></a>    trace1 <span class="op">=</span> go.Scatter(</span>
<span id="cb3-140"><a href="#cb3-140" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span>df[<span class="st">"stdev"</span>],</span>
<span id="cb3-141"><a href="#cb3-141" aria-hidden="true" tabindex="-1"></a>        y<span class="op">=</span>df[<span class="st">"mean"</span>],</span>
<span id="cb3-142"><a href="#cb3-142" aria-hidden="true" tabindex="-1"></a>        mode<span class="op">=</span><span class="st">"lines"</span>,</span>
<span id="cb3-143"><a href="#cb3-143" aria-hidden="true" tabindex="-1"></a>        <span class="co"># line={'color': green},</span></span>
<span id="cb3-144"><a href="#cb3-144" aria-hidden="true" tabindex="-1"></a>        text<span class="op">=</span><span class="dv">100</span> <span class="op">*</span> df[<span class="st">"wt1"</span>],</span>
<span id="cb3-145"><a href="#cb3-145" aria-hidden="true" tabindex="-1"></a>        customdata<span class="op">=</span><span class="dv">100</span> <span class="op">*</span> df[<span class="st">"wt2"</span>],</span>
<span id="cb3-146"><a href="#cb3-146" aria-hidden="true" tabindex="-1"></a>        hovertemplate<span class="op">=</span>asset1_name<span class="op">+</span><span class="st">": %</span><span class="sc">{text:.0f}</span><span class="st">%&lt;br&gt;"</span><span class="op">+</span>asset2_name<span class="op">+</span><span class="st">": %</span><span class="sc">{customdata:.0f}</span><span class="st">%&lt;extra&gt;&lt;/extra&gt;"</span>,</span>
<span id="cb3-147"><a href="#cb3-147" aria-hidden="true" tabindex="-1"></a>        line<span class="op">=</span><span class="bu">dict</span>(color<span class="op">=</span><span class="st">"black"</span>),</span>
<span id="cb3-148"><a href="#cb3-148" aria-hidden="true" tabindex="-1"></a>        name<span class="op">=</span><span class="st">"Stock &amp; Bond Frontier"</span></span>
<span id="cb3-149"><a href="#cb3-149" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb3-150"><a href="#cb3-150" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-151"><a href="#cb3-151" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plot the two assets</span></span>
<span id="cb3-152"><a href="#cb3-152" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df[df.wt1.isin([<span class="dv">0</span>, <span class="dv">1</span>])]</span>
<span id="cb3-153"><a href="#cb3-153" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"text"</span>] <span class="op">=</span> np.where(df.wt1 <span class="op">==</span> <span class="dv">1</span>, asset1_name, asset2_name)</span>
<span id="cb3-154"><a href="#cb3-154" aria-hidden="true" tabindex="-1"></a>    trace2a <span class="op">=</span> go.Scatter(</span>
<span id="cb3-155"><a href="#cb3-155" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span>df[df.wt1<span class="op">==</span><span class="dv">1</span>][<span class="st">"stdev"</span>],</span>
<span id="cb3-156"><a href="#cb3-156" aria-hidden="true" tabindex="-1"></a>        y<span class="op">=</span>df[df.wt1<span class="op">==</span><span class="dv">1</span>][<span class="st">"mean"</span>],</span>
<span id="cb3-157"><a href="#cb3-157" aria-hidden="true" tabindex="-1"></a>        mode<span class="op">=</span><span class="st">"markers"</span>,</span>
<span id="cb3-158"><a href="#cb3-158" aria-hidden="true" tabindex="-1"></a>        text<span class="op">=</span>df[df.wt1<span class="op">==</span><span class="dv">1</span>][<span class="st">"text"</span>],</span>
<span id="cb3-159"><a href="#cb3-159" aria-hidden="true" tabindex="-1"></a>        hovertemplate<span class="op">=</span><span class="st">"%</span><span class="sc">{text}</span><span class="st">&lt;extra&gt;&lt;/extra&gt;"</span>,</span>
<span id="cb3-160"><a href="#cb3-160" aria-hidden="true" tabindex="-1"></a>        marker<span class="op">=</span><span class="bu">dict</span>(size<span class="op">=</span><span class="dv">10</span>, color<span class="op">=</span><span class="st">"orange"</span>),</span>
<span id="cb3-161"><a href="#cb3-161" aria-hidden="true" tabindex="-1"></a>        name<span class="op">=</span>asset1_name</span>
<span id="cb3-162"><a href="#cb3-162" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb3-163"><a href="#cb3-163" aria-hidden="true" tabindex="-1"></a>    trace2b <span class="op">=</span> go.Scatter(</span>
<span id="cb3-164"><a href="#cb3-164" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span>df[df.wt1<span class="op">==</span><span class="dv">0</span>][<span class="st">"stdev"</span>],</span>
<span id="cb3-165"><a href="#cb3-165" aria-hidden="true" tabindex="-1"></a>        y<span class="op">=</span>df[df.wt1<span class="op">==</span><span class="dv">0</span>][<span class="st">"mean"</span>],</span>
<span id="cb3-166"><a href="#cb3-166" aria-hidden="true" tabindex="-1"></a>        mode<span class="op">=</span><span class="st">"markers"</span>,</span>
<span id="cb3-167"><a href="#cb3-167" aria-hidden="true" tabindex="-1"></a>        text<span class="op">=</span>df[df.wt1<span class="op">==</span><span class="dv">0</span>][<span class="st">"text"</span>],</span>
<span id="cb3-168"><a href="#cb3-168" aria-hidden="true" tabindex="-1"></a>        hovertemplate<span class="op">=</span><span class="st">"%</span><span class="sc">{text}</span><span class="st">&lt;extra&gt;&lt;/extra&gt;"</span>,</span>
<span id="cb3-169"><a href="#cb3-169" aria-hidden="true" tabindex="-1"></a>        marker<span class="op">=</span><span class="bu">dict</span>(size<span class="op">=</span><span class="dv">10</span>, color<span class="op">=</span><span class="st">"red"</span>),</span>
<span id="cb3-170"><a href="#cb3-170" aria-hidden="true" tabindex="-1"></a>        name<span class="op">=</span>asset2_name</span>
<span id="cb3-171"><a href="#cb3-171" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb3-172"><a href="#cb3-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-173"><a href="#cb3-173" aria-hidden="true" tabindex="-1"></a>    fig <span class="op">=</span> go.Figure()</span>
<span id="cb3-174"><a href="#cb3-174" aria-hidden="true" tabindex="-1"></a>    fig.add_trace(trace2a)</span>
<span id="cb3-175"><a href="#cb3-175" aria-hidden="true" tabindex="-1"></a>    fig.add_trace(trace2b)</span>
<span id="cb3-176"><a href="#cb3-176" aria-hidden="true" tabindex="-1"></a>    fig.add_trace(trace1)</span>
<span id="cb3-177"><a href="#cb3-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-178"><a href="#cb3-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-179"><a href="#cb3-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-180"><a href="#cb3-180" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> custom(string, ports,srTang,borrow_flag):</span>
<span id="cb3-181"><a href="#cb3-181" aria-hidden="true" tabindex="-1"></a>        <span class="co"># borrow_flag=1 adds statement about "relative to borrowing rate"</span></span>
<span id="cb3-182"><a href="#cb3-182" aria-hidden="true" tabindex="-1"></a>        cd <span class="op">=</span> np.empty(shape<span class="op">=</span>(<span class="bu">len</span>(ports), N<span class="op">+</span><span class="dv">1</span>, <span class="dv">1</span>), dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb3-183"><a href="#cb3-183" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(N):</span>
<span id="cb3-184"><a href="#cb3-184" aria-hidden="true" tabindex="-1"></a>            cd[:, i] <span class="op">=</span> np.array([w[i] <span class="cf">for</span> w <span class="kw">in</span> ports]).reshape(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb3-185"><a href="#cb3-185" aria-hidden="true" tabindex="-1"></a>        cd[:,N] <span class="op">=</span> np.<span class="bu">round</span>(srTang,<span class="dv">4</span>)</span>
<span id="cb3-186"><a href="#cb3-186" aria-hidden="true" tabindex="-1"></a>        <span class="co"># print(cd)</span></span>
<span id="cb3-187"><a href="#cb3-187" aria-hidden="true" tabindex="-1"></a>        string <span class="op">+=</span> <span class="st">"&lt;br&gt;"</span></span>
<span id="cb3-188"><a href="#cb3-188" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(N):</span>
<span id="cb3-189"><a href="#cb3-189" aria-hidden="true" tabindex="-1"></a>            string <span class="op">+=</span> <span class="st">"asset "</span> <span class="op">+</span> <span class="bu">str</span>(i <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb3-190"><a href="#cb3-190" aria-hidden="true" tabindex="-1"></a>            string <span class="op">+=</span> <span class="st">": %{customdata["</span></span>
<span id="cb3-191"><a href="#cb3-191" aria-hidden="true" tabindex="-1"></a>            string <span class="op">+=</span> <span class="bu">str</span>(i)</span>
<span id="cb3-192"><a href="#cb3-192" aria-hidden="true" tabindex="-1"></a>            string <span class="op">+=</span> <span class="st">"]:.1%}&lt;br&gt;"</span></span>
<span id="cb3-193"><a href="#cb3-193" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> borrow_flag<span class="op">==</span><span class="dv">1</span>:</span>
<span id="cb3-194"><a href="#cb3-194" aria-hidden="true" tabindex="-1"></a>            string <span class="op">+=</span> <span class="st">"Sharpe ratio (relative to borrowing rate): %{customdata["</span> <span class="op">+</span>  <span class="bu">str</span>(N) <span class="op">+</span> <span class="st">"]:.4f}&lt;br&gt;"</span>    </span>
<span id="cb3-195"><a href="#cb3-195" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb3-196"><a href="#cb3-196" aria-hidden="true" tabindex="-1"></a>            string <span class="op">+=</span> <span class="st">"Sharpe ratio: %{customdata["</span> <span class="op">+</span>  <span class="bu">str</span>(N) <span class="op">+</span> <span class="st">"]:.4f}&lt;br&gt;"</span></span>
<span id="cb3-197"><a href="#cb3-197" aria-hidden="true" tabindex="-1"></a>        string <span class="op">+=</span> <span class="st">"&lt;extra&gt;&lt;/extra&gt;"</span></span>
<span id="cb3-198"><a href="#cb3-198" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> string, cd  </span>
<span id="cb3-199"><a href="#cb3-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-200"><a href="#cb3-200" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plot the tangency portfolios</span></span>
<span id="cb3-201"><a href="#cb3-201" aria-hidden="true" tabindex="-1"></a>    c <span class="op">=</span> c <span class="op">/</span> <span class="dv">100</span></span>
<span id="cb3-202"><a href="#cb3-202" aria-hidden="true" tabindex="-1"></a>    rb <span class="op">=</span> rs <span class="op">+</span> extra     </span>
<span id="cb3-203"><a href="#cb3-203" aria-hidden="true" tabindex="-1"></a>    rs <span class="op">=</span> rs<span class="op">/</span><span class="dv">100</span></span>
<span id="cb3-204"><a href="#cb3-204" aria-hidden="true" tabindex="-1"></a>    rb <span class="op">=</span> rb<span class="op">/</span><span class="dv">100</span></span>
<span id="cb3-205"><a href="#cb3-205" aria-hidden="true" tabindex="-1"></a>    mns <span class="op">=</span> [mn1, mn2]</span>
<span id="cb3-206"><a href="#cb3-206" aria-hidden="true" tabindex="-1"></a>    mns <span class="op">=</span> np.array(mns) <span class="op">/</span> <span class="dv">100</span></span>
<span id="cb3-207"><a href="#cb3-207" aria-hidden="true" tabindex="-1"></a>    sds <span class="op">=</span> [sd1, sd2]</span>
<span id="cb3-208"><a href="#cb3-208" aria-hidden="true" tabindex="-1"></a>    sds <span class="op">=</span> np.array(sds) <span class="op">/</span> <span class="dv">100</span></span>
<span id="cb3-209"><a href="#cb3-209" aria-hidden="true" tabindex="-1"></a>    cov <span class="op">=</span> np.array(</span>
<span id="cb3-210"><a href="#cb3-210" aria-hidden="true" tabindex="-1"></a>        [[sds[<span class="dv">0</span>] <span class="op">**</span> <span class="dv">2</span>, sds[<span class="dv">0</span>] <span class="op">*</span> sds[<span class="dv">1</span>] <span class="op">*</span> c], [sds[<span class="dv">0</span>] <span class="op">*</span> sds[<span class="dv">1</span>] <span class="op">*</span> c, sds[<span class="dv">1</span>] <span class="op">**</span> <span class="dv">2</span>]]</span>
<span id="cb3-211"><a href="#cb3-211" aria-hidden="true" tabindex="-1"></a>    ).reshape(<span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb3-212"><a href="#cb3-212" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-213"><a href="#cb3-213" aria-hidden="true" tabindex="-1"></a>    Shorts <span class="op">=</span> <span class="va">True</span>    </span>
<span id="cb3-214"><a href="#cb3-214" aria-hidden="true" tabindex="-1"></a>    N <span class="op">=</span> <span class="bu">len</span>(mns)</span>
<span id="cb3-215"><a href="#cb3-215" aria-hidden="true" tabindex="-1"></a>    P <span class="op">=</span> portfolio(mns, cov, Shorts)    </span>
<span id="cb3-216"><a href="#cb3-216" aria-hidden="true" tabindex="-1"></a>    gmv <span class="op">=</span> P.GMV <span class="op">@</span> mns</span>
<span id="cb3-217"><a href="#cb3-217" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print('GMV return is: ',gmv)</span></span>
<span id="cb3-218"><a href="#cb3-218" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (rs <span class="op">&lt;</span> gmv) <span class="kw">or</span> (<span class="kw">not</span> Shorts):</span>
<span id="cb3-219"><a href="#cb3-219" aria-hidden="true" tabindex="-1"></a>        portTang <span class="op">=</span> P.tangency(rs)</span>
<span id="cb3-220"><a href="#cb3-220" aria-hidden="true" tabindex="-1"></a>        mnTang <span class="op">=</span> portTang <span class="op">@</span> mns</span>
<span id="cb3-221"><a href="#cb3-221" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> mnTang <span class="op">&lt;</span> np.<span class="bu">max</span>(mns):</span>
<span id="cb3-222"><a href="#cb3-222" aria-hidden="true" tabindex="-1"></a>            sdTang <span class="op">=</span> np.sqrt(portTang <span class="op">@</span> cov <span class="op">@</span> portTang)</span>
<span id="cb3-223"><a href="#cb3-223" aria-hidden="true" tabindex="-1"></a>            srTang <span class="op">=</span> (mnTang <span class="op">-</span> rs)<span class="op">/</span>sdTang</span>
<span id="cb3-224"><a href="#cb3-224" aria-hidden="true" tabindex="-1"></a>            string0 <span class="op">=</span> <span class="st">'tangency portfolio'</span> <span class="cf">if</span> rb <span class="op">==</span> rs <span class="cf">else</span> <span class="st">'efficient low risk portfolio'</span> <span class="cf">if</span> rb <span class="op">!=</span> rs <span class="cf">else</span> <span class="st">'tangency portfolio'</span></span>
<span id="cb3-225"><a href="#cb3-225" aria-hidden="true" tabindex="-1"></a>            string, cd <span class="op">=</span> custom(string0, [portTang], srTang,<span class="dv">0</span>)</span>
<span id="cb3-226"><a href="#cb3-226" aria-hidden="true" tabindex="-1"></a>            trace <span class="op">=</span> go.Scatter(</span>
<span id="cb3-227"><a href="#cb3-227" aria-hidden="true" tabindex="-1"></a>                x<span class="op">=</span>[sdTang],</span>
<span id="cb3-228"><a href="#cb3-228" aria-hidden="true" tabindex="-1"></a>                y<span class="op">=</span>[mnTang],</span>
<span id="cb3-229"><a href="#cb3-229" aria-hidden="true" tabindex="-1"></a>                mode<span class="op">=</span><span class="st">"markers"</span>,</span>
<span id="cb3-230"><a href="#cb3-230" aria-hidden="true" tabindex="-1"></a>                customdata<span class="op">=</span>cd,</span>
<span id="cb3-231"><a href="#cb3-231" aria-hidden="true" tabindex="-1"></a>                hovertemplate<span class="op">=</span>string,</span>
<span id="cb3-232"><a href="#cb3-232" aria-hidden="true" tabindex="-1"></a>                marker<span class="op">=</span><span class="bu">dict</span>(size<span class="op">=</span><span class="dv">10</span>, color<span class="op">=</span><span class="st">"blue"</span>),</span>
<span id="cb3-233"><a href="#cb3-233" aria-hidden="true" tabindex="-1"></a>                name<span class="op">=</span>string0</span>
<span id="cb3-234"><a href="#cb3-234" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb3-235"><a href="#cb3-235" aria-hidden="true" tabindex="-1"></a>            fig.add_trace(trace)</span>
<span id="cb3-236"><a href="#cb3-236" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb3-237"><a href="#cb3-237" aria-hidden="true" tabindex="-1"></a>            <span class="co">#Plot CAL (no leverage)</span></span>
<span id="cb3-238"><a href="#cb3-238" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> rb<span class="op">==</span>rs:</span>
<span id="cb3-239"><a href="#cb3-239" aria-hidden="true" tabindex="-1"></a>                max_wgt <span class="op">=</span> <span class="fl">4.0</span></span>
<span id="cb3-240"><a href="#cb3-240" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb3-241"><a href="#cb3-241" aria-hidden="true" tabindex="-1"></a>                max_wgt <span class="op">=</span> <span class="fl">1.0</span></span>
<span id="cb3-242"><a href="#cb3-242" aria-hidden="true" tabindex="-1"></a>            grid, mns_cal, sds_cal, srs_cal, srb_cal <span class="op">=</span> rf_plus_risky(mnTang<span class="op">*</span><span class="dv">100</span>, sdTang<span class="op">*</span><span class="dv">100</span>, rs<span class="op">*</span><span class="dv">100</span>,rb<span class="op">*</span><span class="dv">100</span>,<span class="dv">0</span>, max_wgt)</span>
<span id="cb3-243"><a href="#cb3-243" aria-hidden="true" tabindex="-1"></a>            portlabel <span class="op">=</span> <span class="st">'tangency portfolio'</span> <span class="cf">if</span> rb <span class="op">==</span> rs <span class="cf">else</span> <span class="st">'efficient low risk portfolio'</span> <span class="cf">if</span> rb <span class="op">!=</span> rs <span class="cf">else</span> <span class="st">'tangency portfolio'</span></span>
<span id="cb3-244"><a href="#cb3-244" aria-hidden="true" tabindex="-1"></a>            string <span class="op">=</span> <span class="st">"wealth in "</span><span class="op">+</span>portlabel <span class="op">+</span> <span class="st">" = %</span><span class="sc">{text:.0f}</span><span class="st">%&lt;br&gt;"</span> <span class="op">+</span> <span class="st">"Sharpe ratio: "</span> <span class="op">+</span>  <span class="st">"</span><span class="sc">{:.4f}</span><span class="st">"</span>.<span class="bu">format</span>(srTang) <span class="op">+</span><span class="st">"&lt;extra&gt;&lt;/extra&gt;"</span></span>
<span id="cb3-245"><a href="#cb3-245" aria-hidden="true" tabindex="-1"></a>            trace5 <span class="op">=</span> go.Scatter(</span>
<span id="cb3-246"><a href="#cb3-246" aria-hidden="true" tabindex="-1"></a>                x<span class="op">=</span>sds_cal, </span>
<span id="cb3-247"><a href="#cb3-247" aria-hidden="true" tabindex="-1"></a>                y<span class="op">=</span>mns_cal, </span>
<span id="cb3-248"><a href="#cb3-248" aria-hidden="true" tabindex="-1"></a>                mode<span class="op">=</span><span class="st">"lines"</span>, </span>
<span id="cb3-249"><a href="#cb3-249" aria-hidden="true" tabindex="-1"></a>                text<span class="op">=</span><span class="dv">100</span> <span class="op">*</span> grid, </span>
<span id="cb3-250"><a href="#cb3-250" aria-hidden="true" tabindex="-1"></a>                hovertemplate<span class="op">=</span>string, </span>
<span id="cb3-251"><a href="#cb3-251" aria-hidden="true" tabindex="-1"></a>                line<span class="op">=</span><span class="bu">dict</span>(color<span class="op">=</span><span class="st">"blue"</span>),</span>
<span id="cb3-252"><a href="#cb3-252" aria-hidden="true" tabindex="-1"></a>                name<span class="op">=</span><span class="st">"CAL: "</span> <span class="op">+</span> portlabel</span>
<span id="cb3-253"><a href="#cb3-253" aria-hidden="true" tabindex="-1"></a>            )           </span>
<span id="cb3-254"><a href="#cb3-254" aria-hidden="true" tabindex="-1"></a>            fig.add_trace(trace5)</span>
<span id="cb3-255"><a href="#cb3-255" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb3-256"><a href="#cb3-256" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb3-257"><a href="#cb3-257" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb3-258"><a href="#cb3-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-259"><a href="#cb3-259" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (rb <span class="op">!=</span> rs) <span class="kw">and</span> ((gmv <span class="op">&gt;</span> rb) <span class="kw">or</span> (<span class="kw">not</span> Shorts)):</span>
<span id="cb3-260"><a href="#cb3-260" aria-hidden="true" tabindex="-1"></a>        portTang <span class="op">=</span> P.tangency(rb)</span>
<span id="cb3-261"><a href="#cb3-261" aria-hidden="true" tabindex="-1"></a>        mnTang <span class="op">=</span> portTang <span class="op">@</span> mns</span>
<span id="cb3-262"><a href="#cb3-262" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> mnTang <span class="op">&lt;</span> np.<span class="bu">max</span>(mns):</span>
<span id="cb3-263"><a href="#cb3-263" aria-hidden="true" tabindex="-1"></a>            sdTang <span class="op">=</span> np.sqrt(portTang <span class="op">@</span> cov <span class="op">@</span> portTang)</span>
<span id="cb3-264"><a href="#cb3-264" aria-hidden="true" tabindex="-1"></a>            srTang <span class="op">=</span> (mnTang <span class="op">-</span> rb)<span class="op">/</span>sdTang</span>
<span id="cb3-265"><a href="#cb3-265" aria-hidden="true" tabindex="-1"></a>            string <span class="op">=</span> <span class="st">'efficient high mean portfolio'</span></span>
<span id="cb3-266"><a href="#cb3-266" aria-hidden="true" tabindex="-1"></a>            string, cd <span class="op">=</span> custom(string, [portTang], srTang,<span class="dv">1</span>)</span>
<span id="cb3-267"><a href="#cb3-267" aria-hidden="true" tabindex="-1"></a>            trace <span class="op">=</span> go.Scatter(</span>
<span id="cb3-268"><a href="#cb3-268" aria-hidden="true" tabindex="-1"></a>                x<span class="op">=</span>[sdTang],</span>
<span id="cb3-269"><a href="#cb3-269" aria-hidden="true" tabindex="-1"></a>                y<span class="op">=</span>[mnTang],</span>
<span id="cb3-270"><a href="#cb3-270" aria-hidden="true" tabindex="-1"></a>                mode<span class="op">=</span><span class="st">"markers"</span>,</span>
<span id="cb3-271"><a href="#cb3-271" aria-hidden="true" tabindex="-1"></a>                customdata<span class="op">=</span>cd,</span>
<span id="cb3-272"><a href="#cb3-272" aria-hidden="true" tabindex="-1"></a>                hovertemplate<span class="op">=</span>string,</span>
<span id="cb3-273"><a href="#cb3-273" aria-hidden="true" tabindex="-1"></a>                marker<span class="op">=</span><span class="bu">dict</span>(size<span class="op">=</span><span class="dv">10</span>, color<span class="op">=</span><span class="st">"blue"</span>),</span>
<span id="cb3-274"><a href="#cb3-274" aria-hidden="true" tabindex="-1"></a>                name<span class="op">=</span><span class="st">"efficient high mean portfolio"</span></span>
<span id="cb3-275"><a href="#cb3-275" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb3-276"><a href="#cb3-276" aria-hidden="true" tabindex="-1"></a>            fig.add_trace(trace)</span>
<span id="cb3-277"><a href="#cb3-277" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb3-278"><a href="#cb3-278" aria-hidden="true" tabindex="-1"></a>            <span class="co">#Plot CAL (with leverage)            </span></span>
<span id="cb3-279"><a href="#cb3-279" aria-hidden="true" tabindex="-1"></a>            grid, mns_cal, sds_cal, srs_cal, srb_cal <span class="op">=</span> rf_plus_risky(mnTang<span class="op">*</span><span class="dv">100</span>, sdTang<span class="op">*</span><span class="dv">100</span>, rs<span class="op">*</span><span class="dv">100</span>,rb<span class="op">*</span><span class="dv">100</span>, <span class="fl">1.0</span>, <span class="fl">4.0</span>)</span>
<span id="cb3-280"><a href="#cb3-280" aria-hidden="true" tabindex="-1"></a>            string <span class="op">=</span> <span class="st">"wealth in efficient high mean portfolio = %</span><span class="sc">{text:.0f}</span><span class="st">%&lt;br&gt;"</span> <span class="op">+</span> <span class="st">"Sharpe ratio (relative to borrowing rate): "</span> <span class="op">+</span> <span class="st">"</span><span class="sc">{:.4f}</span><span class="st">"</span>.<span class="bu">format</span>(srTang) <span class="op">+</span><span class="st">"&lt;extra&gt;&lt;/extra&gt;"</span></span>
<span id="cb3-281"><a href="#cb3-281" aria-hidden="true" tabindex="-1"></a>            trace6 <span class="op">=</span> go.Scatter(</span>
<span id="cb3-282"><a href="#cb3-282" aria-hidden="true" tabindex="-1"></a>                x<span class="op">=</span>sds_cal, </span>
<span id="cb3-283"><a href="#cb3-283" aria-hidden="true" tabindex="-1"></a>                y<span class="op">=</span>mns_cal, </span>
<span id="cb3-284"><a href="#cb3-284" aria-hidden="true" tabindex="-1"></a>                mode<span class="op">=</span><span class="st">"lines"</span>, </span>
<span id="cb3-285"><a href="#cb3-285" aria-hidden="true" tabindex="-1"></a>                text<span class="op">=</span><span class="dv">100</span> <span class="op">*</span> grid, </span>
<span id="cb3-286"><a href="#cb3-286" aria-hidden="true" tabindex="-1"></a>                hovertemplate<span class="op">=</span>string,</span>
<span id="cb3-287"><a href="#cb3-287" aria-hidden="true" tabindex="-1"></a>                line<span class="op">=</span><span class="bu">dict</span>(color<span class="op">=</span><span class="st">"blue"</span>),</span>
<span id="cb3-288"><a href="#cb3-288" aria-hidden="true" tabindex="-1"></a>                name <span class="op">=</span> <span class="st">"CAL: efficient high mean"</span></span>
<span id="cb3-289"><a href="#cb3-289" aria-hidden="true" tabindex="-1"></a>            )           </span>
<span id="cb3-290"><a href="#cb3-290" aria-hidden="true" tabindex="-1"></a>            fig.add_trace(trace6)   </span>
<span id="cb3-291"><a href="#cb3-291" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb3-292"><a href="#cb3-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-293"><a href="#cb3-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-294"><a href="#cb3-294" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Utility plot info</span></span>
<span id="cb3-295"><a href="#cb3-295" aria-hidden="true" tabindex="-1"></a>    u1, wgt1, wgt_rf1, wgt_lo1, wgt_hi1 <span class="op">=</span> opt_utility(mns, cov, Shorts, rs, rb, raver1)</span>
<span id="cb3-296"><a href="#cb3-296" aria-hidden="true" tabindex="-1"></a>    u2, wgt2, wgt_rf2, wgt_lo2, wgt_hi2 <span class="op">=</span> opt_utility(mns, cov, Shorts, rs, rb, raver2)</span>
<span id="cb3-297"><a href="#cb3-297" aria-hidden="true" tabindex="-1"></a>    string1<span class="op">=</span><span class="st">'Risk Aversion='</span><span class="op">+</span><span class="bu">str</span>(raver1)</span>
<span id="cb3-298"><a href="#cb3-298" aria-hidden="true" tabindex="-1"></a>    string2<span class="op">=</span><span class="st">'Risk Aversion='</span><span class="op">+</span><span class="bu">str</span>(raver2)</span>
<span id="cb3-299"><a href="#cb3-299" aria-hidden="true" tabindex="-1"></a>    grid <span class="op">=</span> np.linspace(<span class="dv">0</span>,<span class="fl">1.4</span>,<span class="dv">100</span>)</span>
<span id="cb3-300"><a href="#cb3-300" aria-hidden="true" tabindex="-1"></a>    sds <span class="op">=</span> [w<span class="op">*</span>np.<span class="bu">max</span>(sds) <span class="cf">for</span> w <span class="kw">in</span> grid]</span>
<span id="cb3-301"><a href="#cb3-301" aria-hidden="true" tabindex="-1"></a>    eret1 <span class="op">=</span> [u1 <span class="op">+</span> <span class="fl">0.5</span><span class="op">*</span>raver1<span class="op">*</span> (sd<span class="op">**</span><span class="dv">2</span>) <span class="cf">for</span> sd <span class="kw">in</span> sds]</span>
<span id="cb3-302"><a href="#cb3-302" aria-hidden="true" tabindex="-1"></a>    eret2 <span class="op">=</span> [u2 <span class="op">+</span> <span class="fl">0.5</span><span class="op">*</span>raver2<span class="op">*</span> (sd<span class="op">**</span><span class="dv">2</span>) <span class="cf">for</span> sd <span class="kw">in</span> sds] </span>
<span id="cb3-303"><a href="#cb3-303" aria-hidden="true" tabindex="-1"></a>    <span class="co"># df = pd.DataFrame(data={'Standard Deviation': sds, string1: U1, string2: U2})</span></span>
<span id="cb3-304"><a href="#cb3-304" aria-hidden="true" tabindex="-1"></a>    string <span class="op">=</span> <span class="st">"indifference curve for &lt;br&gt; optimal utility for risk aversion of "</span><span class="op">+</span><span class="bu">str</span>(np.<span class="bu">round</span>(raver1,<span class="dv">1</span>))<span class="op">+</span><span class="st">"&lt;extra&gt;&lt;/extra&gt;"</span></span>
<span id="cb3-305"><a href="#cb3-305" aria-hidden="true" tabindex="-1"></a>    trace7 <span class="op">=</span> go.Scatter(</span>
<span id="cb3-306"><a href="#cb3-306" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span>sds, y<span class="op">=</span>eret1, mode<span class="op">=</span><span class="st">"lines"</span>, hovertemplate<span class="op">=</span>string, name<span class="op">=</span>string1, line<span class="op">=</span><span class="bu">dict</span>(color<span class="op">=</span><span class="st">"purple"</span>,dash<span class="op">=</span><span class="st">'dot'</span>),</span>
<span id="cb3-307"><a href="#cb3-307" aria-hidden="true" tabindex="-1"></a>    )  </span>
<span id="cb3-308"><a href="#cb3-308" aria-hidden="true" tabindex="-1"></a>    string <span class="op">=</span> <span class="st">"indifference curve for &lt;br&gt; optimal utility for risk aversion of "</span><span class="op">+</span><span class="bu">str</span>(np.<span class="bu">round</span>(raver2,<span class="dv">1</span>))<span class="op">+</span><span class="st">"&lt;extra&gt;&lt;/extra&gt;"</span></span>
<span id="cb3-309"><a href="#cb3-309" aria-hidden="true" tabindex="-1"></a>    trace8 <span class="op">=</span> go.Scatter(</span>
<span id="cb3-310"><a href="#cb3-310" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span>sds, y<span class="op">=</span>eret2, mode<span class="op">=</span><span class="st">"lines"</span>, hovertemplate<span class="op">=</span>string, name<span class="op">=</span>string2, line<span class="op">=</span><span class="bu">dict</span>(color<span class="op">=</span><span class="st">"purple"</span>),</span>
<span id="cb3-311"><a href="#cb3-311" aria-hidden="true" tabindex="-1"></a>    )  </span>
<span id="cb3-312"><a href="#cb3-312" aria-hidden="true" tabindex="-1"></a>    fig.add_trace(trace7) </span>
<span id="cb3-313"><a href="#cb3-313" aria-hidden="true" tabindex="-1"></a>    fig.add_trace(trace8) </span>
<span id="cb3-314"><a href="#cb3-314" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb3-315"><a href="#cb3-315" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-316"><a href="#cb3-316" aria-hidden="true" tabindex="-1"></a>    fig.layout.xaxis[<span class="st">"title"</span>] <span class="op">=</span> <span class="st">"Standard Deviation"</span></span>
<span id="cb3-317"><a href="#cb3-317" aria-hidden="true" tabindex="-1"></a>    fig.layout.yaxis[<span class="st">"title"</span>] <span class="op">=</span> <span class="st">"Expected Return"</span></span>
<span id="cb3-318"><a href="#cb3-318" aria-hidden="true" tabindex="-1"></a>    fig.update_xaxes(<span class="bu">range</span><span class="op">=</span>[<span class="dv">0</span>, <span class="fl">1.25</span> <span class="op">*</span> df[<span class="st">"stdev"</span>].<span class="bu">max</span>()])</span>
<span id="cb3-319"><a href="#cb3-319" aria-hidden="true" tabindex="-1"></a>    fig.update_yaxes(<span class="bu">range</span><span class="op">=</span>[<span class="dv">0</span>, <span class="fl">1.25</span> <span class="op">*</span> df[<span class="st">"mean"</span>].<span class="bu">max</span>()])</span>
<span id="cb3-320"><a href="#cb3-320" aria-hidden="true" tabindex="-1"></a>    fig.update_yaxes(tickformat<span class="op">=</span><span class="st">".0%"</span>)</span>
<span id="cb3-321"><a href="#cb3-321" aria-hidden="true" tabindex="-1"></a>    fig.update_xaxes(tickformat<span class="op">=</span><span class="st">".0%"</span>)</span>
<span id="cb3-322"><a href="#cb3-322" aria-hidden="true" tabindex="-1"></a>    fig.update_layout(legend<span class="op">=</span><span class="bu">dict</span>(yanchor<span class="op">=</span><span class="st">"top"</span>, y <span class="op">=</span><span class="fl">0.55</span>, xanchor<span class="op">=</span><span class="st">"left"</span>, x<span class="op">=</span><span class="fl">0.6</span>))</span>
<span id="cb3-323"><a href="#cb3-323" aria-hidden="true" tabindex="-1"></a>    fig.show()</span>
<span id="cb3-324"><a href="#cb3-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-325"><a href="#cb3-325" aria-hidden="true" tabindex="-1"></a>figtbl(mn_stock,mn_bond,sd_stock,sd_bond,corr,rs,extra,raver1, raver2, <span class="st">"Stock"</span>,<span class="st">"Bond"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-diffsaveborrow-and-preferences" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">

<div>                            <div id="3177900e-a354-45e2-ae0e-678006b07960" class="plotly-graph-div" style="height:525px; width:100%;"></div>            <script type="text/javascript">                require(["plotly"], function(Plotly) {                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("3177900e-a354-45e2-ae0e-678006b07960")) {                    Plotly.newPlot(                        "3177900e-a354-45e2-ae0e-678006b07960",                        [{"hovertemplate":"%{text}<extra></extra>","marker":{"color":"orange","size":10},"mode":"markers","name":"Stock","text":["Stock"],"x":[0.15],"y":[0.06],"type":"scatter"},{"hovertemplate":"%{text}<extra></extra>","marker":{"color":"red","size":10},"mode":"markers","name":"Bond","text":["Bond"],"x":[0.035],"y":[0.035],"type":"scatter"},{"customdata":[100.0,99.0,98.0,97.0,96.0,95.0,94.0,93.0,92.0,91.0,90.0,89.0,88.0,87.0,86.0,85.0,84.0,83.0,82.0,81.0,80.0,79.0,78.0,77.0,76.0,75.0,74.0,73.0,72.0,71.0,70.0,69.0,68.0,67.0,65.99999999999999,64.99999999999999,64.0,63.0,62.0,61.0,60.0,59.0,58.00000000000001,57.00000000000001,56.00000000000001,55.00000000000001,54.0,53.0,52.0,51.0,50.0,49.0,48.0,47.0,46.0,44.99999999999999,43.99999999999999,42.99999999999999,42.00000000000001,41.0,40.0,39.0,38.0,37.0,36.0,35.0,34.0,32.99999999999999,31.999999999999996,30.999999999999993,29.999999999999993,29.000000000000004,28.000000000000004,27.0,26.0,25.0,24.0,23.0,21.999999999999996,20.999999999999996,19.999999999999996,18.999999999999993,17.999999999999993,16.999999999999993,16.000000000000004,15.000000000000002,14.000000000000002,13.0,12.0,10.999999999999998,9.999999999999998,8.999999999999996,7.9999999999999964,6.999999999999995,5.999999999999995,4.999999999999993,4.0000000000000036,3.0000000000000027,2.0000000000000018,1.0000000000000009,0.0],"hovertemplate":"Stock: %{text:.0f}%<br>Bond: %{customdata:.0f}%<extra></extra>","line":{"color":"black"},"mode":"lines","name":"Stock & Bond Frontier","text":[0.0,1.0,2.0,3.0,4.0,5.0,6.0,7.000000000000001,8.0,9.0,10.0,11.0,12.0,13.0,14.000000000000002,15.0,16.0,17.0,18.0,19.0,20.0,21.0,22.0,23.0,24.0,25.0,26.0,27.0,28.000000000000004,28.999999999999996,30.0,31.0,32.0,33.0,34.0,35.0,36.0,37.0,38.0,39.0,40.0,41.0,42.0,43.0,44.0,45.0,46.0,47.0,48.0,49.0,50.0,51.0,52.0,53.0,54.0,55.00000000000001,56.00000000000001,57.00000000000001,57.99999999999999,59.0,60.0,61.0,62.0,63.0,64.0,65.0,66.0,67.0,68.0,69.0,70.0,71.0,72.0,73.0,74.0,75.0,76.0,77.0,78.0,79.0,80.0,81.0,82.0,83.0,84.0,85.0,86.0,87.0,88.0,89.0,90.0,91.0,92.0,93.0,94.0,95.0,96.0,97.0,98.0,99.0,100.0],"x":[0.035,0.034607441396324,0.034281190177705326,0.03402315388085002,0.033834893231692045,0.03371757701852254,0.03367194678066595,0.03369829372535055,0.033796449517663835,0.033965791614505324,0.03420526275297414,0.03451340319354207,0.0348883934855132,0.035328104959083215,0.03583015489779524,0.03639196339853072,0.03701080923189872,0.03768388249636706,0.03840833242930498,0.039181309319623304,0.04,0.04086165684354955,0.04176362053270765,0.04270333710613258,0.04367836993295422,0.0446864073292987,0.04572526653831556,0.04679289475978164,0.0478873678541638,0.0490068872710765,0.05014977567247933,0.05131447164299756,0.052499523807364196,0.053703584610340485,0.05492540395845988,0.056163822875584246,0.057417767285048625,0.05868624199929656,0.05996832497243858,0.061263161851148364,0.06256996084384263,0.06388798791635249,0.06521656231357185,0.06655505240024982,0.06790287180966649,0.06925947588597534,0.07062435840416534,0.07199704855061768,0.07337710814688733,0.07476412909945516,0.07615773105863909,0.07755755927051858,0.07896328260653808,0.08037459175635046,0.08179119757039874,0.08321282953968097,0.0846392344010743,0.08607017485749636,0.08750542840304253,0.08894478624405142,0.09038805230781334,0.09183504233134539,0.09328558302331609,0.09473951129280751,0.09619667353916142,0.09765692499766722,0.0991201291363162,0.10058615709927485,0.10205488719311781,0.10352620441221633,0.10500000000000002,0.1064761710431024,0.10795462009566797,0.10943525483133851,0.11091798772065782,0.11240273573183172,0.1138894200529619,0.11537796583403609,0.11686830194710626,0.11836036076322173,0.11985407794480754,0.12134939225228943,0.1228462453638694,0.12434458170744715,0.1258443483037677,0.12734549461995112,0.12884797243263083,0.1303517356999898,0.13185674044204188,0.13336294462855863,0.1348703080740902,0.13637879233957162,0.13788836064004822,0.1393989777580883,0.1409106099624865,0.14242322493189094,0.14393679168301618,0.14545128050312928,0.14696666288651994,0.1484829114746879,0.15],"y":[0.035,0.03525,0.0355,0.03575,0.036,0.03625,0.0365,0.03675,0.037000000000000005,0.03725,0.0375,0.03775,0.038,0.03825,0.0385,0.03875,0.039,0.03925,0.0395,0.03975000000000001,0.04,0.04025,0.0405,0.04075,0.040999999999999995,0.04125,0.0415,0.041749999999999995,0.042,0.042249999999999996,0.0425,0.042749999999999996,0.043,0.04324999999999999,0.0435,0.04375,0.044000000000000004,0.04425,0.044500000000000005,0.04475,0.045,0.04524999999999999,0.045500000000000006,0.04575,0.046000000000000006,0.04625,0.04650000000000001,0.04675000000000001,0.047,0.04724999999999999,0.0475,0.04775,0.048,0.04825,0.048499999999999995,0.04875,0.049,0.049249999999999995,0.049499999999999995,0.04975,0.05,0.05025,0.050499999999999996,0.05075,0.051,0.05125,0.0515,0.051750000000000004,0.052000000000000005,0.052250000000000005,0.0525,0.052750000000000005,0.053000000000000005,0.05325,0.0535,0.05375,0.054000000000000006,0.05425,0.05449999999999999,0.05474999999999999,0.05500000000000001,0.05525,0.0555,0.05575,0.05600000000000001,0.05625,0.0565,0.056749999999999995,0.057,0.057249999999999995,0.0575,0.057749999999999996,0.05800000000000001,0.05825,0.0585,0.05875,0.059000000000000004,0.059250000000000004,0.059500000000000004,0.05975,0.06],"type":"scatter"},{"customdata":[[[0.13203429462197971],[0.8679657053780202],[0.5166]]],"hovertemplate":"efficient low risk portfolio<br>asset 1: %{customdata[0]:.1%}<br>asset 2: %{customdata[1]:.1%}<br>Sharpe ratio: %{customdata[2]:.4f}<br><extra></extra>","marker":{"color":"blue","size":10},"mode":"markers","name":"efficient low risk portfolio","x":[0.03542526719998681],"y":[0.038300857365549494],"type":"scatter"},{"hovertemplate":"wealth in efficient low risk portfolio = %{text:.0f}%<br>Sharpe ratio: 0.5166<extra></extra>","line":{"color":"blue"},"mode":"lines","name":"CAL: efficient low risk portfolio","text":[0.0,0.5,1.0,1.5,2.0,2.5,3.0,3.5000000000000004,4.0,4.5,5.0,5.5,6.0,6.5,7.000000000000001,7.5,8.0,8.5,9.0,9.5,10.0,10.5,11.0,11.5,12.0,12.5,13.0,13.5,14.000000000000002,14.499999999999998,15.0,15.5,16.0,16.5,17.0,17.5,18.0,18.5,19.0,19.5,20.0,20.5,21.0,21.5,22.0,22.5,23.0,23.5,24.0,24.5,25.0,25.5,26.0,26.5,27.0,27.500000000000004,28.000000000000004,28.500000000000004,28.999999999999996,29.5,30.0,30.5,31.0,31.5,32.0,32.5,33.0,33.5,34.0,34.5,35.0,35.5,36.0,36.5,37.0,37.5,38.0,38.5,39.0,39.5,40.0,40.5,41.0,41.5,42.0,42.5,43.0,43.5,44.0,44.5,45.0,45.5,46.0,46.5,47.0,47.5,48.0,48.5,49.0,49.5,50.0,50.5,51.0,51.5,52.0,52.5,53.0,53.5,54.0,54.50000000000001,55.00000000000001,55.50000000000001,56.00000000000001,56.50000000000001,57.00000000000001,57.50000000000001,57.99999999999999,58.5,59.0,59.5,60.0,60.5,61.0,61.5,62.0,62.5,63.0,63.5,64.0,64.5,65.0,65.5,66.0,66.5,67.0,67.5,68.0,68.5,69.0,69.5,70.0,70.5,71.0,71.5,72.0,72.5,73.0,73.5,74.0,74.5,75.0,75.5,76.0,76.5,77.0,77.5,78.0,78.5,79.0,79.5,80.0,80.5,81.0,81.5,82.0,82.5,83.0,83.5,84.0,84.5,85.0,85.5,86.0,86.5,87.0,87.5,88.0,88.5,89.0,89.5,90.0,90.5,91.0,91.5,92.0,92.5,93.0,93.5,94.0,94.5,95.0,95.5,96.0,96.5,97.0,97.5,98.0,98.5,99.0,99.5,100.0],"x":[0.0,0.00017712633599993404,0.0003542526719998681,0.0005313790079998021,0.0007085053439997361,0.0008856316799996703,0.0010627580159996042,0.0012398843519995384,0.0014170106879994723,0.0015941370239994062,0.0017712633599993406,0.0019483896959992745,0.0021255160319992084,0.0023026423679991426,0.0024797687039990767,0.0026568950399990104,0.0028340213759989446,0.0030111477119988787,0.0031882740479988124,0.003365400383998747,0.003542526719998681,0.003719653055998615,0.003896779391998549,0.004073905727998483,0.004251032063998417,0.004428158399998351,0.004605284735998285,0.004782411071998219,0.0049595374079981535,0.005136663743998087,0.005313790079998021,0.005490916415997955,0.005668042751997889,0.005845169087997823,0.0060222954239977575,0.006199421759997692,0.006376548095997625,0.006553674431997559,0.006730800767997494,0.006907927103997428,0.007085053439997362,0.0072621797759972965,0.00743930611199723,0.007616432447997164,0.007793558783997098,0.007970685119997031,0.008147811455996965,0.0083249377919969,0.008502064127996834,0.008679190463996768,0.008856316799996702,0.009033443135996636,0.00921056947199657,0.009387695807996504,0.009564822143996439,0.009741948479996373,0.009919074815996307,0.010096201151996241,0.010273327487996173,0.010450453823996108,0.010627580159996042,0.010804706495995976,0.01098183283199591,0.011158959167995844,0.011336085503995778,0.011513211839995713,0.011690338175995647,0.01186746451199558,0.012044590847995515,0.012221717183995449,0.012398843519995383,0.012575969855995316,0.01275309619199525,0.012930222527995184,0.013107348863995118,0.013284475199995052,0.013461601535994988,0.013638727871994922,0.013815854207994856,0.01399298054399479,0.014170106879994725,0.014347233215994659,0.014524359551994593,0.014701485887994527,0.01487861222399446,0.015055738559994394,0.015232864895994328,0.015409991231994262,0.015587117567994196,0.01576424390399413,0.015941370239994063,0.016118496575994,0.01629562291199393,0.016472749247993867,0.0166498755839938,0.016827001919993735,0.017004128255993668,0.0171812545919936,0.017358380927993536,0.017535507263993468,0.017712633599993404,0.01788975993599334,0.018066886271993272,0.01824401260799321,0.01842113894399314,0.018598265279993077,0.01877539161599301,0.018952517951992945,0.019129644287992877,0.019306770623992813,0.019483896959992746,0.01966102329599268,0.019838149631992614,0.02001527596799255,0.020192402303992482,0.020369528639992418,0.020546654975992347,0.020723781311992283,0.020900907647992215,0.02107803398399215,0.021255160319992084,0.02143228665599202,0.021609412991991952,0.021786539327991888,0.02196366566399182,0.022140791999991756,0.02231791833599169,0.022495044671991624,0.022672171007991557,0.022849297343991493,0.023026423679991425,0.02320355001599136,0.023380676351991293,0.02355780268799123,0.02373492902399116,0.023912055359991097,0.02408918169599103,0.024266308031990966,0.024443434367990898,0.024620560703990834,0.024797687039990766,0.0249748133759907,0.02515193971199063,0.025329066047990567,0.0255061923839905,0.025683318719990435,0.025860445055990368,0.026037571391990304,0.026214697727990236,0.026391824063990172,0.026568950399990104,0.02674607673599004,0.026923203071989976,0.02710032940798991,0.027277455743989844,0.027454582079989777,0.027631708415989713,0.027808834751989645,0.02798596108798958,0.028163087423989513,0.02834021375998945,0.028517340095989382,0.028694466431989318,0.02887159276798925,0.029048719103989186,0.02922584543998912,0.029402971775989054,0.029580098111988983,0.02975722444798892,0.02993435078398885,0.030111477119988787,0.03028860345598872,0.030465729791988656,0.030642856127988588,0.030819982463988524,0.030997108799988456,0.031174235135988392,0.031351361471988325,0.03152848780798826,0.031705614143988196,0.031882740479988125,0.03205986681598806,0.032236993151988,0.03241411948798793,0.03259124582398786,0.0327683721599878,0.032945498495987734,0.03312262483198767,0.0332997511679876,0.033476877503987534,0.03365400383998747,0.033831130175987406,0.034008256511987335,0.03418538284798727,0.0343625091839872,0.034539635519987136,0.03471676185598707,0.03489388819198701,0.035071014527986936,0.03524814086398687,0.03542526719998681],"y":[0.02,0.02009150428682775,0.020183008573655497,0.02027451286048324,0.02036601714731099,0.020457521434138738,0.020549025720966486,0.02064053000779423,0.02073203429462198,0.020823538581449728,0.020915042868277476,0.02100654715510522,0.02109805144193297,0.021189555728760717,0.021281060015588465,0.021372564302416214,0.02146406858924396,0.021555572876071707,0.021647077162899455,0.021738581449727203,0.021830085736554948,0.021921590023382696,0.022013094310210445,0.022104598597038193,0.02219610288386594,0.022287607170693686,0.022379111457521434,0.022470615744349182,0.02256212003117693,0.022653624318004675,0.022745128604832424,0.022836632891660172,0.02292813717848792,0.02301964146531567,0.023111145752143413,0.02320265003897116,0.02329415432579891,0.023385658612626658,0.023477162899454403,0.02356866718628215,0.0236601714731099,0.023751675759937647,0.023843180046765396,0.02393468433359314,0.02402618862042089,0.024117692907248637,0.024209197194076385,0.02430070148090413,0.024392205767731878,0.024483710054559626,0.024575214341387375,0.024666718628215123,0.024758222915042868,0.024849727201870616,0.024941231488698364,0.025032735775526112,0.025124240062353857,0.025215744349181606,0.025307248636009354,0.025398752922837102,0.02549025720966485,0.025581761496492595,0.025673265783320343,0.02576477007014809,0.02585627435697584,0.025947778643803585,0.026039282930631333,0.02613078721745908,0.02622229150428683,0.026313795791114578,0.026405300077942326,0.02649680436477007,0.02658830865159782,0.026679812938425564,0.026771317225253312,0.02686282151208106,0.02695432579890881,0.027045830085736557,0.027137334372564305,0.02722883865939205,0.027320342946219798,0.027411847233047546,0.027503351519875294,0.02759485580670304,0.027686360093530787,0.027777864380358536,0.027869368667186284,0.027960872954014032,0.028052377240841777,0.028143881527669525,0.028235385814497273,0.028326890101325018,0.028418394388152766,0.028509898674980515,0.028601402961808263,0.02869290724863601,0.02878441153546376,0.028875915822291504,0.028967420109119252,0.029058924395946997,0.029150428682774746,0.029241932969602494,0.029333437256430242,0.02942494154325799,0.02951644583008574,0.029607950116913487,0.029699454403741235,0.02979095869056898,0.029882462977396728,0.029973967264224473,0.03006547155105222,0.03015697583787997,0.030248480124707718,0.030339984411535466,0.030431488698363214,0.030522992985190962,0.030614497272018704,0.030706001558846452,0.0307975058456742,0.03088901013250195,0.030980514419329697,0.031072018706157445,0.031163522992985193,0.03125502727981294,0.03134653156664069,0.03143803585346844,0.03152954014029618,0.03162104442712393,0.031712548713951676,0.031804053000779424,0.03189555728760717,0.03198706157443492,0.03207856586126267,0.03217007014809042,0.03226157443491816,0.032353078721745906,0.032444583008573655,0.0325360872954014,0.03262759158222915,0.0327190958690569,0.03281060015588465,0.032902104442712396,0.032993608729540144,0.033085113016367886,0.033176617303195634,0.03326812159002338,0.03335962587685113,0.03345113016367888,0.03354263445050663,0.033634138737334375,0.033725643024162116,0.033817147310989865,0.03390865159781761,0.03400015588464536,0.03409166017147311,0.03418316445830086,0.034274668745128606,0.034366173031956354,0.0344576773187841,0.03454918160561185,0.0346406858924396,0.03473219017926735,0.034823694466095095,0.03491519875292284,0.035006703039750585,0.03509820732657833,0.03518971161340608,0.03528121590023382,0.03537272018706157,0.03546422447388932,0.03555572876071707,0.035647233047544816,0.035738737334372564,0.03583024162120031,0.03592174590802806,0.03601325019485581,0.03610475448168356,0.036196258768511305,0.03628776305533905,0.0363792673421668,0.03647077162899455,0.03656227591582229,0.03665378020265004,0.03674528448947779,0.036836788776305536,0.036928293063133284,0.037019797349961026,0.037111301636788774,0.03720280592361652,0.03729431021044427,0.03738581449727202,0.03747731878409977,0.037568823070927515,0.03766032735775526,0.03775183164458301,0.03784333593141076,0.03793484021823851,0.038026344505066256,0.038117848791894,0.038209353078721746,0.038300857365549494],"type":"scatter"},{"customdata":[[[0.3511182108626197],[0.6488817891373803],[0.2003]]],"hovertemplate":"efficient high mean portfolio<br>asset 1: %{customdata[0]:.1%}<br>asset 2: %{customdata[1]:.1%}<br>Sharpe ratio (relative to borrowing rate): %{customdata[2]:.4f}<br><extra></extra>","marker":{"color":"blue","size":10},"mode":"markers","name":"efficient high mean portfolio","x":[0.05630328830688628],"y":[0.04377795527156549],"type":"scatter"},{"hovertemplate":"wealth in efficient high mean portfolio = %{text:.0f}%<br>Sharpe ratio (relative to borrowing rate): 0.2003<extra></extra>","line":{"color":"blue"},"mode":"lines","name":"CAL: efficient high mean","text":[100.0,101.49999999999999,103.0,104.5,106.0,107.5,109.00000000000001,110.5,112.00000000000001,113.5,114.99999999999999,116.5,118.0,119.5,121.0,122.50000000000001,124.0,125.49999999999999,127.0,128.5,130.0,131.5,133.0,134.5,136.0,137.5,139.0,140.5,142.0,143.5,145.0,146.5,148.0,149.5,151.0,152.5,154.0,155.5,156.99999999999997,158.5,160.0,161.5,163.0,164.5,166.0,167.49999999999997,169.0,170.5,172.0,173.5,175.0,176.5,178.0,179.5,181.0,182.5,184.0,185.5,187.0,188.5,190.0,191.5,193.0,194.49999999999997,196.0,197.5,199.0,200.5,202.0,203.5,204.99999999999997,206.5,208.0,209.49999999999997,211.0,212.5,213.99999999999997,215.50000000000003,217.0,218.5,220.00000000000003,221.5,223.0,224.5,225.99999999999997,227.5,229.0,230.49999999999997,231.99999999999997,233.5,234.99999999999997,236.50000000000003,238.0,239.5,241.0,242.49999999999997,244.0,245.5,246.99999999999997,248.5,250.0,251.49999999999997,253.00000000000003,254.5,256.0,257.5,259.0,260.5,262.0,263.5,265.0,266.5,268.0,269.5,271.0,272.49999999999994,274.0,275.5,277.0,278.5,280.0,281.5,283.0,284.5,286.0,287.5,288.99999999999994,290.5,292.0,293.49999999999994,295.0,296.5,298.0,299.5,301.0,302.5,304.0,305.5,307.0,308.5,310.0,311.5,313.0,314.5,316.0,317.5,319.0,320.5,322.0,323.5,325.0,326.5,328.0,329.5,331.0,332.5,334.0,335.5,337.0,338.5,340.0,341.5,343.0,344.5,346.0,347.5,349.0,350.5,352.0,353.49999999999994,355.0,356.5,358.0,359.5,361.0,362.5,363.99999999999994,365.5,367.0,368.5,370.0,371.5,373.0,374.5,376.0,377.5,379.0,380.5,382.0,383.5,385.0,386.5,388.0,389.5,390.99999999999994,392.5,394.0,395.5,397.0,398.5,400.0],"x":[0.05630328830688627,0.05714783763148956,0.057992386956092865,0.05883693628069615,0.059681485605299456,0.060526034929902744,0.06137058425450604,0.06221513357910933,0.06305968290371264,0.06390423222831593,0.06474878155291922,0.0655933308775225,0.06643788020212579,0.0672824295267291,0.06812697885133238,0.06897152817593569,0.06981607750053898,0.07066062682514226,0.07150517614974557,0.07234972547434886,0.07319427479895216,0.07403882412355545,0.07488337344815875,0.07572792277276204,0.07657247209736533,0.07741702142196863,0.07826157074657193,0.07910612007117522,0.07995066939577851,0.08079521872038181,0.0816397680449851,0.08248431736958839,0.08332886669419168,0.08417341601879498,0.08501796534339827,0.08586251466800156,0.08670706399260486,0.08755161331720815,0.08839616264181144,0.08924071196641474,0.09008526129101804,0.09092981061562133,0.09177435994022462,0.09261890926482792,0.09346345858943121,0.0943080079140345,0.0951525572386378,0.0959971065632411,0.0968416558878444,0.09768620521244768,0.09853075453705099,0.09937530386165427,0.10021985318625756,0.10106440251086085,0.10190895183546415,0.10275350116006744,0.10359805048467073,0.10444259980927403,0.10528714913387734,0.10613169845848063,0.10697624778308391,0.10782079710768722,0.1086653464322905,0.1095098957568938,0.1103544450814971,0.1111989944061004,0.11204354373070369,0.11288809305530698,0.11373264237991028,0.11457719170451357,0.11542174102911686,0.11626629035372014,0.11711083967832345,0.11795538900292672,0.11879993832753002,0.11964448765213333,0.1204890369767366,0.12133358630133993,0.12217813562594321,0.12302268495054651,0.12386723427514981,0.12471178359975309,0.1255563329243564,0.12640088224895968,0.12724543157356297,0.12808998089816626,0.12893453022276957,0.12977907954737283,0.13062362887197615,0.13146817819657944,0.13231272752118273,0.13315727684578604,0.13400182617038933,0.13484637549499262,0.13569092481959594,0.1365354741441992,0.13738002346880251,0.1382245727934058,0.1390691221180091,0.13991367144261238,0.14075822076721567,0.14160277009181896,0.14244731941642227,0.14329186874102556,0.14413641806562885,0.14498096739023217,0.14582551671483543,0.14667006603943875,0.14751461536404203,0.14835916468864532,0.1492037140132486,0.15004826333785193,0.1508928126624552,0.1517373619870585,0.1525819113116618,0.15342646063626508,0.1542710099608684,0.1551155592854717,0.15596010861007498,0.15680465793467827,0.15764920725928155,0.15849375658388484,0.15933830590848816,0.16018285523309142,0.16102740455769474,0.16187195388229803,0.16271650320690131,0.16356105253150463,0.16440560185610792,0.16525015118071118,0.16609470050531452,0.16693924982991779,0.1677837991545211,0.1686283484791244,0.16947289780372768,0.17031744712833097,0.17116199645293428,0.17200654577753755,0.17285109510214086,0.17369564442674415,0.17454019375134744,0.17538474307595073,0.17622929240055402,0.17707384172515733,0.17791839104976062,0.1787629403743639,0.1796074896989672,0.18045203902357052,0.18129658834817378,0.1821411376727771,0.18298568699738038,0.1838302363219837,0.18467478564658696,0.18551933497119028,0.18636388429579356,0.18720843362039685,0.18805298294500014,0.18889753226960346,0.18974208159420675,0.19058663091881003,0.19143118024341332,0.1922757295680166,0.1931202788926199,0.1939648282172232,0.1948093775418265,0.1956539268664298,0.19649847619103308,0.19734302551563637,0.1981875748402397,0.19903212416484295,0.19987667348944627,0.20072122281404955,0.20156577213865287,0.20241032146325613,0.20325487078785945,0.20409942011246274,0.20494396943706603,0.20578851876166931,0.20663306808627263,0.20747761741087592,0.2083221667354792,0.2091667160600825,0.21001126538468579,0.2108558147092891,0.21170036403389236,0.21254491335849568,0.21338946268309897,0.21423401200770226,0.21507856133230555,0.21592311065690886,0.21676765998151215,0.21761220930611544,0.21845675863071873,0.21930130795532204,0.2201458572799253,0.22099040660452862,0.2218349559291319,0.22267950525373523,0.2235240545783385,0.2243686039029418,0.2252131532275451],"y":[0.04377795527156549,0.04394712460063897,0.04411629392971246,0.04428546325878594,0.04445463258785942,0.0446238019169329,0.04479297124600639,0.04496214057507987,0.04513130990415335,0.04530047923322683,0.04546964856230032,0.0456388178913738,0.04580798722044728,0.04597715654952077,0.04614632587859425,0.04631549520766773,0.04648466453674121,0.04665383386581469,0.04682300319488818,0.04699217252396166,0.04716134185303514,0.047330511182108626,0.047499680511182106,0.04766884984025559,0.04783801916932907,0.04800718849840255,0.048176357827476035,0.048345527156549516,0.048514696485622996,0.048683865814696484,0.048853035143769964,0.049022204472843445,0.04919137380191693,0.04936054313099041,0.04952971246006389,0.049698881789137374,0.049868051118210854,0.05003722044728434,0.05020638977635782,0.0503755591054313,0.05054472843450479,0.05071389776357827,0.05088306709265175,0.05105223642172524,0.05122140575079871,0.0513905750798722,0.05155974440894568,0.05172891373801916,0.05189808306709265,0.05206725239616613,0.05223642172523961,0.0524055910543131,0.05257476038338658,0.05274392971246006,0.052913099041533546,0.05308226837060702,0.05325143769968051,0.05342060702875399,0.05358977635782747,0.053758945686900955,0.053928115015974436,0.054097284345047916,0.054266453674121404,0.05443562300319488,0.054604792332268365,0.05477396166134185,0.054943130990415326,0.05511230031948881,0.055281469648562294,0.055450638977635774,0.05561980830670926,0.055788977635782735,0.05595814696485622,0.056127316293929704,0.056296485623003184,0.05646565495207667,0.056634824281150145,0.05680399361022364,0.05697316293929712,0.0571423322683706,0.05731150159744408,0.05748067092651756,0.05764984025559104,0.05781900958466453,0.05798817891373801,0.05815734824281149,0.05832651757188498,0.05849568690095845,0.05866485623003194,0.05883402555910543,0.0590031948881789,0.05917236421725239,0.05934153354632587,0.05951070287539935,0.059679872204472836,0.05984904153354632,0.0600182108626198,0.060187380191693285,0.06035654952076676,0.060525718849840246,0.06069488817891373,0.06086405750798721,0.061033226837060695,0.061202396166134175,0.061371565495207656,0.06154073482428114,0.061709904153354624,0.061879073482428104,0.06204824281150159,0.062217412140575065,0.06238658146964855,0.06255575079872204,0.06272492012779551,0.062894089456869,0.06306325878594249,0.06323242811501596,0.06340159744408945,0.06357076677316292,0.06373993610223641,0.0639091054313099,0.06407827476038339,0.06424744408945686,0.06441661341853033,0.06458578274760382,0.06475495207667731,0.0649241214057508,0.06509329073482427,0.06526246006389776,0.06543162939297123,0.06560079872204472,0.0657699680511182,0.06593913738019168,0.06610830670926517,0.06627747603833864,0.06644664536741213,0.06661581469648561,0.0667849840255591,0.06695415335463258,0.06712332268370605,0.06729249201277954,0.06746166134185302,0.06763083067092651,0.06779999999999999,0.06796916932907347,0.06813833865814695,0.06830750798722043,0.06847667731629392,0.06864584664536741,0.06881501597444088,0.06898418530351436,0.06915335463258784,0.06932252396166133,0.06949169329073482,0.06966086261980829,0.06983003194888178,0.06999920127795525,0.07016837060702874,0.07033753993610223,0.07050670926517572,0.07067587859424919,0.07084504792332266,0.07101421725239615,0.07118338658146964,0.07135255591054313,0.0715217252396166,0.07169089456869009,0.07186006389776356,0.07202923322683705,0.07219840255591053,0.07236757188498401,0.0725367412140575,0.07270591054313097,0.07287507987220446,0.07304424920127794,0.07321341853035143,0.0733825878594249,0.07355175718849838,0.07372092651757187,0.07389009584664535,0.07405926517571884,0.07422843450479231,0.0743976038338658,0.07456677316293928,0.07473594249201276,0.07490511182108625,0.07507428115015974,0.07524345047923321,0.07541261980830669,0.07558178913738017,0.07575095846645366,0.07592012779552715,0.07608929712460062,0.07625846645367411,0.07642763578274758,0.07659680511182107,0.07676597444089456,0.07693514376996805,0.07710431309904152,0.07727348242811499,0.07744265175718848,0.07761182108626197],"type":"scatter"},{"hovertemplate":"indifference curve for <br> optimal utility for risk aversion of 2<extra></extra>","line":{"color":"purple","dash":"dot"},"mode":"lines","name":"Risk Aversion=2","x":[0.0,0.002121212121212121,0.004242424242424242,0.006363636363636363,0.008484848484848484,0.010606060606060605,0.012727272727272726,0.014848484848484847,0.016969696969696968,0.01909090909090909,0.02121212121212121,0.023333333333333334,0.025454545454545452,0.027575757575757573,0.029696969696969694,0.031818181818181815,0.033939393939393936,0.03606060606060606,0.03818181818181818,0.040303030303030306,0.04242424242424242,0.04454545454545454,0.04666666666666667,0.04878787878787878,0.050909090909090904,0.05303030303030303,0.055151515151515146,0.05727272727272727,0.05939393939393939,0.06151515151515151,0.06363636363636363,0.06575757575757575,0.06787878787878787,0.06999999999999999,0.07212121212121211,0.07424242424242423,0.07636363636363636,0.07848484848484848,0.08060606060606061,0.08272727272727272,0.08484848484848484,0.08696969696969696,0.08909090909090908,0.0912121212121212,0.09333333333333334,0.09545454545454544,0.09757575757575757,0.09969696969696969,0.10181818181818181,0.10393939393939393,0.10606060606060606,0.10818181818181817,0.11030303030303029,0.11242424242424241,0.11454545454545453,0.11666666666666664,0.11878787878787878,0.1209090909090909,0.12303030303030302,0.12515151515151512,0.12727272727272726,0.12939393939393937,0.1315151515151515,0.13363636363636364,0.13575757575757574,0.13787878787878785,0.13999999999999999,0.14212121212121212,0.14424242424242423,0.14636363636363636,0.14848484848484847,0.1506060606060606,0.1527272727272727,0.15484848484848485,0.15696969696969695,0.1590909090909091,0.16121212121212122,0.1633333333333333,0.16545454545454544,0.16757575757575754,0.16969696969696968,0.1718181818181818,0.17393939393939392,0.17606060606060606,0.17818181818181816,0.1803030303030303,0.1824242424242424,0.18454545454545454,0.18666666666666668,0.18878787878787875,0.1909090909090909,0.193030303030303,0.19515151515151513,0.19727272727272724,0.19939393939393937,0.2015151515151515,0.20363636363636362,0.20575757575757575,0.20787878787878786,0.21],"y":[0.04253074579873722,0.042535245339600396,0.042548743962189925,0.04257124166650581,0.042602738452548056,0.04264323432031665,0.042692729269811595,0.0427512233010329,0.04281871641398056,0.042895208608654575,0.042980699885054936,0.04307519024318166,0.04317867968303474,0.04329116820461417,0.043412655807919955,0.043543142492952096,0.04368262825971059,0.04383111310819544,0.043988597038406636,0.04415508005034419,0.04433056214400811,0.04451504331939837,0.044708523576514995,0.04491100291535797,0.0451224813359273,0.04534295883822299,0.045572435422245025,0.045810911087993414,0.04605838583546816,0.046314859664669264,0.04658033257559672,0.04685480456825053,0.0471382756426307,0.04743074579873722,0.04773221503657009,0.048042683356129316,0.0483621507574149,0.04869061724042684,0.04902808280516513,0.04937454745162978,0.04973001117982078,0.05009447398973813,0.05046793588138184,0.05085039685475191,0.05124185690984833,0.0516423160466711,0.05205177426522023,0.05247023156549571,0.052897687947497544,0.053334143411225735,0.05377959795668029,0.05423405158386118,0.054697504292768435,0.05516995608340204,0.05565140695576201,0.056141856909848326,0.056641305945661,0.057149754063200026,0.057667201262465405,0.05819364754345714,0.05872909290617523,0.05927353735061967,0.059826980876790475,0.060389423484687635,0.06096086517431114,0.06154130594566099,0.062130745798737216,0.06272918473353979,0.06333662275006871,0.063953059848324,0.06457849602830562,0.06521293129001361,0.06585636563344796,0.06650879905860865,0.0671702315654957,0.06784066315410911,0.06852009382444887,0.06920852357651498,0.06990595241030746,0.07061238032582628,0.07132780732307147,0.07205223340204299,0.07278565856274088,0.07352808280516512,0.07427950612931572,0.07503992853519267,0.07580935002279598,0.07658777059212565,0.07737519024318167,0.07817160897596402,0.07897702679047275,0.07979144368670782,0.08061485966466925,0.08144727472435703,0.08228868886577118,0.08313910208891168,0.08399851439377853,0.08486692578037175,0.0857443362486913,0.08663074579873721],"type":"scatter"},{"hovertemplate":"indifference curve for <br> optimal utility for risk aversion of 5<extra></extra>","line":{"color":"purple"},"mode":"lines","name":"Risk Aversion=5","x":[0.0,0.002121212121212121,0.004242424242424242,0.006363636363636363,0.008484848484848484,0.010606060606060605,0.012727272727272726,0.014848484848484847,0.016969696969696968,0.01909090909090909,0.02121212121212121,0.023333333333333334,0.025454545454545452,0.027575757575757573,0.029696969696969694,0.031818181818181815,0.033939393939393936,0.03606060606060606,0.03818181818181818,0.040303030303030306,0.04242424242424242,0.04454545454545454,0.04666666666666667,0.04878787878787878,0.050909090909090904,0.05303030303030303,0.055151515151515146,0.05727272727272727,0.05939393939393939,0.06151515151515151,0.06363636363636363,0.06575757575757575,0.06787878787878787,0.06999999999999999,0.07212121212121211,0.07424242424242423,0.07636363636363636,0.07848484848484848,0.08060606060606061,0.08272727272727272,0.08484848484848484,0.08696969696969696,0.08909090909090908,0.0912121212121212,0.09333333333333334,0.09545454545454544,0.09757575757575757,0.09969696969696969,0.10181818181818181,0.10393939393939393,0.10606060606060606,0.10818181818181817,0.11030303030303029,0.11242424242424241,0.11454545454545453,0.11666666666666664,0.11878787878787878,0.1209090909090909,0.12303030303030302,0.12515151515151512,0.12727272727272726,0.12939393939393937,0.1315151515151515,0.13363636363636364,0.13575757575757574,0.13787878787878785,0.13999999999999999,0.14212121212121212,0.14424242424242423,0.14636363636363636,0.14848484848484847,0.1506060606060606,0.1527272727272727,0.15484848484848485,0.15696969696969695,0.1590909090909091,0.16121212121212122,0.1633333333333333,0.16545454545454544,0.16757575757575754,0.16969696969696968,0.1718181818181818,0.17393939393939392,0.17606060606060606,0.17818181818181816,0.1803030303030303,0.1824242424242424,0.18454545454545454,0.18666666666666668,0.18878787878787875,0.1909090909090909,0.193030303030303,0.19515151515151513,0.19727272727272724,0.19939393939393937,0.2015151515151515,0.20363636363636362,0.20575757575757575,0.20787878787878786,0.21],"y":[0.03627643363402062,0.03628768248617856,0.03632142904265239,0.036377673303442104,0.036456415268547704,0.0365576549379692,0.03668139231170657,0.03682762738975983,0.03699636017212898,0.037187590658814,0.03740131884981492,0.03763754474513173,0.03789626834476442,0.038177489648712995,0.03848120865697746,0.03880742536955781,0.03915613978645404,0.03952735190766617,0.03992106173319417,0.040337269263038066,0.040775974497197845,0.04123717743567351,0.041720878078465064,0.042227076425572496,0.04275577247699582,0.043306966232735035,0.04388065769279013,0.04447684685716111,0.04509553372584798,0.04573671829885073,0.04640040057616937,0.0470865805578039,0.047795258243754316,0.048526433634020615,0.0492801067286028,0.05005627752750087,0.05085494603071483,0.05167611223824467,0.05251977615009041,0.053385937766252015,0.05427459708672952,0.055185754111522906,0.056119408840632184,0.05707556127405734,0.058054211411798395,0.05905535925385533,0.06007900480022814,0.061125148050916844,0.06219378900592144,0.06328492766524191,0.06439856402887828,0.06553469809683053,0.06669332986909866,0.06787445934568269,0.0690780865265826,0.07030421141179838,0.07155283400133006,0.07282395429517763,0.0741175722933411,0.07543368799582043,0.07677230140261565,0.07813341251372674,0.07951702132915375,0.08092312784889666,0.0823517320729554,0.08380283400133005,0.0852764336340206,0.08677253097102705,0.08829112601234934,0.08983221875798755,0.09139580920794163,0.09298189736221162,0.09459048322079747,0.09622156678369923,0.09787514805091685,0.09955122702245037,0.10124980369829978,0.10297087807846503,0.10471445016294623,0.10648051995174326,0.10826908744485622,0.11008015264228505,0.11191371554402979,0.1137697761500904,0.11564833446046688,0.11754939047515928,0.11947294419416751,0.1214189956174917,0.12338754474513175,0.12537859157708764,0.12739213611335945,0.12942817835394713,0.1314867182988507,0.13356775594807016,0.13567129130160552,0.13779732435945677,0.1399458551216239,0.14211688358810692,0.1443104097589058,0.1465264336340206],"type":"scatter"}],                        {"template":{"data":{"histogram2dcontour":[{"type":"histogram2dcontour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"choropleth":[{"type":"choropleth","colorbar":{"outlinewidth":0,"ticks":""}}],"histogram2d":[{"type":"histogram2d","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmap":[{"type":"heatmap","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmapgl":[{"type":"heatmapgl","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"contourcarpet":[{"type":"contourcarpet","colorbar":{"outlinewidth":0,"ticks":""}}],"contour":[{"type":"contour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"surface":[{"type":"surface","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"mesh3d":[{"type":"mesh3d","colorbar":{"outlinewidth":0,"ticks":""}}],"scatter":[{"fillpattern":{"fillmode":"overlay","size":10,"solidity":0.2},"type":"scatter"}],"parcoords":[{"type":"parcoords","line":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolargl":[{"type":"scatterpolargl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"scattergeo":[{"type":"scattergeo","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolar":[{"type":"scatterpolar","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"scattergl":[{"type":"scattergl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatter3d":[{"type":"scatter3d","line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattermapbox":[{"type":"scattermapbox","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterternary":[{"type":"scatterternary","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattercarpet":[{"type":"scattercarpet","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"type":"carpet"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}],"barpolar":[{"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"pie":[{"automargin":true,"type":"pie"}]},"layout":{"autotypenumbers":"strict","colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"hovermode":"closest","hoverlabel":{"align":"left"},"paper_bgcolor":"white","plot_bgcolor":"#E5ECF6","polar":{"bgcolor":"#E5ECF6","angularaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"radialaxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"ternary":{"bgcolor":"#E5ECF6","aaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"baxis":{"gridcolor":"white","linecolor":"white","ticks":""},"caxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]]},"xaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"yaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"scene":{"xaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"yaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"zaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"geo":{"bgcolor":"white","landcolor":"#E5ECF6","subunitcolor":"white","showland":true,"showlakes":true,"lakecolor":"white"},"title":{"x":0.05},"mapbox":{"style":"light"}}},"xaxis":{"title":{"text":"Standard Deviation"},"range":[0,0.1875],"tickformat":".0%"},"yaxis":{"title":{"text":"Expected Return"},"range":[0,0.075],"tickformat":".0%"},"legend":{"yanchor":"top","y":0.55,"xanchor":"left","x":0.6}},                        {"responsive": true}                    ).then(function(){
                            
var gd = document.getElementById('3177900e-a354-45e2-ae0e-678006b07960');
var x = new MutationObserver(function (mutations, observer) {{
        var display = window.getComputedStyle(gd).display;
        if (!display || display === 'none') {{
            console.log([gd, 'removed!']);
            Plotly.purge(gd);
            observer.disconnect();
        }}
}});

// Listen for the removal of the full notebook cells
var notebookContainer = gd.closest('#notebook-container');
if (notebookContainer) {{
    x.observe(notebookContainer, {childList: true});
}}

// Listen for the clearing of the current output cell
var outputEl = gd.closest('.output');
if (outputEl) {{
    x.observe(outputEl, {childList: true});
}}

                        })                };                });            </script>        </div>
<p></p><figcaption class="figure-caption">Figure&nbsp;4.3: Preferences and Efficient Portfolios</figcaption><p></p>
</figure>
</div>
</div>
<p><a href="#fig-diffsaveborrow-cal-allocation-by-riskaversion">Figure&nbsp;<span class="quarto-unresolved-ref">fig-diffsaveborrow-cal-allocation-by-riskaversion</span></a> plots the allocation to risky assets as a function of risk aversion. Investors with very low levels of risk aversion will hold levered portfolios in the efficient high mean portfolio, and investors with very high levels of risk aversion will hold save some capital at the risk-free rate and the remainder in the efficient low risk portfolio. Investors with intermediate risk aversion will invest 100% of their capital in risky assets, but at different locations along the risky-asset efficient frontier (see hover data in <a href="#fig-diffsaveborrow-cal-allocation-by-riskaversion">Figure&nbsp;<span class="quarto-unresolved-ref">fig-diffsaveborrow-cal-allocation-by-riskaversion</span></a>). These portfolios can be written as a combination of the efficient low risk portfolio and the efficient high mean portfolio (<a href="#eq-frontier-optimal">Equation&nbsp;<span class="quarto-unresolved-ref">eq-frontier-optimal</span></a>). A larger fraction is invested in the efficient high mean portfolio with lower risk aversion.</p>
<div class="cell" data-execution_count="5">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.graph_objects <span class="im">as</span> go</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>mn_stock <span class="op">=</span> <span class="dv">6</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>mn_bond  <span class="op">=</span> <span class="fl">3.5</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>sd_stock <span class="op">=</span> <span class="dv">15</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>sd_bond  <span class="op">=</span> <span class="fl">3.5</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>corr <span class="op">=</span> <span class="op">-</span><span class="dv">5</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>rs <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>extra <span class="op">=</span> <span class="fl">1.25</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>raver1 <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>raver2 <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> data(mn1, mn2, sd1, sd2, c, rs, extra):</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>    c <span class="op">=</span> c <span class="op">/</span> <span class="dv">100</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>    rb <span class="op">=</span> rs <span class="op">+</span> extra   </span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>    rs <span class="op">=</span> rs<span class="op">/</span><span class="dv">100</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>    rb <span class="op">=</span> rb<span class="op">/</span><span class="dv">100</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>    mns <span class="op">=</span> [mn1, mn2]</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>    sds <span class="op">=</span> [sd1, sd2]</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>    grid <span class="op">=</span> np.linspace(<span class="op">-</span><span class="fl">0.2</span>, <span class="dv">1</span>, <span class="dv">201</span>)</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>    ports <span class="op">=</span> [np.array([w, <span class="dv">1</span> <span class="op">-</span> w]) <span class="cf">for</span> w <span class="kw">in</span> grid]</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>    means <span class="op">=</span> [p.T <span class="op">@</span> np.array(mns) <span class="cf">for</span> p <span class="kw">in</span> ports]</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.DataFrame(means)</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>    df.columns <span class="op">=</span> [<span class="st">"mean"</span>]</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>    cov <span class="op">=</span> np.array(</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>        [[sds[<span class="dv">0</span>] <span class="op">**</span> <span class="dv">2</span>, sds[<span class="dv">0</span>] <span class="op">*</span> sds[<span class="dv">1</span>] <span class="op">*</span> c], [sds[<span class="dv">0</span>] <span class="op">*</span> sds[<span class="dv">1</span>] <span class="op">*</span> c, sds[<span class="dv">1</span>] <span class="op">**</span> <span class="dv">2</span>]]</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>    ).reshape(<span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"stdev"</span>] <span class="op">=</span> [np.sqrt(p.T <span class="op">@</span> cov <span class="op">@</span> p) <span class="cf">for</span> p <span class="kw">in</span> ports]</span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"wt1"</span>] <span class="op">=</span> grid</span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"wt2"</span>] <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> df.wt1</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> col <span class="kw">in</span> [<span class="st">"mean"</span>, <span class="st">"stdev"</span>]:</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>        df[col] <span class="op">=</span> df[col] <span class="op">/</span> <span class="dv">100</span></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"sr_s"</span>]<span class="op">=</span> (df[<span class="st">"mean"</span>] <span class="op">-</span> rs)<span class="op">/</span>df[<span class="st">"stdev"</span>]</span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"sr_b"</span>]<span class="op">=</span> (df[<span class="st">"mean"</span>] <span class="op">-</span> rb)<span class="op">/</span>df[<span class="st">"stdev"</span>]</span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> rf_plus_risky(mn, sd, rs, rb, w_min, w_max):</span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>    mn <span class="op">/=</span> <span class="dv">100</span></span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>    sd <span class="op">/=</span> <span class="dv">100</span></span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>    rs <span class="op">/=</span> <span class="dv">100</span></span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>    rb <span class="op">/=</span> <span class="dv">100</span></span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>    grid <span class="op">=</span> np.linspace(w_min, w_max, <span class="dv">201</span>)</span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>    mns <span class="op">=</span> [(rs <span class="op">+</span> w <span class="op">*</span> (mn <span class="op">-</span> rs) <span class="cf">if</span> w <span class="op">&lt;=</span> <span class="dv">1</span> <span class="cf">else</span> rb <span class="op">+</span> w <span class="op">*</span> (mn <span class="op">-</span> rb)) <span class="cf">for</span> w <span class="kw">in</span> grid]</span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>    sds <span class="op">=</span> [w <span class="op">*</span> sd <span class="cf">for</span> w <span class="kw">in</span> grid]</span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>    srs <span class="op">=</span> (mn <span class="op">-</span> rs)<span class="op">/</span>sd</span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>    srb <span class="op">=</span> (mn <span class="op">-</span> rb)<span class="op">/</span>sd</span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> grid, mns, sds, srs, srb</span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> opt_utility(mns, cov, Shorts, s, b, A):</span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a>    <span class="co"># P is a portfolio object based on expected returns, covariance matrix, and shorts</span></span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a>    P <span class="op">=</span> portfolio(mns, cov, Shorts) </span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a>    gmv <span class="op">=</span> P.GMV <span class="op">@</span> mns</span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> s<span class="op">==</span>b:</span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a>        <span class="co">#tangency exp ret and sd</span></span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (s <span class="op">&lt;</span> gmv) <span class="kw">or</span> (<span class="kw">not</span> Shorts):</span>
<span id="cb4-61"><a href="#cb4-61" aria-hidden="true" tabindex="-1"></a>            portTang <span class="op">=</span> P.tangency(s)</span>
<span id="cb4-62"><a href="#cb4-62" aria-hidden="true" tabindex="-1"></a>            mnTang <span class="op">=</span> portTang <span class="op">@</span> mns</span>
<span id="cb4-63"><a href="#cb4-63" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> mnTang <span class="op">&lt;</span> np.<span class="bu">max</span>(mns):</span>
<span id="cb4-64"><a href="#cb4-64" aria-hidden="true" tabindex="-1"></a>                sdTang <span class="op">=</span> np.sqrt(portTang <span class="op">@</span> cov <span class="op">@</span> portTang)</span>
<span id="cb4-65"><a href="#cb4-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-66"><a href="#cb4-66" aria-hidden="true" tabindex="-1"></a>                <span class="co">#optimal weight in tangency based on risk-aversion</span></span>
<span id="cb4-67"><a href="#cb4-67" aria-hidden="true" tabindex="-1"></a>                wgt <span class="op">=</span> (mnTang <span class="op">-</span> s) <span class="op">/</span> (A <span class="op">*</span> (sdTang<span class="op">**</span><span class="dv">2</span>))</span>
<span id="cb4-68"><a href="#cb4-68" aria-hidden="true" tabindex="-1"></a>                expret<span class="op">=</span> wgt<span class="op">*</span>mnTang <span class="op">+</span> (<span class="dv">1</span><span class="op">-</span>wgt)<span class="op">*</span>s</span>
<span id="cb4-69"><a href="#cb4-69" aria-hidden="true" tabindex="-1"></a>                sdret <span class="op">=</span> wgt<span class="op">*</span>sdTang </span>
<span id="cb4-70"><a href="#cb4-70" aria-hidden="true" tabindex="-1"></a>                wgt_rf <span class="op">=</span> <span class="dv">1</span><span class="op">-</span>wgt</span>
<span id="cb4-71"><a href="#cb4-71" aria-hidden="true" tabindex="-1"></a>                wgt_lo <span class="op">=</span> wgt</span>
<span id="cb4-72"><a href="#cb4-72" aria-hidden="true" tabindex="-1"></a>                wgt_hi <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb4-73"><a href="#cb4-73" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb4-74"><a href="#cb4-74" aria-hidden="true" tabindex="-1"></a>        <span class="co">#efficient low-risk portfolio</span></span>
<span id="cb4-75"><a href="#cb4-75" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (s <span class="op">&lt;</span> gmv) <span class="kw">or</span> (<span class="kw">not</span> Shorts):</span>
<span id="cb4-76"><a href="#cb4-76" aria-hidden="true" tabindex="-1"></a>            portTangLowRisk <span class="op">=</span> P.tangency(s)</span>
<span id="cb4-77"><a href="#cb4-77" aria-hidden="true" tabindex="-1"></a>            mnTangLowRisk <span class="op">=</span> portTangLowRisk <span class="op">@</span> mns</span>
<span id="cb4-78"><a href="#cb4-78" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> mnTangLowRisk <span class="op">&lt;</span> np.<span class="bu">max</span>(mns):</span>
<span id="cb4-79"><a href="#cb4-79" aria-hidden="true" tabindex="-1"></a>                sdTangLowRisk <span class="op">=</span> np.sqrt(portTangLowRisk <span class="op">@</span> cov <span class="op">@</span> portTangLowRisk)</span>
<span id="cb4-80"><a href="#cb4-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-81"><a href="#cb4-81" aria-hidden="true" tabindex="-1"></a>        <span class="co">#efficient high-risk portfolio</span></span>
<span id="cb4-82"><a href="#cb4-82" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> ((b<span class="op">&lt;</span>gmv) <span class="kw">or</span> (<span class="kw">not</span> Shorts)):</span>
<span id="cb4-83"><a href="#cb4-83" aria-hidden="true" tabindex="-1"></a>            portTangHighRisk <span class="op">=</span> P.tangency(b)</span>
<span id="cb4-84"><a href="#cb4-84" aria-hidden="true" tabindex="-1"></a>            mnTangHighRisk <span class="op">=</span> portTangHighRisk <span class="op">@</span> mns</span>
<span id="cb4-85"><a href="#cb4-85" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> mnTangHighRisk <span class="op">&lt;</span> np.<span class="bu">max</span>(mns):</span>
<span id="cb4-86"><a href="#cb4-86" aria-hidden="true" tabindex="-1"></a>                sdTangHighRisk <span class="op">=</span> np.sqrt(portTangHighRisk <span class="op">@</span> cov <span class="op">@</span> portTangHighRisk)</span>
<span id="cb4-87"><a href="#cb4-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-88"><a href="#cb4-88" aria-hidden="true" tabindex="-1"></a>        <span class="co">#1st: efficient low risk CAL</span></span>
<span id="cb4-89"><a href="#cb4-89" aria-hidden="true" tabindex="-1"></a>        wgt <span class="op">=</span> (mnTangLowRisk <span class="op">-</span> s) <span class="op">/</span> (A <span class="op">*</span> (sdTangLowRisk<span class="op">**</span><span class="dv">2</span>))</span>
<span id="cb4-90"><a href="#cb4-90" aria-hidden="true" tabindex="-1"></a>        expret<span class="op">=</span> wgt<span class="op">*</span>mnTangLowRisk <span class="op">+</span> (<span class="dv">1</span><span class="op">-</span>wgt)<span class="op">*</span>s</span>
<span id="cb4-91"><a href="#cb4-91" aria-hidden="true" tabindex="-1"></a>        sdret <span class="op">=</span> wgt<span class="op">*</span>sdTangLowRisk </span>
<span id="cb4-92"><a href="#cb4-92" aria-hidden="true" tabindex="-1"></a>        wgt_rf <span class="op">=</span> <span class="dv">1</span><span class="op">-</span>wgt</span>
<span id="cb4-93"><a href="#cb4-93" aria-hidden="true" tabindex="-1"></a>        wgt_lo <span class="op">=</span> wgt</span>
<span id="cb4-94"><a href="#cb4-94" aria-hidden="true" tabindex="-1"></a>        wgt_hi <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb4-95"><a href="#cb4-95" aria-hidden="true" tabindex="-1"></a>        <span class="co"># print('Weight low risk CAL: ', wgt)</span></span>
<span id="cb4-96"><a href="#cb4-96" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> wgt <span class="op">&gt;</span> <span class="fl">1.0</span>:</span>
<span id="cb4-97"><a href="#cb4-97" aria-hidden="true" tabindex="-1"></a>            <span class="co">#2nd: efficient high risk CAL</span></span>
<span id="cb4-98"><a href="#cb4-98" aria-hidden="true" tabindex="-1"></a>            wgt <span class="op">=</span> (mnTangHighRisk <span class="op">-</span> b) <span class="op">/</span> (A <span class="op">*</span> (sdTangHighRisk<span class="op">**</span><span class="dv">2</span>))</span>
<span id="cb4-99"><a href="#cb4-99" aria-hidden="true" tabindex="-1"></a>            expret<span class="op">=</span> wgt<span class="op">*</span>mnTangHighRisk <span class="op">+</span> (<span class="dv">1</span><span class="op">-</span>wgt)<span class="op">*</span>b</span>
<span id="cb4-100"><a href="#cb4-100" aria-hidden="true" tabindex="-1"></a>            sdret <span class="op">=</span> wgt<span class="op">*</span>sdTangHighRisk </span>
<span id="cb4-101"><a href="#cb4-101" aria-hidden="true" tabindex="-1"></a>            wgt_rf <span class="op">=</span> <span class="dv">1</span><span class="op">-</span>wgt</span>
<span id="cb4-102"><a href="#cb4-102" aria-hidden="true" tabindex="-1"></a>            wgt_lo <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb4-103"><a href="#cb4-103" aria-hidden="true" tabindex="-1"></a>            wgt_hi <span class="op">=</span> wgt</span>
<span id="cb4-104"><a href="#cb4-104" aria-hidden="true" tabindex="-1"></a>            <span class="co"># print('Weight high risk CAL: ', wgt)</span></span>
<span id="cb4-105"><a href="#cb4-105" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> wgt <span class="op">&lt;</span> <span class="fl">1.0</span>:</span>
<span id="cb4-106"><a href="#cb4-106" aria-hidden="true" tabindex="-1"></a>                <span class="co">#3rd: risky asset frontier</span></span>
<span id="cb4-107"><a href="#cb4-107" aria-hidden="true" tabindex="-1"></a>                wgt <span class="op">=</span> <span class="dv">1</span> <span class="co">#This is should be interpreted as total weight in risky assets.</span></span>
<span id="cb4-108"><a href="#cb4-108" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Method 1: solve analytically for utility-maximizing mix of efficient low and high risk portfolios</span></span>
<span id="cb4-109"><a href="#cb4-109" aria-hidden="true" tabindex="-1"></a>                cov_hilo <span class="op">=</span> portTangLowRisk.T <span class="op">@</span>cov <span class="op">@</span> portTangHighRisk</span>
<span id="cb4-110"><a href="#cb4-110" aria-hidden="true" tabindex="-1"></a>                wgt_lo <span class="op">=</span> (mnTangLowRisk <span class="op">-</span> mnTangHighRisk <span class="op">-</span> A <span class="op">*</span>(cov_hilo  <span class="op">-</span> sdTangHighRisk<span class="op">**</span><span class="dv">2</span>))<span class="op">/</span>(A<span class="op">*</span>(sdTangLowRisk<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> sdTangHighRisk<span class="op">**</span><span class="dv">2</span> <span class="op">-</span> <span class="dv">2</span><span class="op">*</span>cov_hilo))</span>
<span id="cb4-111"><a href="#cb4-111" aria-hidden="true" tabindex="-1"></a>                expret <span class="op">=</span> wgt_lo<span class="op">*</span>mnTangLowRisk <span class="op">+</span> (<span class="dv">1</span><span class="op">-</span>wgt_lo)<span class="op">*</span> mnTangHighRisk</span>
<span id="cb4-112"><a href="#cb4-112" aria-hidden="true" tabindex="-1"></a>                sdret <span class="op">=</span> np.sqrt((wgt_lo<span class="op">**</span><span class="dv">2</span>) <span class="op">*</span>sdTangLowRisk<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> ((<span class="dv">1</span><span class="op">-</span>wgt_lo)<span class="op">**</span><span class="dv">2</span>) <span class="op">*</span> sdTangHighRisk<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> <span class="dv">2</span><span class="op">*</span>wgt_lo<span class="op">*</span>(<span class="dv">1</span><span class="op">-</span>wgt_lo)<span class="op">*</span>portTangLowRisk.T <span class="op">@</span>cov <span class="op">@</span> portTangHighRisk)</span>
<span id="cb4-113"><a href="#cb4-113" aria-hidden="true" tabindex="-1"></a>                wgt_hi <span class="op">=</span> <span class="dv">1</span><span class="op">-</span>wgt_lo</span>
<span id="cb4-114"><a href="#cb4-114" aria-hidden="true" tabindex="-1"></a>                wgt_rf <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb4-115"><a href="#cb4-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-116"><a href="#cb4-116" aria-hidden="true" tabindex="-1"></a>                <span class="co"># #Method 2: calculate frontier manually and choose max utility</span></span>
<span id="cb4-117"><a href="#cb4-117" aria-hidden="true" tabindex="-1"></a>                <span class="co"># eret_grid = np.linspace(mnTangLowRisk, mnTangHighRisk, 100)</span></span>
<span id="cb4-118"><a href="#cb4-118" aria-hidden="true" tabindex="-1"></a>                <span class="co"># df = pd.DataFrame(dtype='float', columns=['mn','sd','u'],index=np.arange(0,100))</span></span>
<span id="cb4-119"><a href="#cb4-119" aria-hidden="true" tabindex="-1"></a>                <span class="co"># for i,m in enumerate(eret_grid):</span></span>
<span id="cb4-120"><a href="#cb4-120" aria-hidden="true" tabindex="-1"></a>                <span class="co">#     portFrontier = P.frontier(m)</span></span>
<span id="cb4-121"><a href="#cb4-121" aria-hidden="true" tabindex="-1"></a>                <span class="co">#     df.loc[i,'mn'] = portFrontier @ mns</span></span>
<span id="cb4-122"><a href="#cb4-122" aria-hidden="true" tabindex="-1"></a>                <span class="co">#     df.loc[i,'sd'] = np.sqrt(portFrontier @ cov @ portFrontier)</span></span>
<span id="cb4-123"><a href="#cb4-123" aria-hidden="true" tabindex="-1"></a>                <span class="co"># df['u']  = df['mn'] - 0.5*A* df['sd']**2</span></span>
<span id="cb4-124"><a href="#cb4-124" aria-hidden="true" tabindex="-1"></a>                <span class="co"># opt_mn = df.loc[df['u'].idxmax(),'mn']</span></span>
<span id="cb4-125"><a href="#cb4-125" aria-hidden="true" tabindex="-1"></a>                <span class="co"># portFrontier = P.frontier(opt_mn)</span></span>
<span id="cb4-126"><a href="#cb4-126" aria-hidden="true" tabindex="-1"></a>                <span class="co"># expret = portFrontier @ mns</span></span>
<span id="cb4-127"><a href="#cb4-127" aria-hidden="true" tabindex="-1"></a>                <span class="co"># sdret  = np.sqrt(portFrontier @ cov @ portFrontier)</span></span>
<span id="cb4-128"><a href="#cb4-128" aria-hidden="true" tabindex="-1"></a>                <span class="co"># print('Weight frontier: ', wgt)</span></span>
<span id="cb4-129"><a href="#cb4-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-130"><a href="#cb4-130" aria-hidden="true" tabindex="-1"></a>    u <span class="op">=</span> expret <span class="op">-</span> <span class="fl">0.5</span><span class="op">*</span>A<span class="op">*</span>sdret<span class="op">**</span><span class="dv">2</span></span>
<span id="cb4-131"><a href="#cb4-131" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> u, wgt, wgt_rf, wgt_lo, wgt_hi</span>
<span id="cb4-132"><a href="#cb4-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-133"><a href="#cb4-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-134"><a href="#cb4-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-135"><a href="#cb4-135" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> figtbl(mn1, mn2, sd1, sd2, c, rs, extra, raver1, raver2, asset1_name, asset2_name):</span>
<span id="cb4-136"><a href="#cb4-136" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> data(mn1, mn2, sd1, sd2, c, rs, extra)</span>
<span id="cb4-137"><a href="#cb4-137" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-138"><a href="#cb4-138" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Plot the portfolios of the two assets</span></span>
<span id="cb4-139"><a href="#cb4-139" aria-hidden="true" tabindex="-1"></a>    trace1 <span class="op">=</span> go.Scatter(</span>
<span id="cb4-140"><a href="#cb4-140" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span>df[<span class="st">"stdev"</span>],</span>
<span id="cb4-141"><a href="#cb4-141" aria-hidden="true" tabindex="-1"></a>        y<span class="op">=</span>df[<span class="st">"mean"</span>],</span>
<span id="cb4-142"><a href="#cb4-142" aria-hidden="true" tabindex="-1"></a>        mode<span class="op">=</span><span class="st">"lines"</span>,</span>
<span id="cb4-143"><a href="#cb4-143" aria-hidden="true" tabindex="-1"></a>        <span class="co"># line={'color': green},</span></span>
<span id="cb4-144"><a href="#cb4-144" aria-hidden="true" tabindex="-1"></a>        text<span class="op">=</span><span class="dv">100</span> <span class="op">*</span> df[<span class="st">"wt1"</span>],</span>
<span id="cb4-145"><a href="#cb4-145" aria-hidden="true" tabindex="-1"></a>        customdata<span class="op">=</span><span class="dv">100</span> <span class="op">*</span> df[<span class="st">"wt2"</span>],</span>
<span id="cb4-146"><a href="#cb4-146" aria-hidden="true" tabindex="-1"></a>        hovertemplate<span class="op">=</span>asset1_name<span class="op">+</span><span class="st">": %</span><span class="sc">{text:.0f}</span><span class="st">%&lt;br&gt;"</span><span class="op">+</span>asset2_name<span class="op">+</span><span class="st">": %</span><span class="sc">{customdata:.0f}</span><span class="st">%&lt;extra&gt;&lt;/extra&gt;"</span>,</span>
<span id="cb4-147"><a href="#cb4-147" aria-hidden="true" tabindex="-1"></a>        line<span class="op">=</span><span class="bu">dict</span>(color<span class="op">=</span><span class="st">"black"</span>),</span>
<span id="cb4-148"><a href="#cb4-148" aria-hidden="true" tabindex="-1"></a>        name<span class="op">=</span><span class="st">"Stock &amp; Bond Frontier"</span></span>
<span id="cb4-149"><a href="#cb4-149" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb4-150"><a href="#cb4-150" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-151"><a href="#cb4-151" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plot the two assets</span></span>
<span id="cb4-152"><a href="#cb4-152" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df[df.wt1.isin([<span class="dv">0</span>, <span class="dv">1</span>])]</span>
<span id="cb4-153"><a href="#cb4-153" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"text"</span>] <span class="op">=</span> np.where(df.wt1 <span class="op">==</span> <span class="dv">1</span>, asset1_name, asset2_name)</span>
<span id="cb4-154"><a href="#cb4-154" aria-hidden="true" tabindex="-1"></a>    trace2a <span class="op">=</span> go.Scatter(</span>
<span id="cb4-155"><a href="#cb4-155" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span>df[df.wt1<span class="op">==</span><span class="dv">1</span>][<span class="st">"stdev"</span>],</span>
<span id="cb4-156"><a href="#cb4-156" aria-hidden="true" tabindex="-1"></a>        y<span class="op">=</span>df[df.wt1<span class="op">==</span><span class="dv">1</span>][<span class="st">"mean"</span>],</span>
<span id="cb4-157"><a href="#cb4-157" aria-hidden="true" tabindex="-1"></a>        mode<span class="op">=</span><span class="st">"markers"</span>,</span>
<span id="cb4-158"><a href="#cb4-158" aria-hidden="true" tabindex="-1"></a>        text<span class="op">=</span>df[df.wt1<span class="op">==</span><span class="dv">1</span>][<span class="st">"text"</span>],</span>
<span id="cb4-159"><a href="#cb4-159" aria-hidden="true" tabindex="-1"></a>        hovertemplate<span class="op">=</span><span class="st">"%</span><span class="sc">{text}</span><span class="st">&lt;extra&gt;&lt;/extra&gt;"</span>,</span>
<span id="cb4-160"><a href="#cb4-160" aria-hidden="true" tabindex="-1"></a>        marker<span class="op">=</span><span class="bu">dict</span>(size<span class="op">=</span><span class="dv">10</span>, color<span class="op">=</span><span class="st">"orange"</span>),</span>
<span id="cb4-161"><a href="#cb4-161" aria-hidden="true" tabindex="-1"></a>        name<span class="op">=</span>asset1_name</span>
<span id="cb4-162"><a href="#cb4-162" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb4-163"><a href="#cb4-163" aria-hidden="true" tabindex="-1"></a>    trace2b <span class="op">=</span> go.Scatter(</span>
<span id="cb4-164"><a href="#cb4-164" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span>df[df.wt1<span class="op">==</span><span class="dv">0</span>][<span class="st">"stdev"</span>],</span>
<span id="cb4-165"><a href="#cb4-165" aria-hidden="true" tabindex="-1"></a>        y<span class="op">=</span>df[df.wt1<span class="op">==</span><span class="dv">0</span>][<span class="st">"mean"</span>],</span>
<span id="cb4-166"><a href="#cb4-166" aria-hidden="true" tabindex="-1"></a>        mode<span class="op">=</span><span class="st">"markers"</span>,</span>
<span id="cb4-167"><a href="#cb4-167" aria-hidden="true" tabindex="-1"></a>        text<span class="op">=</span>df[df.wt1<span class="op">==</span><span class="dv">0</span>][<span class="st">"text"</span>],</span>
<span id="cb4-168"><a href="#cb4-168" aria-hidden="true" tabindex="-1"></a>        hovertemplate<span class="op">=</span><span class="st">"%</span><span class="sc">{text}</span><span class="st">&lt;extra&gt;&lt;/extra&gt;"</span>,</span>
<span id="cb4-169"><a href="#cb4-169" aria-hidden="true" tabindex="-1"></a>        marker<span class="op">=</span><span class="bu">dict</span>(size<span class="op">=</span><span class="dv">10</span>, color<span class="op">=</span><span class="st">"red"</span>),</span>
<span id="cb4-170"><a href="#cb4-170" aria-hidden="true" tabindex="-1"></a>        name<span class="op">=</span>asset2_name</span>
<span id="cb4-171"><a href="#cb4-171" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb4-172"><a href="#cb4-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-173"><a href="#cb4-173" aria-hidden="true" tabindex="-1"></a>    fig <span class="op">=</span> go.Figure()</span>
<span id="cb4-174"><a href="#cb4-174" aria-hidden="true" tabindex="-1"></a>    fig.add_trace(trace2a)</span>
<span id="cb4-175"><a href="#cb4-175" aria-hidden="true" tabindex="-1"></a>    fig.add_trace(trace2b)</span>
<span id="cb4-176"><a href="#cb4-176" aria-hidden="true" tabindex="-1"></a>    fig.add_trace(trace1)</span>
<span id="cb4-177"><a href="#cb4-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-178"><a href="#cb4-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-179"><a href="#cb4-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-180"><a href="#cb4-180" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> custom(string, ports,srTang,borrow_flag):</span>
<span id="cb4-181"><a href="#cb4-181" aria-hidden="true" tabindex="-1"></a>        <span class="co"># borrow_flag=1 adds statement about "relative to borrowing rate"</span></span>
<span id="cb4-182"><a href="#cb4-182" aria-hidden="true" tabindex="-1"></a>        cd <span class="op">=</span> np.empty(shape<span class="op">=</span>(<span class="bu">len</span>(ports), N<span class="op">+</span><span class="dv">1</span>, <span class="dv">1</span>), dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb4-183"><a href="#cb4-183" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(N):</span>
<span id="cb4-184"><a href="#cb4-184" aria-hidden="true" tabindex="-1"></a>            cd[:, i] <span class="op">=</span> np.array([w[i] <span class="cf">for</span> w <span class="kw">in</span> ports]).reshape(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb4-185"><a href="#cb4-185" aria-hidden="true" tabindex="-1"></a>        cd[:,N] <span class="op">=</span> np.<span class="bu">round</span>(srTang,<span class="dv">4</span>)</span>
<span id="cb4-186"><a href="#cb4-186" aria-hidden="true" tabindex="-1"></a>        <span class="co"># print(cd)</span></span>
<span id="cb4-187"><a href="#cb4-187" aria-hidden="true" tabindex="-1"></a>        string <span class="op">+=</span> <span class="st">"&lt;br&gt;"</span></span>
<span id="cb4-188"><a href="#cb4-188" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(N):</span>
<span id="cb4-189"><a href="#cb4-189" aria-hidden="true" tabindex="-1"></a>            string <span class="op">+=</span> <span class="st">"asset "</span> <span class="op">+</span> <span class="bu">str</span>(i <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb4-190"><a href="#cb4-190" aria-hidden="true" tabindex="-1"></a>            string <span class="op">+=</span> <span class="st">": %{customdata["</span></span>
<span id="cb4-191"><a href="#cb4-191" aria-hidden="true" tabindex="-1"></a>            string <span class="op">+=</span> <span class="bu">str</span>(i)</span>
<span id="cb4-192"><a href="#cb4-192" aria-hidden="true" tabindex="-1"></a>            string <span class="op">+=</span> <span class="st">"]:.1%}&lt;br&gt;"</span></span>
<span id="cb4-193"><a href="#cb4-193" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> borrow_flag<span class="op">==</span><span class="dv">1</span>:</span>
<span id="cb4-194"><a href="#cb4-194" aria-hidden="true" tabindex="-1"></a>            string <span class="op">+=</span> <span class="st">"Sharpe ratio (relative to borrowing rate): %{customdata["</span> <span class="op">+</span>  <span class="bu">str</span>(N) <span class="op">+</span> <span class="st">"]:.4f}&lt;br&gt;"</span>    </span>
<span id="cb4-195"><a href="#cb4-195" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb4-196"><a href="#cb4-196" aria-hidden="true" tabindex="-1"></a>            string <span class="op">+=</span> <span class="st">"Sharpe ratio: %{customdata["</span> <span class="op">+</span>  <span class="bu">str</span>(N) <span class="op">+</span> <span class="st">"]:.4f}&lt;br&gt;"</span></span>
<span id="cb4-197"><a href="#cb4-197" aria-hidden="true" tabindex="-1"></a>        string <span class="op">+=</span> <span class="st">"&lt;extra&gt;&lt;/extra&gt;"</span></span>
<span id="cb4-198"><a href="#cb4-198" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> string, cd  </span>
<span id="cb4-199"><a href="#cb4-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-200"><a href="#cb4-200" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plot the tangency portfolios</span></span>
<span id="cb4-201"><a href="#cb4-201" aria-hidden="true" tabindex="-1"></a>    c <span class="op">=</span> c <span class="op">/</span> <span class="dv">100</span></span>
<span id="cb4-202"><a href="#cb4-202" aria-hidden="true" tabindex="-1"></a>    rb <span class="op">=</span> rs <span class="op">+</span> extra     </span>
<span id="cb4-203"><a href="#cb4-203" aria-hidden="true" tabindex="-1"></a>    rs <span class="op">=</span> rs<span class="op">/</span><span class="dv">100</span></span>
<span id="cb4-204"><a href="#cb4-204" aria-hidden="true" tabindex="-1"></a>    rb <span class="op">=</span> rb<span class="op">/</span><span class="dv">100</span></span>
<span id="cb4-205"><a href="#cb4-205" aria-hidden="true" tabindex="-1"></a>    mns <span class="op">=</span> [mn1, mn2]</span>
<span id="cb4-206"><a href="#cb4-206" aria-hidden="true" tabindex="-1"></a>    mns <span class="op">=</span> np.array(mns) <span class="op">/</span> <span class="dv">100</span></span>
<span id="cb4-207"><a href="#cb4-207" aria-hidden="true" tabindex="-1"></a>    sds <span class="op">=</span> [sd1, sd2]</span>
<span id="cb4-208"><a href="#cb4-208" aria-hidden="true" tabindex="-1"></a>    sds <span class="op">=</span> np.array(sds) <span class="op">/</span> <span class="dv">100</span></span>
<span id="cb4-209"><a href="#cb4-209" aria-hidden="true" tabindex="-1"></a>    cov <span class="op">=</span> np.array(</span>
<span id="cb4-210"><a href="#cb4-210" aria-hidden="true" tabindex="-1"></a>        [[sds[<span class="dv">0</span>] <span class="op">**</span> <span class="dv">2</span>, sds[<span class="dv">0</span>] <span class="op">*</span> sds[<span class="dv">1</span>] <span class="op">*</span> c], [sds[<span class="dv">0</span>] <span class="op">*</span> sds[<span class="dv">1</span>] <span class="op">*</span> c, sds[<span class="dv">1</span>] <span class="op">**</span> <span class="dv">2</span>]]</span>
<span id="cb4-211"><a href="#cb4-211" aria-hidden="true" tabindex="-1"></a>    ).reshape(<span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb4-212"><a href="#cb4-212" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-213"><a href="#cb4-213" aria-hidden="true" tabindex="-1"></a>    Shorts <span class="op">=</span> <span class="fl">1.0</span>     </span>
<span id="cb4-214"><a href="#cb4-214" aria-hidden="true" tabindex="-1"></a>    N <span class="op">=</span> <span class="bu">len</span>(mns)</span>
<span id="cb4-215"><a href="#cb4-215" aria-hidden="true" tabindex="-1"></a>    P <span class="op">=</span> portfolio(mns, cov, Shorts)    </span>
<span id="cb4-216"><a href="#cb4-216" aria-hidden="true" tabindex="-1"></a>    gmv <span class="op">=</span> P.GMV <span class="op">@</span> mns</span>
<span id="cb4-217"><a href="#cb4-217" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print('GMV return is: ',gmv)</span></span>
<span id="cb4-218"><a href="#cb4-218" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (rs <span class="op">&lt;</span> gmv) <span class="kw">or</span> (<span class="kw">not</span> Shorts):</span>
<span id="cb4-219"><a href="#cb4-219" aria-hidden="true" tabindex="-1"></a>        portTang <span class="op">=</span> P.tangency(rs)</span>
<span id="cb4-220"><a href="#cb4-220" aria-hidden="true" tabindex="-1"></a>        mnTang <span class="op">=</span> portTang <span class="op">@</span> mns</span>
<span id="cb4-221"><a href="#cb4-221" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> mnTang <span class="op">&lt;</span> np.<span class="bu">max</span>(mns):</span>
<span id="cb4-222"><a href="#cb4-222" aria-hidden="true" tabindex="-1"></a>            sdTang <span class="op">=</span> np.sqrt(portTang <span class="op">@</span> cov <span class="op">@</span> portTang)</span>
<span id="cb4-223"><a href="#cb4-223" aria-hidden="true" tabindex="-1"></a>            srTang <span class="op">=</span> (mnTang <span class="op">-</span> rs)<span class="op">/</span>sdTang</span>
<span id="cb4-224"><a href="#cb4-224" aria-hidden="true" tabindex="-1"></a>            string0 <span class="op">=</span> <span class="st">'tangency portfolio'</span> <span class="cf">if</span> rb <span class="op">==</span> rs <span class="cf">else</span> <span class="st">'efficient low risk portfolio'</span> <span class="cf">if</span> rb <span class="op">!=</span> rs <span class="cf">else</span> <span class="st">'tangency portfolio'</span></span>
<span id="cb4-225"><a href="#cb4-225" aria-hidden="true" tabindex="-1"></a>            string, cd <span class="op">=</span> custom(string0, [portTang], srTang,<span class="dv">0</span>)</span>
<span id="cb4-226"><a href="#cb4-226" aria-hidden="true" tabindex="-1"></a>            trace <span class="op">=</span> go.Scatter(</span>
<span id="cb4-227"><a href="#cb4-227" aria-hidden="true" tabindex="-1"></a>                x<span class="op">=</span>[sdTang],</span>
<span id="cb4-228"><a href="#cb4-228" aria-hidden="true" tabindex="-1"></a>                y<span class="op">=</span>[mnTang],</span>
<span id="cb4-229"><a href="#cb4-229" aria-hidden="true" tabindex="-1"></a>                mode<span class="op">=</span><span class="st">"markers"</span>,</span>
<span id="cb4-230"><a href="#cb4-230" aria-hidden="true" tabindex="-1"></a>                customdata<span class="op">=</span>cd,</span>
<span id="cb4-231"><a href="#cb4-231" aria-hidden="true" tabindex="-1"></a>                hovertemplate<span class="op">=</span>string,</span>
<span id="cb4-232"><a href="#cb4-232" aria-hidden="true" tabindex="-1"></a>                marker<span class="op">=</span><span class="bu">dict</span>(size<span class="op">=</span><span class="dv">10</span>, color<span class="op">=</span><span class="st">"blue"</span>),</span>
<span id="cb4-233"><a href="#cb4-233" aria-hidden="true" tabindex="-1"></a>                name<span class="op">=</span>string0</span>
<span id="cb4-234"><a href="#cb4-234" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb4-235"><a href="#cb4-235" aria-hidden="true" tabindex="-1"></a>            fig.add_trace(trace)</span>
<span id="cb4-236"><a href="#cb4-236" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-237"><a href="#cb4-237" aria-hidden="true" tabindex="-1"></a>            <span class="co">#Plot CAL (no leverage)</span></span>
<span id="cb4-238"><a href="#cb4-238" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> rb<span class="op">==</span>rs:</span>
<span id="cb4-239"><a href="#cb4-239" aria-hidden="true" tabindex="-1"></a>                max_wgt <span class="op">=</span> <span class="fl">4.0</span></span>
<span id="cb4-240"><a href="#cb4-240" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb4-241"><a href="#cb4-241" aria-hidden="true" tabindex="-1"></a>                max_wgt <span class="op">=</span> <span class="fl">1.0</span></span>
<span id="cb4-242"><a href="#cb4-242" aria-hidden="true" tabindex="-1"></a>            grid, mns_cal, sds_cal, srs_cal, srb_cal <span class="op">=</span> rf_plus_risky(mnTang<span class="op">*</span><span class="dv">100</span>, sdTang<span class="op">*</span><span class="dv">100</span>, rs<span class="op">*</span><span class="dv">100</span>,rb<span class="op">*</span><span class="dv">100</span>,<span class="dv">0</span>, max_wgt)</span>
<span id="cb4-243"><a href="#cb4-243" aria-hidden="true" tabindex="-1"></a>            portlabel <span class="op">=</span> <span class="st">'tangency portfolio'</span> <span class="cf">if</span> rb <span class="op">==</span> rs <span class="cf">else</span> <span class="st">'efficient low risk portfolio'</span> <span class="cf">if</span> rb <span class="op">!=</span> rs <span class="cf">else</span> <span class="st">'tangency portfolio'</span></span>
<span id="cb4-244"><a href="#cb4-244" aria-hidden="true" tabindex="-1"></a>            string <span class="op">=</span> <span class="st">"wealth in "</span><span class="op">+</span>portlabel <span class="op">+</span> <span class="st">" = %</span><span class="sc">{text:.0f}</span><span class="st">%&lt;br&gt;"</span> <span class="op">+</span> <span class="st">"Sharpe ratio: "</span> <span class="op">+</span>  <span class="st">"</span><span class="sc">{:.4f}</span><span class="st">"</span>.<span class="bu">format</span>(srTang) <span class="op">+</span><span class="st">"&lt;extra&gt;&lt;/extra&gt;"</span></span>
<span id="cb4-245"><a href="#cb4-245" aria-hidden="true" tabindex="-1"></a>            trace5 <span class="op">=</span> go.Scatter(</span>
<span id="cb4-246"><a href="#cb4-246" aria-hidden="true" tabindex="-1"></a>                x<span class="op">=</span>sds_cal, </span>
<span id="cb4-247"><a href="#cb4-247" aria-hidden="true" tabindex="-1"></a>                y<span class="op">=</span>mns_cal, </span>
<span id="cb4-248"><a href="#cb4-248" aria-hidden="true" tabindex="-1"></a>                mode<span class="op">=</span><span class="st">"lines"</span>, </span>
<span id="cb4-249"><a href="#cb4-249" aria-hidden="true" tabindex="-1"></a>                text<span class="op">=</span><span class="dv">100</span> <span class="op">*</span> grid, </span>
<span id="cb4-250"><a href="#cb4-250" aria-hidden="true" tabindex="-1"></a>                hovertemplate<span class="op">=</span>string, </span>
<span id="cb4-251"><a href="#cb4-251" aria-hidden="true" tabindex="-1"></a>                line<span class="op">=</span><span class="bu">dict</span>(color<span class="op">=</span><span class="st">"blue"</span>),</span>
<span id="cb4-252"><a href="#cb4-252" aria-hidden="true" tabindex="-1"></a>                name<span class="op">=</span><span class="st">"CAL: "</span> <span class="op">+</span> portlabel</span>
<span id="cb4-253"><a href="#cb4-253" aria-hidden="true" tabindex="-1"></a>            )           </span>
<span id="cb4-254"><a href="#cb4-254" aria-hidden="true" tabindex="-1"></a>            fig.add_trace(trace5)</span>
<span id="cb4-255"><a href="#cb4-255" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb4-256"><a href="#cb4-256" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-257"><a href="#cb4-257" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-258"><a href="#cb4-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-259"><a href="#cb4-259" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (rb <span class="op">!=</span> rs) <span class="kw">and</span> ((gmv <span class="op">&gt;</span> rb) <span class="kw">or</span> (<span class="kw">not</span> Shorts)):</span>
<span id="cb4-260"><a href="#cb4-260" aria-hidden="true" tabindex="-1"></a>        portTang <span class="op">=</span> P.tangency(rb)</span>
<span id="cb4-261"><a href="#cb4-261" aria-hidden="true" tabindex="-1"></a>        mnTang <span class="op">=</span> portTang <span class="op">@</span> mns</span>
<span id="cb4-262"><a href="#cb4-262" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> mnTang <span class="op">&lt;</span> np.<span class="bu">max</span>(mns):</span>
<span id="cb4-263"><a href="#cb4-263" aria-hidden="true" tabindex="-1"></a>            sdTang <span class="op">=</span> np.sqrt(portTang <span class="op">@</span> cov <span class="op">@</span> portTang)</span>
<span id="cb4-264"><a href="#cb4-264" aria-hidden="true" tabindex="-1"></a>            srTang <span class="op">=</span> (mnTang <span class="op">-</span> rb)<span class="op">/</span>sdTang</span>
<span id="cb4-265"><a href="#cb4-265" aria-hidden="true" tabindex="-1"></a>            string <span class="op">=</span> <span class="st">'efficient high mean portfolio'</span></span>
<span id="cb4-266"><a href="#cb4-266" aria-hidden="true" tabindex="-1"></a>            string, cd <span class="op">=</span> custom(string, [portTang], srTang,<span class="dv">1</span>)</span>
<span id="cb4-267"><a href="#cb4-267" aria-hidden="true" tabindex="-1"></a>            trace <span class="op">=</span> go.Scatter(</span>
<span id="cb4-268"><a href="#cb4-268" aria-hidden="true" tabindex="-1"></a>                x<span class="op">=</span>[sdTang],</span>
<span id="cb4-269"><a href="#cb4-269" aria-hidden="true" tabindex="-1"></a>                y<span class="op">=</span>[mnTang],</span>
<span id="cb4-270"><a href="#cb4-270" aria-hidden="true" tabindex="-1"></a>                mode<span class="op">=</span><span class="st">"markers"</span>,</span>
<span id="cb4-271"><a href="#cb4-271" aria-hidden="true" tabindex="-1"></a>                customdata<span class="op">=</span>cd,</span>
<span id="cb4-272"><a href="#cb4-272" aria-hidden="true" tabindex="-1"></a>                hovertemplate<span class="op">=</span>string,</span>
<span id="cb4-273"><a href="#cb4-273" aria-hidden="true" tabindex="-1"></a>                marker<span class="op">=</span><span class="bu">dict</span>(size<span class="op">=</span><span class="dv">10</span>, color<span class="op">=</span><span class="st">"blue"</span>),</span>
<span id="cb4-274"><a href="#cb4-274" aria-hidden="true" tabindex="-1"></a>                name<span class="op">=</span><span class="st">"efficient high mean portfolio"</span></span>
<span id="cb4-275"><a href="#cb4-275" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb4-276"><a href="#cb4-276" aria-hidden="true" tabindex="-1"></a>            fig.add_trace(trace)</span>
<span id="cb4-277"><a href="#cb4-277" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-278"><a href="#cb4-278" aria-hidden="true" tabindex="-1"></a>            <span class="co">#Plot CAL (with leverage)            </span></span>
<span id="cb4-279"><a href="#cb4-279" aria-hidden="true" tabindex="-1"></a>            grid, mns_cal, sds_cal, srs_cal, srb_cal <span class="op">=</span> rf_plus_risky(mnTang<span class="op">*</span><span class="dv">100</span>, sdTang<span class="op">*</span><span class="dv">100</span>, rs<span class="op">*</span><span class="dv">100</span>,rb<span class="op">*</span><span class="dv">100</span>, <span class="fl">1.0</span>, <span class="fl">1.5</span>)</span>
<span id="cb4-280"><a href="#cb4-280" aria-hidden="true" tabindex="-1"></a>            string <span class="op">=</span> <span class="st">"wealth in efficient high mean portfolio = %</span><span class="sc">{text:.0f}</span><span class="st">%&lt;br&gt;"</span> <span class="op">+</span> <span class="st">"Sharpe ratio (relative to borrowing rate): "</span> <span class="op">+</span> <span class="st">"</span><span class="sc">{:.4f}</span><span class="st">"</span>.<span class="bu">format</span>(srTang) <span class="op">+</span><span class="st">"&lt;extra&gt;&lt;/extra&gt;"</span></span>
<span id="cb4-281"><a href="#cb4-281" aria-hidden="true" tabindex="-1"></a>            trace6 <span class="op">=</span> go.Scatter(</span>
<span id="cb4-282"><a href="#cb4-282" aria-hidden="true" tabindex="-1"></a>                x<span class="op">=</span>sds_cal, </span>
<span id="cb4-283"><a href="#cb4-283" aria-hidden="true" tabindex="-1"></a>                y<span class="op">=</span>mns_cal, </span>
<span id="cb4-284"><a href="#cb4-284" aria-hidden="true" tabindex="-1"></a>                mode<span class="op">=</span><span class="st">"lines"</span>, </span>
<span id="cb4-285"><a href="#cb4-285" aria-hidden="true" tabindex="-1"></a>                text<span class="op">=</span><span class="dv">100</span> <span class="op">*</span> grid, </span>
<span id="cb4-286"><a href="#cb4-286" aria-hidden="true" tabindex="-1"></a>                hovertemplate<span class="op">=</span>string,</span>
<span id="cb4-287"><a href="#cb4-287" aria-hidden="true" tabindex="-1"></a>                line<span class="op">=</span><span class="bu">dict</span>(color<span class="op">=</span><span class="st">"blue"</span>),</span>
<span id="cb4-288"><a href="#cb4-288" aria-hidden="true" tabindex="-1"></a>                name <span class="op">=</span> <span class="st">"CAL: efficient high mean"</span></span>
<span id="cb4-289"><a href="#cb4-289" aria-hidden="true" tabindex="-1"></a>            )           </span>
<span id="cb4-290"><a href="#cb4-290" aria-hidden="true" tabindex="-1"></a>            fig.add_trace(trace6)   </span>
<span id="cb4-291"><a href="#cb4-291" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb4-292"><a href="#cb4-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-293"><a href="#cb4-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-294"><a href="#cb4-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-295"><a href="#cb4-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-296"><a href="#cb4-296" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Utility plot info</span></span>
<span id="cb4-297"><a href="#cb4-297" aria-hidden="true" tabindex="-1"></a>    u1, wgt1, wgt_rf1, wgt_lo1, wgt_hi1 <span class="op">=</span> opt_utility(mns, cov, Shorts, rs, rb, raver1)</span>
<span id="cb4-298"><a href="#cb4-298" aria-hidden="true" tabindex="-1"></a>    u2, wgt2, wgt_rf2, wgt_lo2, wgt_hi2 <span class="op">=</span> opt_utility(mns, cov, Shorts, rs, rb, raver2)</span>
<span id="cb4-299"><a href="#cb4-299" aria-hidden="true" tabindex="-1"></a>    string1<span class="op">=</span><span class="st">'Risk Aversion='</span><span class="op">+</span><span class="bu">str</span>(raver1)</span>
<span id="cb4-300"><a href="#cb4-300" aria-hidden="true" tabindex="-1"></a>    string2<span class="op">=</span><span class="st">'Risk Aversion='</span><span class="op">+</span><span class="bu">str</span>(raver2)</span>
<span id="cb4-301"><a href="#cb4-301" aria-hidden="true" tabindex="-1"></a>    grid <span class="op">=</span> np.linspace(<span class="dv">0</span>,<span class="fl">1.4</span>,<span class="dv">100</span>)</span>
<span id="cb4-302"><a href="#cb4-302" aria-hidden="true" tabindex="-1"></a>    sds <span class="op">=</span> [w<span class="op">*</span>np.<span class="bu">max</span>(sds) <span class="cf">for</span> w <span class="kw">in</span> grid]</span>
<span id="cb4-303"><a href="#cb4-303" aria-hidden="true" tabindex="-1"></a>    eret1 <span class="op">=</span> [u1 <span class="op">+</span> <span class="fl">0.5</span><span class="op">*</span>raver1<span class="op">*</span> (sd<span class="op">**</span><span class="dv">2</span>) <span class="cf">for</span> sd <span class="kw">in</span> sds]</span>
<span id="cb4-304"><a href="#cb4-304" aria-hidden="true" tabindex="-1"></a>    eret2 <span class="op">=</span> [u2 <span class="op">+</span> <span class="fl">0.5</span><span class="op">*</span>raver2<span class="op">*</span> (sd<span class="op">**</span><span class="dv">2</span>) <span class="cf">for</span> sd <span class="kw">in</span> sds] </span>
<span id="cb4-305"><a href="#cb4-305" aria-hidden="true" tabindex="-1"></a>    <span class="co"># df = pd.DataFrame(data={'Standard Deviation': sds, string1: U1, string2: U2})</span></span>
<span id="cb4-306"><a href="#cb4-306" aria-hidden="true" tabindex="-1"></a>    string <span class="op">=</span> <span class="st">"indifference curve for &lt;br&gt; optimal utility for risk aversion of "</span><span class="op">+</span><span class="bu">str</span>(np.<span class="bu">round</span>(raver1,<span class="dv">1</span>))<span class="op">+</span><span class="st">"&lt;extra&gt;&lt;/extra&gt;"</span></span>
<span id="cb4-307"><a href="#cb4-307" aria-hidden="true" tabindex="-1"></a>    trace7 <span class="op">=</span> go.Scatter(</span>
<span id="cb4-308"><a href="#cb4-308" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span>sds, y<span class="op">=</span>eret1, mode<span class="op">=</span><span class="st">"lines"</span>, hovertemplate<span class="op">=</span>string, name<span class="op">=</span>string1, line<span class="op">=</span><span class="bu">dict</span>(color<span class="op">=</span><span class="st">"purple"</span>,dash<span class="op">=</span><span class="st">'dot'</span>),</span>
<span id="cb4-309"><a href="#cb4-309" aria-hidden="true" tabindex="-1"></a>    )  </span>
<span id="cb4-310"><a href="#cb4-310" aria-hidden="true" tabindex="-1"></a>    string <span class="op">=</span> <span class="st">"indifference curve for &lt;br&gt; optimal utility for risk aversion of "</span><span class="op">+</span><span class="bu">str</span>(np.<span class="bu">round</span>(raver2,<span class="dv">1</span>))<span class="op">+</span><span class="st">"&lt;extra&gt;&lt;/extra&gt;"</span></span>
<span id="cb4-311"><a href="#cb4-311" aria-hidden="true" tabindex="-1"></a>    trace8 <span class="op">=</span> go.Scatter(</span>
<span id="cb4-312"><a href="#cb4-312" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span>sds, y<span class="op">=</span>eret2, mode<span class="op">=</span><span class="st">"lines"</span>, hovertemplate<span class="op">=</span>string, name<span class="op">=</span>string2, line<span class="op">=</span><span class="bu">dict</span>(color<span class="op">=</span><span class="st">"purple"</span>),</span>
<span id="cb4-313"><a href="#cb4-313" aria-hidden="true" tabindex="-1"></a>    )  </span>
<span id="cb4-314"><a href="#cb4-314" aria-hidden="true" tabindex="-1"></a>    fig.add_trace(trace7) </span>
<span id="cb4-315"><a href="#cb4-315" aria-hidden="true" tabindex="-1"></a>    fig.add_trace(trace8) </span>
<span id="cb4-316"><a href="#cb4-316" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb4-317"><a href="#cb4-317" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-318"><a href="#cb4-318" aria-hidden="true" tabindex="-1"></a>    fig.layout.xaxis[<span class="st">"title"</span>] <span class="op">=</span> <span class="st">"Standard Deviation"</span></span>
<span id="cb4-319"><a href="#cb4-319" aria-hidden="true" tabindex="-1"></a>    fig.layout.yaxis[<span class="st">"title"</span>] <span class="op">=</span> <span class="st">"Expected Return"</span></span>
<span id="cb4-320"><a href="#cb4-320" aria-hidden="true" tabindex="-1"></a>    fig.update_xaxes(<span class="bu">range</span><span class="op">=</span>[<span class="dv">0</span>, <span class="fl">1.25</span> <span class="op">*</span> df[<span class="st">"stdev"</span>].<span class="bu">max</span>()])</span>
<span id="cb4-321"><a href="#cb4-321" aria-hidden="true" tabindex="-1"></a>    fig.update_yaxes(<span class="bu">range</span><span class="op">=</span>[<span class="dv">0</span>, <span class="fl">1.25</span> <span class="op">*</span> df[<span class="st">"mean"</span>].<span class="bu">max</span>()])</span>
<span id="cb4-322"><a href="#cb4-322" aria-hidden="true" tabindex="-1"></a>    fig.update_yaxes(tickformat<span class="op">=</span><span class="st">".0%"</span>)</span>
<span id="cb4-323"><a href="#cb4-323" aria-hidden="true" tabindex="-1"></a>    fig.update_xaxes(tickformat<span class="op">=</span><span class="st">".0%"</span>)</span>
<span id="cb4-324"><a href="#cb4-324" aria-hidden="true" tabindex="-1"></a>    fig.update_layout(legend<span class="op">=</span><span class="bu">dict</span>(yanchor<span class="op">=</span><span class="st">"top"</span>, y <span class="op">=</span><span class="fl">0.99</span>, xanchor<span class="op">=</span><span class="st">"left"</span>, x<span class="op">=</span><span class="fl">0.74</span>))</span>
<span id="cb4-325"><a href="#cb4-325" aria-hidden="true" tabindex="-1"></a>    <span class="co"># fig.show()</span></span>
<span id="cb4-326"><a href="#cb4-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-327"><a href="#cb4-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-328"><a href="#cb4-328" aria-hidden="true" tabindex="-1"></a>    <span class="co">#2nd plot of risky asset share as function of risk aversion:</span></span>
<span id="cb4-329"><a href="#cb4-329" aria-hidden="true" tabindex="-1"></a>    ravers <span class="op">=</span> np.arange(<span class="fl">0.5</span>,<span class="dv">20</span>,<span class="fl">0.1</span>)</span>
<span id="cb4-330"><a href="#cb4-330" aria-hidden="true" tabindex="-1"></a>    cd <span class="op">=</span> np.empty(shape<span class="op">=</span>(<span class="bu">len</span>(ravers),<span class="dv">5</span>,<span class="dv">1</span>),dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb4-331"><a href="#cb4-331" aria-hidden="true" tabindex="-1"></a>    wgts <span class="op">=</span> [opt_utility(mns, cov, Shorts, rs, rb, A) <span class="cf">for</span> A <span class="kw">in</span> ravers]</span>
<span id="cb4-332"><a href="#cb4-332" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.DataFrame(wgts, columns<span class="op">=</span>[<span class="st">'u'</span>,<span class="st">'wgt_risky'</span>,<span class="st">'wgt_rf'</span>,<span class="st">'wgt_lowrisk'</span>,<span class="st">'wgt_highrisk'</span>])</span>
<span id="cb4-333"><a href="#cb4-333" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (rb <span class="op">!=</span> rs):</span>
<span id="cb4-334"><a href="#cb4-334" aria-hidden="true" tabindex="-1"></a>        custdat <span class="op">=</span> np.empty(shape<span class="op">=</span>(df.shape[<span class="dv">0</span>],<span class="dv">3</span>,<span class="dv">1</span>), dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb4-335"><a href="#cb4-335" aria-hidden="true" tabindex="-1"></a>        custdat[:,<span class="dv">0</span>] <span class="op">=</span> np.array(<span class="dv">100</span><span class="op">*</span>df.wgt_rf).reshape(<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>)</span>
<span id="cb4-336"><a href="#cb4-336" aria-hidden="true" tabindex="-1"></a>        custdat[:,<span class="dv">1</span>] <span class="op">=</span> np.array(<span class="dv">100</span><span class="op">*</span>df.wgt_lowrisk).reshape(<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>)</span>
<span id="cb4-337"><a href="#cb4-337" aria-hidden="true" tabindex="-1"></a>        custdat[:,<span class="dv">2</span>] <span class="op">=</span> np.array(<span class="dv">100</span><span class="op">*</span>df.wgt_highrisk).reshape(<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>)</span>
<span id="cb4-338"><a href="#cb4-338" aria-hidden="true" tabindex="-1"></a>        string <span class="op">=</span> <span class="st">'risk-aversion: %</span><span class="sc">{x:.1f}</span><span class="st">&lt;br&gt;'</span></span>
<span id="cb4-339"><a href="#cb4-339" aria-hidden="true" tabindex="-1"></a>        string<span class="op">+=</span> <span class="st">'risk-free: %</span><span class="sc">{customdata[0]:.0f}</span><span class="st">%&lt;br&gt;'</span></span>
<span id="cb4-340"><a href="#cb4-340" aria-hidden="true" tabindex="-1"></a>        string<span class="op">+=</span> <span class="st">'efficient low risk: %</span><span class="sc">{customdata[1]:.0f}</span><span class="st">%&lt;br&gt;'</span></span>
<span id="cb4-341"><a href="#cb4-341" aria-hidden="true" tabindex="-1"></a>        string<span class="op">+=</span> <span class="st">'efficient high mean: %</span><span class="sc">{customdata[2]:.0f}</span><span class="st">%&lt;br&gt;'</span></span>
<span id="cb4-342"><a href="#cb4-342" aria-hidden="true" tabindex="-1"></a>        string<span class="op">+=</span> <span class="st">'&lt;extra&gt;&lt;/extra&gt;'</span></span>
<span id="cb4-343"><a href="#cb4-343" aria-hidden="true" tabindex="-1"></a>        trace1 <span class="op">=</span> go.Scatter(x<span class="op">=</span>ravers,y<span class="op">=</span>df[<span class="st">'wgt_risky'</span>],mode<span class="op">=</span><span class="st">'lines'</span>,customdata<span class="op">=</span>custdat,hovertemplate<span class="op">=</span>string, line<span class="op">=</span><span class="bu">dict</span>(color<span class="op">=</span><span class="st">"orange"</span>))</span>
<span id="cb4-344"><a href="#cb4-344" aria-hidden="true" tabindex="-1"></a>        fig <span class="op">=</span> go.Figure()</span>
<span id="cb4-345"><a href="#cb4-345" aria-hidden="true" tabindex="-1"></a>        fig.add_trace(trace1)</span>
<span id="cb4-346"><a href="#cb4-346" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb4-347"><a href="#cb4-347" aria-hidden="true" tabindex="-1"></a>        custdat <span class="op">=</span> np.empty(shape<span class="op">=</span>(df.shape[<span class="dv">0</span>],<span class="dv">2</span>,<span class="dv">1</span>), dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb4-348"><a href="#cb4-348" aria-hidden="true" tabindex="-1"></a>        custdat[:,<span class="dv">0</span>] <span class="op">=</span> np.array(<span class="dv">100</span><span class="op">*</span>df.wgt_rf).reshape(<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>)</span>
<span id="cb4-349"><a href="#cb4-349" aria-hidden="true" tabindex="-1"></a>        custdat[:,<span class="dv">1</span>] <span class="op">=</span> np.array(<span class="dv">100</span><span class="op">*</span>df.wgt_lowrisk).reshape(<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>)</span>
<span id="cb4-350"><a href="#cb4-350" aria-hidden="true" tabindex="-1"></a>        string <span class="op">=</span> <span class="st">'risk-aversion: %</span><span class="sc">{x:.1f}</span><span class="st">&lt;br&gt;'</span></span>
<span id="cb4-351"><a href="#cb4-351" aria-hidden="true" tabindex="-1"></a>        string<span class="op">+=</span> <span class="st">'risk-free: %</span><span class="sc">{customdata[0]:.0f}</span><span class="st">%&lt;br&gt;'</span></span>
<span id="cb4-352"><a href="#cb4-352" aria-hidden="true" tabindex="-1"></a>        string<span class="op">+=</span> <span class="st">'tangency: %</span><span class="sc">{customdata[1]:.0f}</span><span class="st">%&lt;br&gt;'</span></span>
<span id="cb4-353"><a href="#cb4-353" aria-hidden="true" tabindex="-1"></a>        string<span class="op">+=</span> <span class="st">'&lt;extra&gt;&lt;/extra&gt;'</span></span>
<span id="cb4-354"><a href="#cb4-354" aria-hidden="true" tabindex="-1"></a>        trace1 <span class="op">=</span> go.Scatter(x<span class="op">=</span>ravers,y<span class="op">=</span>df[<span class="st">'wgt_risky'</span>],mode<span class="op">=</span><span class="st">'lines'</span>,customdata<span class="op">=</span>custdat,hovertemplate<span class="op">=</span>string, line<span class="op">=</span><span class="bu">dict</span>(color<span class="op">=</span><span class="st">"orange"</span>))</span>
<span id="cb4-355"><a href="#cb4-355" aria-hidden="true" tabindex="-1"></a>        fig <span class="op">=</span> go.Figure()</span>
<span id="cb4-356"><a href="#cb4-356" aria-hidden="true" tabindex="-1"></a>        fig.add_trace(trace1)       </span>
<span id="cb4-357"><a href="#cb4-357" aria-hidden="true" tabindex="-1"></a>    fig.layout.xaxis[<span class="st">"title"</span>] <span class="op">=</span> <span class="st">"Risk Aversion"</span></span>
<span id="cb4-358"><a href="#cb4-358" aria-hidden="true" tabindex="-1"></a>    fig.layout.yaxis[<span class="st">"title"</span>] <span class="op">=</span> <span class="st">"Weight in Risky Assets"</span></span>
<span id="cb4-359"><a href="#cb4-359" aria-hidden="true" tabindex="-1"></a>    fig.update_yaxes(tickformat<span class="op">=</span><span class="st">".1%"</span>)</span>
<span id="cb4-360"><a href="#cb4-360" aria-hidden="true" tabindex="-1"></a>    fig.update_xaxes(tickformat<span class="op">=</span><span class="st">".2"</span>)</span>
<span id="cb4-361"><a href="#cb4-361" aria-hidden="true" tabindex="-1"></a>    fig.update_layout(legend<span class="op">=</span><span class="bu">dict</span>(yanchor<span class="op">=</span><span class="st">"top"</span>, y <span class="op">=</span><span class="fl">0.99</span>, xanchor<span class="op">=</span><span class="st">"left"</span>, x<span class="op">=</span><span class="fl">0.74</span>))</span>
<span id="cb4-362"><a href="#cb4-362" aria-hidden="true" tabindex="-1"></a>    fig.show()</span>
<span id="cb4-363"><a href="#cb4-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-364"><a href="#cb4-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-365"><a href="#cb4-365" aria-hidden="true" tabindex="-1"></a>figtbl(mn_stock,mn_bond,sd_stock,sd_bond,corr,rs,extra,raver1, raver2, <span class="st">"Stock"</span>,<span class="st">"Bond"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-diffsaveborrow-cal-allocation-by-riskaversion" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">

<div>                            <div id="f8f90bb9-d83f-4066-9404-d6832c0e002a" class="plotly-graph-div" style="height:525px; width:100%;"></div>            <script type="text/javascript">                require(["plotly"], function(Plotly) {                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("f8f90bb9-d83f-4066-9404-d6832c0e002a")) {                    Plotly.newPlot(                        "f8f90bb9-d83f-4066-9404-d6832c0e002a",                        [{"customdata":[[[-611.5293903693475],[0.0],[711.5293903693475]],[[-492.9411586411231],[0.0],[592.941158641123]],[[-408.2352788352483],[0.0],[508.2352788352483]],[[-344.7058689808423],[0.0],[444.7058689808423]],[[-295.2941057607487],[0.0],[395.2941057607487]],[[-255.76469518467383],[0.0],[355.7646951846738]],[[-223.42245016788533],[0.0],[323.42245016788536]],[[-196.47057932056157],[0.0],[296.47057932056157]],[[-173.6651501420568],[0.0],[273.6651501420568]],[[-154.11763941762416],[0.0],[254.11763941762416]],[[-137.17646345644923],[0.0],[237.17646345644923]],[[-122.35293449042119],[0.0],[222.3529344904212]],[[-109.27335010863169],[0.0],[209.2733501086317]],[[-97.64705288037436],[0.0],[197.64705288037436]],[[-87.24457641298625],[0.0],[187.24457641298625]],[[-77.88234759233694],[0.0],[177.88234759233694]],[[-69.41175961174946],[0.0],[169.41175961174946]],[[-61.711225083942665],[0.0],[161.71122508394268]],[[-54.68030225420601],[0.0],[154.68030225420603]],[[-48.23528966028079],[0.0],[148.23528966028078]],[[-42.30587807386954],[0.0],[142.30587807386954]],[[-36.832575071028394],[0.0],[136.8325750710284]],[[-31.764701920249582],[0.0],[131.7647019202496]],[[-27.0588197088121],[0.0],[127.0588197088121]],[[-22.677481098163412],[0.0],[122.67748109816341]],[[-18.588231728224613],[0.0],[118.58823172822461]],[[-14.762804898281878],[0.0],[114.76280489828187]],[[-11.176467245210597],[0.0],[111.1764672452106]],[[-7.807483389295111],[0.0],[107.80748338929511]],[[-4.636675054315842],[0.0],[104.63667505431584]],[[-1.6470557670496877],[0.0],[101.6470557670497]],[[0.0],[1.5560985332369175],[98.44390146676308]],[[0.0],[5.0888537414498085],[94.91114625855019]],[[0.0],[8.435674465019897],[91.5643255349801]],[[0.0],[11.61086335661205],[88.38913664338794]],[[0.0],[14.62729280362456],[85.37270719637544]],[[0.0],[17.496579350782852],[82.50342064921715]],[[0.0],[20.22923320521927],[79.77076679478074]],[[0.0],[22.834786880379596],[77.1652131196204]],[[0.0],[25.32190629757809],[74.6780937024219]],[[0.0],[27.698487074012213],[72.3015129259878]],[[0.0],[29.97173825147093],[70.02826174852908]],[[0.0],[32.148255336271845],[67.85174466372817]],[[0.0],[34.23408420920603],[65.76591579079395]],[[0.0],[36.23477720977558],[63.76522279022443]],[[0.0],[38.155442490322336],[61.84455750967766]],[[0.0],[40.000787563788826],[59.99921243621118]],[[0.0],[41.77515782673738],[58.22484217326262]],[[0.0],[43.48257072127276],[56.51742927872725]],[[0.0],[45.12674610119574],[54.873253898804265]],[[0.0],[46.711133285485154],[53.288866714514846]],[[0.0],[48.238935213192796],[51.7610647868072]],[[0.0],[49.71313005571775],[50.28686994428225]],[[0.0],[51.136490593328],[48.863509406672]],[[0.0],[52.51160162118875],[47.48839837881125]],[[0.0],[53.84087561478751],[46.15912438521249]],[[0.0],[55.126566854497774],[44.873433145502226]],[[0.0],[56.37078418324963],[43.62921581675037]],[[0.0],[57.57550254918398],[42.42449745081602]],[[0.0],[58.74257346618289],[41.25742653381711]],[[0.0],[59.87373450881257],[40.12626549118743]],[[0.0],[60.97061794408985],[39.02938205591015]],[[0.0],[62.0347585902544],[37.9652414097456]],[[0.0],[63.06760098211998],[36.93239901788002]],[[0.0],[64.07050591335177],[35.92949408664824]],[[0.0],[65.04475641797693],[34.95524358202308]],[[0.0],[65.99156324641547],[34.00843675358453]],[[0.0],[66.91206988517516],[33.08793011482485]],[[0.0],[67.80735716396883],[32.19264283603117]],[[0.0],[68.67844748928161],[31.321552510718387]],[[0.0],[69.52630873925268],[30.473691260747316]],[[0.0],[70.35185785106664],[29.648142148933353]],[[0.0],[71.15596412880753],[28.844035871192474]],[[0.0],[71.93945229686273],[28.060547703137274]],[[0.0],[72.70310532142285],[27.296894678577143]],[[0.0],[73.44766702036897],[26.552332979631032]],[[0.0],[74.17384447983497],[25.826155520165027]],[[0.0],[74.88231029394812],[25.11768970605187]],[[0.0],[75.57370464266096],[24.426295357339043]],[[0.0],[76.24863722116632],[23.751362778833673]],[[0.0],[76.90768903311866],[23.092310966881346]],[[0.0],[77.5514140587465],[22.448585941253498]],[[0.0],[78.18034080792313],[21.81965919207687]],[[0.0],[78.79497376734577],[21.205026232654234]],[[0.0],[79.39579475015212],[20.604205249847872]],[[0.0],[79.98326415556281],[20.016735844437193]],[[0.0],[80.55782214546997],[19.44217785453003]],[[0.0],[81.11988974429217],[18.880110255707837]],[[0.0],[81.66986986787089],[18.33013013212912]],[[0.0],[82.20814828669262],[17.791851713307384]],[[0.0],[82.735094528276],[17.264905471724003]],[[0.0],[83.2510627231597],[16.74893727684029]],[[0.0],[83.7563923985613],[16.243607601438704]],[[0.0],[84.2514092234445],[15.748590776555504]],[[0.0],[84.73642570843106],[15.263574291568949]],[[0.0],[85.21174186371788],[14.788258136282128]],[[0.0],[85.6776458179099],[14.322354182090091]],[[0.0],[86.1344144004511],[13.86558559954889]],[[0.0],[86.58231369012745],[13.417686309872556]],[[0.0],[87.02159953192539],[12.978400468074614]],[[0.0],[87.45251802435575],[12.547481975644247]],[[0.0],[87.87530597919306],[12.124694020806936]],[[0.0],[88.29019135543534],[11.709808644564657]],[[0.0],[88.69739366915456],[11.302606330845432]],[[0.0],[89.09712438078724],[10.902875619212772]],[[0.0],[89.48958726129928],[10.510412738700726]],[[0.0],[89.87497873855887],[10.125021261441136]],[[0.0],[90.25348822515309],[9.746511774846912]],[[0.0],[90.62529842879877],[9.374701571201227]],[[0.0],[90.99058564641557],[9.009414353584432]],[[0.0],[91.34952004285641],[8.650479957143586]],[[0.0],[91.7022659152207],[8.297734084779297]],[[0.0],[92.04898194361294],[7.951018056387049]],[[0.0],[92.38982142915107],[7.610178570848925]],[[0.0],[92.72493251997427],[7.2750674800257205]],[[0.0],[93.05445842595044],[6.945541574049551]],[[0.0],[93.37853762273693],[6.621462377263065]],[[0.0],[93.69730404580558],[6.302695954194415]],[[0.0],[94.01088727500321],[5.989112724996792]],[[0.0],[94.31941271018151],[5.680587289818484]],[[0.0],[94.62300173839697],[5.376998261603038]],[[0.0],[94.92177189314869],[5.078228106851313]],[[0.0],[95.21583700609331],[4.784162993906693]],[[0.0],[95.50530735164816],[4.49469264835185]],[[0.0],[95.7902897848688],[4.2097102151311905]],[[0.0],[96.07088787296298],[3.9291121270370155]],[[0.0],[96.34720202078093],[3.652797979219069]],[[0.0],[96.61932959060162],[3.3806704093983786]],[[0.0],[96.88736501651525],[3.112634983484752]],[[0.0],[97.1513999136839],[2.8486000863161]],[[0.0],[97.41152318274634],[2.58847681725366]],[[0.0],[97.66782110961668],[2.3321788903833185]],[[0.0],[97.92037746091228],[2.079622539087722]],[[0.0],[98.16927357523258],[1.830726424767426]],[[0.0],[98.4145884504979],[1.5854115495020915]],[[0.0],[98.65639882754516],[1.3436011724548447]],[[0.0],[98.89477927016624],[1.1052207298337668]],[[0.0],[99.12980224176444],[0.8701977582355691]],[[0.0],[99.36153817879485],[0.6384618212051607]],[[0.0],[99.59005556114427],[0.40994443885572496]],[[0.0],[99.81542097959924],[0.1845790204007658]],[[0.11683138825847594],[99.88316861174152],[0.0]],[[0.7963087257533252],[99.20369127424668],[0.0]],[[1.4666039370658024],[98.5333960629342],[0.0]],[[2.1279018972197083],[97.87209810278028],[0.0]],[[2.7803825512382474],[97.21961744876175],[0.0]],[[3.424221077388978],[96.57577892261102],[0.0]],[[4.05958804398513],[95.94041195601487],[0.0]],[[4.686649560037514],[95.31335043996249],[0.0]],[[5.30556742003726],[94.69443257996274],[0.0]],[[5.916499243133799],[94.0835007568662],[0.0]],[[6.519598606959843],[93.48040139304015],[0.0]],[[7.115015176342265],[92.88498482365773],[0.0]],[[7.702894827124929],[92.29710517287508],[0.0]],[[8.28337976531911],[91.71662023468089],[0.0]],[[8.856608641785868],[91.14339135821413],[0.0]],[[9.422716662644326],[90.57728333735568],[0.0]],[[9.981835695590979],[90.01816430440903],[0.0]],[[10.534094372305148],[89.46590562769485],[0.0]],[[11.079618187108176],[88.92038181289182],[0.0]],[[11.618529592034776],[88.38147040796522],[0.0]],[[12.150948088468304],[87.84905191153169],[0.0]],[[12.676990315483462],[87.32300968451653],[0.0]],[[13.196770135034154],[86.80322986496584],[0.0]],[[13.710398714116788],[86.28960128588321],[0.0]],[[14.21798460403375],[85.78201539596625],[0.0]],[[14.719633816875676],[85.28036618312433],[0.0]],[[15.215449899335686],[84.78455010066432],[0.0]],[[15.705534003963795],[84.29446599603621],[0.0]],[[16.18998495796401],[83.81001504203599],[0.0]],[[16.66889932963278],[83.33110067036722],[0.0]],[[17.142371492532614],[82.85762850746738],[0.0]],[[17.610493687490035],[82.38950631250997],[0.0]],[[18.073356082504155],[81.92664391749585],[0.0]],[[18.53104683064658],[81.46895316935343],[0.0]],[[18.98365212603187],[81.01634787396813],[0.0]],[[19.43125625793225],[80.56874374206775],[0.0]],[[19.87394166310844],[80.12605833689156],[0.0]],[[20.311788976424804],[79.68821102357519],[0.0]],[[20.744877079813783],[79.25512292018621],[0.0]],[[21.173283149652644],[78.82671685034735],[0.0]],[[21.59708270261149],[78.40291729738851],[0.0]],[[22.016349640030676],[77.98365035996933],[0.0]],[[22.431156290881592],[77.56884370911841],[0.0]],[[22.841573453363683],[77.15842654663632],[0.0]],[[23.247670435188095],[76.7523295648119],[0.0]],[[23.649515092595475],[76.35048490740452],[0.0]],[[24.047173868154893],[75.95282613184511],[0.0]],[[24.44071182738724],[75.55928817261275],[0.0]],[[24.830192694256368],[75.16980730574363],[0.0]],[[25.215678885567883],[74.78432111443212],[0.0]],[[25.59723154431498],[74.40276845568502],[0.0]],[[25.974910572008824],[74.02508942799118],[0.0]],[[26.348774660028983],[73.65122533997102],[0.0]],[[26.71888132002883],[73.28111867997117],[0.0]]],"hovertemplate":"risk-aversion: %{x:.1f}<br>risk-free: %{customdata[0]:.0f}%<br>efficient low risk: %{customdata[1]:.0f}%<br>efficient high mean: %{customdata[2]:.0f}%<br><extra></extra>","line":{"color":"orange"},"mode":"lines","x":[0.5,0.6,0.7,0.7999999999999999,0.8999999999999999,0.9999999999999999,1.0999999999999999,1.1999999999999997,1.2999999999999998,1.4,1.4999999999999998,1.5999999999999996,1.6999999999999997,1.7999999999999998,1.8999999999999997,1.9999999999999996,2.0999999999999996,2.1999999999999997,2.3,2.3999999999999995,2.4999999999999996,2.5999999999999996,2.6999999999999993,2.7999999999999994,2.8999999999999995,2.9999999999999996,3.0999999999999996,3.1999999999999993,3.2999999999999994,3.3999999999999995,3.499999999999999,3.599999999999999,3.6999999999999993,3.7999999999999994,3.8999999999999995,3.999999999999999,4.1,4.199999999999999,4.299999999999999,4.399999999999999,4.499999999999999,4.599999999999999,4.699999999999999,4.799999999999999,4.899999999999999,4.999999999999999,5.099999999999999,5.199999999999999,5.299999999999999,5.399999999999999,5.499999999999999,5.599999999999999,5.699999999999999,5.799999999999999,5.899999999999999,5.999999999999999,6.099999999999999,6.199999999999998,6.299999999999999,6.399999999999999,6.499999999999998,6.599999999999999,6.699999999999998,6.799999999999999,6.899999999999999,6.999999999999998,7.099999999999999,7.199999999999998,7.299999999999999,7.399999999999999,7.499999999999998,7.599999999999999,7.699999999999998,7.799999999999998,7.899999999999999,7.999999999999998,8.099999999999998,8.2,8.299999999999997,8.399999999999999,8.499999999999998,8.599999999999998,8.699999999999998,8.799999999999999,8.899999999999999,8.999999999999998,9.099999999999998,9.199999999999998,9.299999999999997,9.399999999999999,9.499999999999998,9.599999999999998,9.699999999999998,9.799999999999997,9.899999999999999,9.999999999999998,10.099999999999998,10.199999999999998,10.299999999999997,10.399999999999999,10.499999999999998,10.599999999999998,10.699999999999998,10.799999999999997,10.899999999999999,10.999999999999998,11.099999999999998,11.199999999999998,11.299999999999997,11.399999999999997,11.499999999999998,11.599999999999998,11.699999999999998,11.799999999999997,11.899999999999997,11.999999999999998,12.099999999999998,12.199999999999998,12.299999999999997,12.399999999999997,12.499999999999996,12.599999999999998,12.699999999999998,12.799999999999997,12.899999999999997,12.999999999999996,13.099999999999998,13.199999999999998,13.299999999999997,13.399999999999997,13.499999999999996,13.599999999999998,13.699999999999998,13.799999999999997,13.899999999999997,13.999999999999996,14.099999999999998,14.199999999999998,14.299999999999997,14.399999999999997,14.499999999999996,14.599999999999996,14.699999999999998,14.799999999999997,14.899999999999997,14.999999999999996,15.099999999999996,15.199999999999998,15.299999999999997,15.399999999999997,15.499999999999996,15.599999999999996,15.699999999999996,15.799999999999997,15.899999999999997,15.999999999999996,16.099999999999994,16.199999999999996,16.299999999999997,16.4,16.499999999999996,16.599999999999998,16.699999999999996,16.799999999999997,16.899999999999995,16.999999999999996,17.099999999999998,17.199999999999996,17.299999999999997,17.399999999999995,17.499999999999996,17.599999999999998,17.699999999999996,17.799999999999997,17.899999999999995,17.999999999999996,18.099999999999994,18.199999999999996,18.299999999999997,18.399999999999995,18.499999999999996,18.599999999999994,18.699999999999996,18.799999999999997,18.899999999999995,18.999999999999996,19.099999999999994,19.199999999999996,19.299999999999997,19.399999999999995,19.499999999999996,19.599999999999994,19.699999999999996,19.799999999999997,19.899999999999995],"y":[7.115293903693476,5.929411586411231,5.082352788352483,4.447058689808423,3.9529410576074873,3.5576469518467384,3.2342245016788533,2.964705793205616,2.736651501420568,2.5411763941762415,2.3717646345644923,2.223529344904212,2.092733501086317,1.9764705288037436,1.8724457641298624,1.7788234759233694,1.6941175961174946,1.6171122508394267,1.5468030225420601,1.482352896602808,1.4230587807386954,1.368325750710284,1.3176470192024958,1.270588197088121,1.226774810981634,1.1858823172822461,1.1476280489828188,1.111764672452106,1.0780748338929511,1.0463667505431584,1.0164705576704969,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,0.9988316861174152,0.9920369127424667,0.985333960629342,0.9787209810278029,0.9721961744876175,0.9657577892261102,0.9594041195601487,0.9531335043996249,0.9469443257996274,0.940835007568662,0.9348040139304016,0.9288498482365773,0.9229710517287507,0.9171662023468089,0.9114339135821413,0.9057728333735567,0.9001816430440902,0.8946590562769485,0.8892038181289182,0.8838147040796522,0.878490519115317,0.8732300968451654,0.8680322986496585,0.8628960128588321,0.8578201539596625,0.8528036618312432,0.8478455010066431,0.842944659960362,0.8381001504203599,0.8333110067036722,0.8285762850746738,0.8238950631250996,0.8192664391749584,0.8146895316935342,0.8101634787396813,0.8056874374206775,0.8012605833689156,0.796882110235752,0.7925512292018622,0.7882671685034736,0.7840291729738851,0.7798365035996933,0.7756884370911841,0.7715842654663632,0.767523295648119,0.7635048490740453,0.7595282613184511,0.7555928817261276,0.7516980730574363,0.7478432111443212,0.7440276845568502,0.7402508942799118,0.7365122533997102,0.7328111867997117],"type":"scatter"}],                        {"template":{"data":{"histogram2dcontour":[{"type":"histogram2dcontour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"choropleth":[{"type":"choropleth","colorbar":{"outlinewidth":0,"ticks":""}}],"histogram2d":[{"type":"histogram2d","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmap":[{"type":"heatmap","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmapgl":[{"type":"heatmapgl","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"contourcarpet":[{"type":"contourcarpet","colorbar":{"outlinewidth":0,"ticks":""}}],"contour":[{"type":"contour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"surface":[{"type":"surface","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"mesh3d":[{"type":"mesh3d","colorbar":{"outlinewidth":0,"ticks":""}}],"scatter":[{"fillpattern":{"fillmode":"overlay","size":10,"solidity":0.2},"type":"scatter"}],"parcoords":[{"type":"parcoords","line":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolargl":[{"type":"scatterpolargl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"scattergeo":[{"type":"scattergeo","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolar":[{"type":"scatterpolar","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"scattergl":[{"type":"scattergl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatter3d":[{"type":"scatter3d","line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattermapbox":[{"type":"scattermapbox","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterternary":[{"type":"scatterternary","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattercarpet":[{"type":"scattercarpet","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"type":"carpet"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}],"barpolar":[{"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"pie":[{"automargin":true,"type":"pie"}]},"layout":{"autotypenumbers":"strict","colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"hovermode":"closest","hoverlabel":{"align":"left"},"paper_bgcolor":"white","plot_bgcolor":"#E5ECF6","polar":{"bgcolor":"#E5ECF6","angularaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"radialaxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"ternary":{"bgcolor":"#E5ECF6","aaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"baxis":{"gridcolor":"white","linecolor":"white","ticks":""},"caxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]]},"xaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"yaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"scene":{"xaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"yaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"zaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"geo":{"bgcolor":"white","landcolor":"#E5ECF6","subunitcolor":"white","showland":true,"showlakes":true,"lakecolor":"white"},"title":{"x":0.05},"mapbox":{"style":"light"}}},"xaxis":{"title":{"text":"Risk Aversion"},"tickformat":".2"},"yaxis":{"title":{"text":"Weight in Risky Assets"},"tickformat":".1%"},"legend":{"yanchor":"top","y":0.99,"xanchor":"left","x":0.74}},                        {"responsive": true}                    ).then(function(){
                            
var gd = document.getElementById('f8f90bb9-d83f-4066-9404-d6832c0e002a');
var x = new MutationObserver(function (mutations, observer) {{
        var display = window.getComputedStyle(gd).display;
        if (!display || display === 'none') {{
            console.log([gd, 'removed!']);
            Plotly.purge(gd);
            observer.disconnect();
        }}
}});

// Listen for the removal of the full notebook cells
var notebookContainer = gd.closest('#notebook-container');
if (notebookContainer) {{
    x.observe(notebookContainer, {childList: true});
}}

// Listen for the clearing of the current output cell
var outputEl = gd.closest('.output');
if (outputEl) {{
    x.observe(outputEl, {childList: true});
}}

                        })                };                });            </script>        </div>
<p></p><figcaption class="figure-caption">Figure&nbsp;4.4: Preferences and Efficient Portfolios</figcaption><p></p>
</figure>
</div>
</div>
</section>
</section>
<section id="short-sales-constraints" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="short-sales-constraints"><span class="header-section-number">4.2</span> Short-Sales Constraints</h2>
<section id="short-sales-and-hedging" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="short-sales-and-hedging">Short-Sales and Hedging</h3>
<p>In <a href="#sec-diversification"><span class="quarto-unresolved-ref">sec-diversification</span></a>, we assumed that short-selling is allowed. Short-selling of some assets may sometimes improve mean-variance efficiency. In particular, short-selling a security that is positively correlated with another holding can <strong>hedge</strong> price movements in the long asset position.</p>
<p><a href="#fig-frontier-gmv-shorting">Figure&nbsp;<span class="quarto-unresolved-ref">fig-frontier-gmv-shorting</span></a> shows how the GMV portfolio and frontier changes if short-sales are not allowed for any of the three equity portfolios. Notice that the global minimum variance portfolio with short-selling involves shorting emerging market equity and invests the proceeds and initial capital in a combination of US and developed international equities. Without this possibility, the GMV portfolio without short-sales has a higher standard deviation (and invests nothing in the emerging market portfolio).</p>
<div class="cell" data-execution_count="6">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.graph_objects <span class="im">as</span> go</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Based on French return series</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Asset 1: US Equity</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Asset 2: Developed International</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Asset 1: Emerging Market</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>mn1<span class="op">=</span> <span class="dv">6</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>mn2<span class="op">=</span> <span class="fl">6.5</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>mn3<span class="op">=</span> <span class="dv">8</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>sd1<span class="op">=</span> <span class="dv">15</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>sd2<span class="op">=</span> <span class="fl">16.5</span> </span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>sd3<span class="op">=</span> <span class="dv">21</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>corr12 <span class="op">=</span> <span class="dv">75</span> </span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>corr13 <span class="op">=</span> <span class="dv">75</span> </span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>corr23 <span class="op">=</span> <span class="dv">75</span> </span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> is_pos_def(x):</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> np.<span class="bu">all</span>(np.linalg.eigvals(x) <span class="op">&gt;</span> <span class="dv">0</span>):</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'True'</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'False'</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> figtbl(mn1, mn2, mn3, sd1, sd2, sd3, c12, c13, c23, asset_names):</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>    mns <span class="op">=</span> np.array((mn1, mn2, mn3)) <span class="op">/</span> <span class="dv">100</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>    sds <span class="op">=</span> np.array((sd1, sd2, sd3)) <span class="op">/</span> <span class="dv">100</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>    corr <span class="op">=</span> np.identity(<span class="dv">3</span>)</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>    corr[<span class="dv">0</span>,<span class="dv">1</span>] <span class="op">=</span> corr[<span class="dv">1</span>,<span class="dv">0</span>] <span class="op">=</span> c12 <span class="op">/</span> <span class="dv">100</span></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>    corr[<span class="dv">0</span>,<span class="dv">2</span>] <span class="op">=</span> corr[<span class="dv">2</span>,<span class="dv">0</span>] <span class="op">=</span> c13 <span class="op">/</span> <span class="dv">100</span></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>    corr[<span class="dv">1</span>,<span class="dv">2</span>] <span class="op">=</span> corr[<span class="dv">2</span>,<span class="dv">1</span>] <span class="op">=</span> c23 <span class="op">/</span> <span class="dv">100</span></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>    cov <span class="op">=</span> np.diag(sds) <span class="op">@</span> corr <span class="op">@</span> np.diag(sds)</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>    N <span class="op">=</span> <span class="dv">3</span></span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> custom(string, ports):</span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>        cd <span class="op">=</span> np.empty(shape<span class="op">=</span>(<span class="bu">len</span>(ports), N, <span class="dv">1</span>), dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(N):</span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>            cd[:, i] <span class="op">=</span> np.array([w[i] <span class="cf">for</span> w <span class="kw">in</span> ports]).reshape(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>        string <span class="op">+=</span> <span class="st">"&lt;br&gt;"</span></span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(N):</span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>            string <span class="op">+=</span> asset_names[i]</span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>            string <span class="op">+=</span> <span class="st">": %{customdata["</span></span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>            string <span class="op">+=</span> <span class="bu">str</span>(i)</span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>            string <span class="op">+=</span> <span class="st">"]:.1%}&lt;br&gt;"</span></span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>        string <span class="op">+=</span> <span class="st">"&lt;extra&gt;&lt;/extra&gt;"</span></span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> string, cd</span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a>    <span class="co"># No short-sales</span></span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>    P <span class="op">=</span> portfolio(mns, cov, <span class="va">False</span>)</span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a>    mingrid <span class="op">=</span> np.<span class="bu">min</span>(mns)</span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a>    maxgrid <span class="op">=</span> np.<span class="bu">max</span>(mns)</span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a>    mnsFrontier <span class="op">=</span> np.linspace(mingrid, maxgrid, <span class="dv">50</span>)</span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a>    portsFrontier <span class="op">=</span> [P.frontier(m) <span class="cf">for</span> m <span class="kw">in</span> mnsFrontier]</span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a>    sdsFrontier <span class="op">=</span> [np.sqrt(w <span class="op">@</span> cov <span class="op">@</span> w) <span class="cf">for</span> w <span class="kw">in</span> portsFrontier]</span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a>    <span class="co"># string, cd = custom('frontier', portsFrontier)</span></span>
<span id="cb5-58"><a href="#cb5-58" aria-hidden="true" tabindex="-1"></a>    string, cd <span class="op">=</span> custom(<span class="st">'frontier w/o short sales'</span>, portsFrontier)</span>
<span id="cb5-59"><a href="#cb5-59" aria-hidden="true" tabindex="-1"></a>    trace1 <span class="op">=</span> go.Scatter(</span>
<span id="cb5-60"><a href="#cb5-60" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span>sdsFrontier,</span>
<span id="cb5-61"><a href="#cb5-61" aria-hidden="true" tabindex="-1"></a>        y<span class="op">=</span>mnsFrontier,</span>
<span id="cb5-62"><a href="#cb5-62" aria-hidden="true" tabindex="-1"></a>        mode<span class="op">=</span><span class="st">"lines"</span>,</span>
<span id="cb5-63"><a href="#cb5-63" aria-hidden="true" tabindex="-1"></a>        customdata<span class="op">=</span>cd,</span>
<span id="cb5-64"><a href="#cb5-64" aria-hidden="true" tabindex="-1"></a>        hovertemplate<span class="op">=</span>string,</span>
<span id="cb5-65"><a href="#cb5-65" aria-hidden="true" tabindex="-1"></a>        line<span class="op">=</span><span class="bu">dict</span>(color<span class="op">=</span><span class="st">"green"</span>),</span>
<span id="cb5-66"><a href="#cb5-66" aria-hidden="true" tabindex="-1"></a>        name<span class="op">=</span><span class="st">"3-Fund Frontier w/o short sales"</span></span>
<span id="cb5-67"><a href="#cb5-67" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb5-68"><a href="#cb5-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-69"><a href="#cb5-69" aria-hidden="true" tabindex="-1"></a>    gmv <span class="op">=</span> P.GMV</span>
<span id="cb5-70"><a href="#cb5-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-71"><a href="#cb5-71" aria-hidden="true" tabindex="-1"></a>    string <span class="op">=</span> <span class="st">"GMV portfolio w/o short sales &lt;br&gt;"</span></span>
<span id="cb5-72"><a href="#cb5-72" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(N):</span>
<span id="cb5-73"><a href="#cb5-73" aria-hidden="true" tabindex="-1"></a>        string <span class="op">+=</span> asset_names[i]<span class="op">+</span><span class="st">": "</span> <span class="op">+</span> <span class="ss">f'</span><span class="sc">{</span>gmv[i]<span class="sc">:.1%}</span><span class="ss">'</span> <span class="op">+</span> <span class="st">"&lt;br&gt;"</span></span>
<span id="cb5-74"><a href="#cb5-74" aria-hidden="true" tabindex="-1"></a>    string <span class="op">+=</span> <span class="st">"&lt;extra&gt;&lt;/extra&gt;"</span>        </span>
<span id="cb5-75"><a href="#cb5-75" aria-hidden="true" tabindex="-1"></a>    trace1a <span class="op">=</span> go.Scatter(</span>
<span id="cb5-76"><a href="#cb5-76" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span>[np.sqrt(gmv <span class="op">@</span> cov <span class="op">@</span> gmv)],</span>
<span id="cb5-77"><a href="#cb5-77" aria-hidden="true" tabindex="-1"></a>        y<span class="op">=</span>[gmv <span class="op">@</span> mns],</span>
<span id="cb5-78"><a href="#cb5-78" aria-hidden="true" tabindex="-1"></a>        mode<span class="op">=</span><span class="st">"markers"</span>,</span>
<span id="cb5-79"><a href="#cb5-79" aria-hidden="true" tabindex="-1"></a>        <span class="co"># customdata=cd,</span></span>
<span id="cb5-80"><a href="#cb5-80" aria-hidden="true" tabindex="-1"></a>        hovertemplate<span class="op">=</span>string,        </span>
<span id="cb5-81"><a href="#cb5-81" aria-hidden="true" tabindex="-1"></a>        marker<span class="op">=</span><span class="bu">dict</span>(size<span class="op">=</span><span class="dv">15</span>, color<span class="op">=</span><span class="st">"green"</span>),</span>
<span id="cb5-82"><a href="#cb5-82" aria-hidden="true" tabindex="-1"></a>        name<span class="op">=</span><span class="st">"GMV Portfolio w/o Short Sales"</span></span>
<span id="cb5-83"><a href="#cb5-83" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb5-84"><a href="#cb5-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-85"><a href="#cb5-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-86"><a href="#cb5-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-87"><a href="#cb5-87" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Allowing short-selling</span></span>
<span id="cb5-88"><a href="#cb5-88" aria-hidden="true" tabindex="-1"></a>    P <span class="op">=</span> portfolio(mns, cov, <span class="va">True</span>)</span>
<span id="cb5-89"><a href="#cb5-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-90"><a href="#cb5-90" aria-hidden="true" tabindex="-1"></a>    mingrid <span class="op">=</span> <span class="fl">0.9</span><span class="op">*</span>np.<span class="bu">min</span>(mns)</span>
<span id="cb5-91"><a href="#cb5-91" aria-hidden="true" tabindex="-1"></a>    maxgrid <span class="op">=</span> <span class="fl">1.025</span><span class="op">*</span>np.<span class="bu">max</span>(mns)</span>
<span id="cb5-92"><a href="#cb5-92" aria-hidden="true" tabindex="-1"></a>    mnsFrontier <span class="op">=</span> np.linspace(mingrid, maxgrid, <span class="dv">50</span>)</span>
<span id="cb5-93"><a href="#cb5-93" aria-hidden="true" tabindex="-1"></a>    portsFrontier <span class="op">=</span> [P.frontier(m) <span class="cf">for</span> m <span class="kw">in</span> mnsFrontier]</span>
<span id="cb5-94"><a href="#cb5-94" aria-hidden="true" tabindex="-1"></a>    sdsFrontier <span class="op">=</span> [np.sqrt(w <span class="op">@</span> cov <span class="op">@</span> w) <span class="cf">for</span> w <span class="kw">in</span> portsFrontier]</span>
<span id="cb5-95"><a href="#cb5-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-96"><a href="#cb5-96" aria-hidden="true" tabindex="-1"></a>    string, cd <span class="op">=</span> custom(<span class="st">'frontier with short sales'</span>, portsFrontier)</span>
<span id="cb5-97"><a href="#cb5-97" aria-hidden="true" tabindex="-1"></a>    trace2 <span class="op">=</span> go.Scatter(</span>
<span id="cb5-98"><a href="#cb5-98" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span>sdsFrontier,</span>
<span id="cb5-99"><a href="#cb5-99" aria-hidden="true" tabindex="-1"></a>        y<span class="op">=</span>mnsFrontier,</span>
<span id="cb5-100"><a href="#cb5-100" aria-hidden="true" tabindex="-1"></a>        mode<span class="op">=</span><span class="st">"lines"</span>,</span>
<span id="cb5-101"><a href="#cb5-101" aria-hidden="true" tabindex="-1"></a>        customdata<span class="op">=</span>cd,</span>
<span id="cb5-102"><a href="#cb5-102" aria-hidden="true" tabindex="-1"></a>        hovertemplate<span class="op">=</span>string,</span>
<span id="cb5-103"><a href="#cb5-103" aria-hidden="true" tabindex="-1"></a>        line<span class="op">=</span><span class="bu">dict</span>(color<span class="op">=</span><span class="st">"blue"</span>),</span>
<span id="cb5-104"><a href="#cb5-104" aria-hidden="true" tabindex="-1"></a>        name<span class="op">=</span><span class="st">"3-Fund Frontier with short sales"</span></span>
<span id="cb5-105"><a href="#cb5-105" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb5-106"><a href="#cb5-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-107"><a href="#cb5-107" aria-hidden="true" tabindex="-1"></a>    gmv <span class="op">=</span> P.GMV</span>
<span id="cb5-108"><a href="#cb5-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-109"><a href="#cb5-109" aria-hidden="true" tabindex="-1"></a>    string <span class="op">=</span> <span class="st">"GMV portfolio with short sales &lt;br&gt;"</span></span>
<span id="cb5-110"><a href="#cb5-110" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(N):</span>
<span id="cb5-111"><a href="#cb5-111" aria-hidden="true" tabindex="-1"></a>        string <span class="op">+=</span> asset_names[i]<span class="op">+</span><span class="st">": "</span> <span class="op">+</span> <span class="ss">f'</span><span class="sc">{</span>gmv[i]<span class="sc">:.1%}</span><span class="ss">'</span> <span class="op">+</span> <span class="st">"&lt;br&gt;"</span></span>
<span id="cb5-112"><a href="#cb5-112" aria-hidden="true" tabindex="-1"></a>    string <span class="op">+=</span> <span class="st">"&lt;extra&gt;&lt;/extra&gt;"</span></span>
<span id="cb5-113"><a href="#cb5-113" aria-hidden="true" tabindex="-1"></a>    trace2a <span class="op">=</span> go.Scatter(</span>
<span id="cb5-114"><a href="#cb5-114" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span>[np.sqrt(gmv <span class="op">@</span> cov <span class="op">@</span> gmv)],</span>
<span id="cb5-115"><a href="#cb5-115" aria-hidden="true" tabindex="-1"></a>        y <span class="op">=</span> [gmv <span class="op">@</span> mns],</span>
<span id="cb5-116"><a href="#cb5-116" aria-hidden="true" tabindex="-1"></a>        mode <span class="op">=</span> <span class="st">"markers"</span>,</span>
<span id="cb5-117"><a href="#cb5-117" aria-hidden="true" tabindex="-1"></a>        hovertemplate <span class="op">=</span> string,</span>
<span id="cb5-118"><a href="#cb5-118" aria-hidden="true" tabindex="-1"></a>        marker <span class="op">=</span> <span class="bu">dict</span>(size<span class="op">=</span><span class="dv">15</span>, color<span class="op">=</span><span class="st">"blue"</span>),</span>
<span id="cb5-119"><a href="#cb5-119" aria-hidden="true" tabindex="-1"></a>        name<span class="op">=</span><span class="st">"GMV Portfolio with Short Sales"</span></span>
<span id="cb5-120"><a href="#cb5-120" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb5-121"><a href="#cb5-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-122"><a href="#cb5-122" aria-hidden="true" tabindex="-1"></a>    trace3 <span class="op">=</span> go.Scatter(</span>
<span id="cb5-123"><a href="#cb5-123" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span>sds,</span>
<span id="cb5-124"><a href="#cb5-124" aria-hidden="true" tabindex="-1"></a>        y<span class="op">=</span>mns,</span>
<span id="cb5-125"><a href="#cb5-125" aria-hidden="true" tabindex="-1"></a>        <span class="co"># text=[1, 2, 3],</span></span>
<span id="cb5-126"><a href="#cb5-126" aria-hidden="true" tabindex="-1"></a>        <span class="co"># hovertemplate="Asset %{text}&lt;extra&gt;&lt;/extra&gt;",</span></span>
<span id="cb5-127"><a href="#cb5-127" aria-hidden="true" tabindex="-1"></a>        text<span class="op">=</span>asset_names,</span>
<span id="cb5-128"><a href="#cb5-128" aria-hidden="true" tabindex="-1"></a>        hovertemplate<span class="op">=</span><span class="st">"%</span><span class="sc">{text}</span><span class="st">&lt;extra&gt;&lt;/extra&gt;"</span>,</span>
<span id="cb5-129"><a href="#cb5-129" aria-hidden="true" tabindex="-1"></a>        mode<span class="op">=</span><span class="st">"markers"</span>,</span>
<span id="cb5-130"><a href="#cb5-130" aria-hidden="true" tabindex="-1"></a>        marker<span class="op">=</span><span class="bu">dict</span>(size<span class="op">=</span><span class="dv">15</span>, color<span class="op">=</span><span class="st">"red"</span>),</span>
<span id="cb5-131"><a href="#cb5-131" aria-hidden="true" tabindex="-1"></a>        name<span class="op">=</span><span class="st">"Underlying Assets"</span></span>
<span id="cb5-132"><a href="#cb5-132" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb5-133"><a href="#cb5-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-134"><a href="#cb5-134" aria-hidden="true" tabindex="-1"></a>    fig <span class="op">=</span> go.Figure()</span>
<span id="cb5-135"><a href="#cb5-135" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-136"><a href="#cb5-136" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> trace <span class="kw">in</span> (trace1, trace1a, trace2, trace2a, trace3):</span>
<span id="cb5-137"><a href="#cb5-137" aria-hidden="true" tabindex="-1"></a>        fig.add_trace(trace)</span>
<span id="cb5-138"><a href="#cb5-138" aria-hidden="true" tabindex="-1"></a>    <span class="co">#trace1=frontier w/o short sales</span></span>
<span id="cb5-139"><a href="#cb5-139" aria-hidden="true" tabindex="-1"></a>    <span class="co">#trace1a=GMV portfolio w/o short sales</span></span>
<span id="cb5-140"><a href="#cb5-140" aria-hidden="true" tabindex="-1"></a>    <span class="co">#trace2=frontier with short sales</span></span>
<span id="cb5-141"><a href="#cb5-141" aria-hidden="true" tabindex="-1"></a>    <span class="co">#trace2a=GMV portfolio with short sales</span></span>
<span id="cb5-142"><a href="#cb5-142" aria-hidden="true" tabindex="-1"></a>    <span class="co">#trace3=Assets</span></span>
<span id="cb5-143"><a href="#cb5-143" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb5-144"><a href="#cb5-144" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb5-145"><a href="#cb5-145" aria-hidden="true" tabindex="-1"></a>    fig.layout.xaxis[<span class="st">"title"</span>] <span class="op">=</span> <span class="st">"Standard Deviation"</span></span>
<span id="cb5-146"><a href="#cb5-146" aria-hidden="true" tabindex="-1"></a>    fig.layout.yaxis[<span class="st">"title"</span>] <span class="op">=</span> <span class="st">"Expected Return"</span></span>
<span id="cb5-147"><a href="#cb5-147" aria-hidden="true" tabindex="-1"></a>    <span class="co"># fig.update_xaxes(range=[0, 1.25 * np.max(sds)])</span></span>
<span id="cb5-148"><a href="#cb5-148" aria-hidden="true" tabindex="-1"></a>    <span class="co"># fig.update_yaxes(range=[0, 1.25 * np.max(mns)])</span></span>
<span id="cb5-149"><a href="#cb5-149" aria-hidden="true" tabindex="-1"></a>    fig.update_yaxes(tickformat<span class="op">=</span><span class="st">".1%"</span>)</span>
<span id="cb5-150"><a href="#cb5-150" aria-hidden="true" tabindex="-1"></a>    fig.update_xaxes(tickformat<span class="op">=</span><span class="st">".1%"</span>)</span>
<span id="cb5-151"><a href="#cb5-151" aria-hidden="true" tabindex="-1"></a>    fig.update_layout(legend<span class="op">=</span><span class="bu">dict</span>(yanchor<span class="op">=</span><span class="st">"top"</span>, y <span class="op">=</span><span class="fl">0.99</span>, xanchor<span class="op">=</span><span class="st">"left"</span>, x<span class="op">=</span><span class="fl">0.01</span>))</span>
<span id="cb5-152"><a href="#cb5-152" aria-hidden="true" tabindex="-1"></a>    fig.show()</span>
<span id="cb5-153"><a href="#cb5-153" aria-hidden="true" tabindex="-1"></a>    <span class="co"># return largefig(fig), is_pos_def(cov)</span></span>
<span id="cb5-154"><a href="#cb5-154" aria-hidden="true" tabindex="-1"></a>figtbl(mn1, mn2, mn3, sd1, sd2, sd3, corr12, corr13, corr23, [<span class="st">"US Equity"</span>, <span class="st">"Developed Intl"</span>, <span class="st">"Emerging Mkt"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-frontier-gmv-shorting" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">

<div>                            <div id="f70ad87c-4975-48b3-8e9a-9a603006b8d8" class="plotly-graph-div" style="height:525px; width:100%;"></div>            <script type="text/javascript">                require(["plotly"], function(Plotly) {                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("f70ad87c-4975-48b3-8e9a-9a603006b8d8")) {                    Plotly.newPlot(                        "f70ad87c-4975-48b3-8e9a-9a603006b8d8",                        [{"customdata":[[[1.0000000012690178],[-1.6920229296117205e-09],[4.2300531862037586e-10]],[[0.9183679080744737],[0.08163190488029365],[1.8704523271955506e-07]],[[0.8367351389358628],[0.16326471271136672],[1.4835277050590408e-07]],[[0.7551025257843637],[0.24489731255962438],[1.6165601207225992e-07]],[[0.6735656404569426],[0.3264022753091113],[3.208423394624956e-05]],[[0.6116290985241583],[0.3817734468657491],[0.006597454610092734]],[[0.5933178210905571],[0.3789775990901415],[0.027704579819301436]],[[0.5750093395964921],[0.37617802339515344],[0.04881263700835447]],[[0.5567012440593693],[0.3733779330909087],[0.069920822849722]],[[0.5383883515938988],[0.3705842386911281],[0.09102740971497317]],[[0.5200813483380506],[0.36778269201185126],[0.11213595965009804]],[[0.5017740486398098],[0.36498154058909765],[0.13324441077109253]],[[0.483466564568478],[0.36218063499713166],[0.15435280043439037]],[[0.46515891745862464],[0.359379946789861],[0.17546113575151445]],[[0.4468512080253348],[0.3565793416805067],[0.1965694502941585]],[[0.4285434567156395],[0.353778792406359],[0.2176777508780016]],[[0.4102356642623822],[0.3509782979902947],[0.2387860377473232]],[[0.3919278326731299],[0.34817785575555454],[0.2598943115713155]],[[0.37361996510671547],[0.34537746149036486],[0.2810025734029196]],[[0.35531206620277406],[0.34257710900854643],[0.3021108247886795]],[[0.3370041702521539],[0.33977675258896534],[0.3232190771588808]],[[0.31869631258546965],[0.3369763451241355],[0.3443273422903948]],[[0.300388516959696],[0.3341758549380931],[0.36543562810221086]],[[0.2820808040395328],[0.3313752544779016],[0.3865439414825656]],[[0.2637732063709018],[0.32857450034900104],[0.40765229328009706]],[[0.24546576940964374],[0.32577353194360503],[0.42876069864675126]],[[0.22715855697462664],[0.32297226416988534],[0.449869178855488]],[[0.20885165955582893],[0.32017057637454044],[0.47097776406963066]],[[0.1905452075367955],[0.31736829471284494],[0.4920864977503595]],[[0.17223939410074035],[0.3145651616071762],[0.5131954442920835]],[[0.15393452101353364],[0.3117607747030434],[0.534304704283423]],[[0.13563110883161592],[0.30895443992519234],[0.5554144512431918]],[[0.1173302125150182],[0.30614475066024777],[0.576525036824734]],[[0.09899879841993811],[0.3033757517666132],[0.5976254498134487]],[[0.08069094161972236],[0.3005753431464929],[0.6187337152337848]],[[0.06238354736558257],[0.2977743177982713],[0.6398421348361462]],[[0.04407796332933461],[0.29497087882619294],[0.6609511578444724]],[[0.025784032761666693],[0.2921519018960096],[0.6820640653423239]],[[0.0074685488006164],[0.2893616628236675],[0.7031697883757161]],[[0.00016182922347622196],[0.2718930712394471],[0.7279450995370766]],[[2.247863545223715e-06],[0.24489496203228045],[0.7551027901041744]],[[8.738327380246442e-06],[0.2176754237267584],[0.7823158379458615]],[[2.727991168274878e-06],[0.19047255315463213],[0.8095247188541996]],[[7.560944858352836e-07],[0.16326429799646794],[0.8367349459090462]],[[2.4421106607478205e-05],[0.13602186029323016],[0.8639537186001623]],[[8.469531662674221e-06],[0.10883224470608327],[0.8911592857622541]],[[2.334311326233946e-06],[0.0816295406461231],[0.9183681250425507]],[[1.3113655536806053e-05],[0.05440428383343398],[0.9455826025110292]],[[2.1320128341032634e-07],[0.0272106000853645],[0.9727891867133521]],[[-2.0788539806293134e-10],[2.77180860279484e-10],[0.9999999999307045]]],"hovertemplate":"frontier w/o short sales<br>US Equity: %{customdata[0]:.1%}<br>Developed Intl: %{customdata[1]:.1%}<br>Emerging Mkt: %{customdata[2]:.1%}<br><extra></extra>","line":{"color":"green"},"mode":"lines","name":"3-Fund Frontier w/o short sales","x":[0.15000000004758815,0.1481253281440315,0.14679968883899114,0.14603806239042244,0.1458498222636197,0.14621018708025638,0.14674704076644476,0.14733607935237603,0.1479766796542143,0.14866817514794645,0.14940985917557165,0.150200988256801,0.1510407854360856,0.1519284436645731,0.15286312917402464,0.1538439848182292,0.1548701333568502,0.15594068065942296,0.1570547188097731,0.15821132909386057,0.1594095848567788,0.16064855421730914,0.16192730263099905,0.1632448952951733,0.164600399391558,0.1659928861642781,0.16742143283287297,0.16888512434164957,0.17038305494815956,0.1719143296548527,0.17347806548905084,0.17507339263740654,0.1766994554423632,0.17835541320332138,0.18004044110191203,0.18175373058831687,0.1834944900287932,0.18526194509952693,0.1870553390326551,0.18888001627256087,0.19075924712648742,0.1926947137471845,0.19468448221920473,0.19672697269246955,0.1988207922767084,0.20096372662713127,0.2031546595905604,0.20539220791707272,0.20767429907665247,0.20999999999636196],"y":[0.06,0.06040816326530612,0.060816326530612246,0.061224489795918366,0.061632653061224486,0.06204081632653061,0.062448979591836734,0.06285714285714286,0.06326530612244897,0.0636734693877551,0.06408163265306122,0.06448979591836734,0.06489795918367347,0.0653061224489796,0.06571428571428571,0.06612244897959184,0.06653061224489795,0.06693877551020408,0.0673469387755102,0.06775510204081632,0.06816326530612245,0.06857142857142857,0.06897959183673469,0.06938775510204082,0.06979591836734694,0.07020408163265306,0.07061224489795918,0.07102040816326531,0.07142857142857142,0.07183673469387755,0.07224489795918368,0.07265306122448979,0.07306122448979592,0.07346938775510203,0.07387755102040816,0.07428571428571429,0.07469387755102042,0.07510204081632653,0.07551020408163266,0.07591836734693877,0.0763265306122449,0.07673469387755102,0.07714285714285715,0.07755102040816327,0.07795918367346939,0.0783673469387755,0.07877551020408163,0.07918367346938776,0.07959183673469387,0.08],"type":"scatter"},{"hovertemplate":"GMV portfolio w/o short sales <br>US Equity: 68.7%<br>Developed Intl: 31.2%<br>Emerging Mkt: 0.0%<br><extra></extra>","marker":{"color":"green","size":15},"mode":"markers","name":"GMV Portfolio w/o Short Sales","x":[0.14584078022550442],"y":[0.06156250545966392],"type":"scatter"},{"customdata":[[[0.9722955145118741],[0.4369393139841688],[-0.409234828496043]],[[0.9466641537881653],[0.4330192235205428],[-0.37968337730870794]],[[0.9210327930644563],[0.4290991330569166],[-0.35013192612137284]],[[0.8954014323407471],[0.42517904259329053],[-0.3205804749340374]],[[0.869770071617038],[0.42125895212966447],[-0.2910290237467023]],[[0.8441387108933289],[0.4173388616660384],[-0.2614775725593672]],[[0.8185073501696198],[0.41341877120241227],[-0.23192612137203217]],[[0.792875989445911],[0.4094986807387862],[-0.20237467018469713]],[[0.7672446287222019],[0.4055785902751602],[-0.17282321899736205]],[[0.7416132679984927],[0.40165849981153406],[-0.14327176781002662]],[[0.7159819072747837],[0.39773840934790794],[-0.11372031662269154]],[[0.6903505465510745],[0.3938183188842818],[-0.08416886543535645]],[[0.6647191858273657],[0.3898982284206558],[-0.0546174142480214]],[[0.6390878251036562],[0.3859781379570296],[-0.025065963060685967]],[[0.6134564643799473],[0.38205804749340355],[0.004485488126649104]],[[0.5878251036562383],[0.3781379570297775],[0.034036939313984174]],[[0.5621937429325292],[0.3742178665661514],[0.06358839050131924]],[[0.5365623822088202],[0.3702977761025254],[0.09313984168865434]],[[0.5109310214851113],[0.3663776856388993],[0.1226912928759894]],[[0.48529966076140224],[0.36245759517527315],[0.15224274406332447]],[[0.45966830003769327],[0.3585375047116471],[0.18179419525065954]],[[0.43403693931398357],[0.3546174142480209],[0.21134564643799533]],[[0.4084055785902753],[0.350697323784395],[0.24089709762532968]],[[0.3827742178665656],[0.3467772333207688],[0.2704485488126655]],[[0.35714285714285665],[0.3428571428571427],[0.3000000000000006]],[[0.33151149641914757],[0.3389370523935166],[0.32955145118733564]],[[0.30588013569543854],[0.33501696192989056],[0.3591029023746707]],[[0.28024877497172956],[0.3310968714662645],[0.3886543535620058]],[[0.25461741424802053],[0.32717678100263836],[0.4182058047493409]],[[0.22898605352431156],[0.32325669053901224],[0.4477572559366759]],[[0.2033546928006026],[0.3193366000753862],[0.47730870712401097]],[[0.17772333207689361],[0.31541650961176015],[0.506860158311346]],[[0.15209197135318397],[0.311496419148134],[0.5364116094986819]],[[0.12646061062947556],[0.307576328684508],[0.5659630606860162]],[[0.1008292499057658],[0.3036562382208817],[0.5955145118733519]],[[0.07519788918205683],[0.2997361477572557],[0.6250659630606871]],[[0.04956652845834797],[0.29581605729362975],[0.6546174142480222]],[[0.023935167734639107],[0.29189596683000374],[0.6841688654353573]],[[-0.0016961929890701999],[0.28797587636637756],[0.7137203166226922]],[[-0.027327553712779284],[0.28405578590275127],[0.7432717678100274]],[[-0.05295891443648815],[0.2801356954391253],[0.7728232189973625]],[[-0.07859027516019701],[0.27621560497549935],[0.8023746701846974]],[[-0.10422163588390587],[0.2722955145118733],[0.8319261213720326]],[[-0.12985299660761584],[0.268375424048247],[0.8614775725593684]],[[-0.15548435733132426],[0.2644553335846209],[0.8910290237467027]],[[-0.1811157180550338],[0.26053524312099496],[0.9205804749340385]],[[-0.20674707877874265],[0.2566151526573689],[0.9501319261213736]],[[-0.23237843950245174],[0.2526950621937427],[0.9796833773087086]],[[-0.2580098002261608],[0.24877497173011676],[1.0092348284960437]],[[-0.2836411609498699],[0.24485488126649058],[1.0387862796833789]]],"hovertemplate":"frontier with short sales<br>US Equity: %{customdata[0]:.1%}<br>Developed Intl: %{customdata[1]:.1%}<br>Emerging Mkt: %{customdata[2]:.1%}<br><extra></extra>","line":{"color":"blue"},"mode":"lines","name":"3-Fund Frontier with short sales","x":[0.14673600493784317,0.14600059702256735,0.1453690398466881,0.1448426918768234,0.14442270342115648,0.14411000439248056,0.14390529419622028,0.14380903399500047,0.1438214415468855,0.14394248875105545,0.14417190196513938,0.1445091650858807,0.14495352531265115,0.14550400144493275,0.14615939450334045,0.14691830041167012,0.14777912443677185,0.14874009705495886,0.14979929089856459,0.15095463843380727,0.1522039500302956,0.15354493210178732,0.15497520502530315,0.15649232057932283,0.15809377867943716,0.15977704322949118,0.1615395569461209,0.16337875505313998,0.1652920777782568,0.16727698161721835,0.16933094935910456,0.17145149889084838,0.1736361908190688,0.17588263496311407,0.17818849578509421,0.18055149683100272,0.18296942426222787,0.18544012955927638,0.18796153147983702,0.19053161735183183,0.19314844377923035,0.19581013683450263,0.19851489180696072,0.20126097257115325,0.20404671063415397,0.2068705039151895,0.20973081530572749,0.21262617105300188,0.21555515900504493,0.21851642675070107],"y":[0.054,0.05457142857142857,0.05514285714285714,0.055714285714285716,0.056285714285714286,0.056857142857142856,0.057428571428571426,0.057999999999999996,0.058571428571428566,0.05914285714285714,0.05971428571428571,0.06028571428571428,0.06085714285714285,0.06142857142857143,0.062,0.06257142857142857,0.06314285714285714,0.06371428571428571,0.06428571428571428,0.06485714285714285,0.06542857142857142,0.066,0.06657142857142856,0.06714285714285714,0.06771428571428571,0.06828571428571428,0.06885714285714285,0.06942857142857142,0.06999999999999999,0.07057142857142856,0.07114285714285713,0.0717142857142857,0.07228571428571429,0.07285714285714284,0.07342857142857143,0.074,0.07457142857142857,0.07514285714285714,0.0757142857142857,0.07628571428571428,0.07685714285714285,0.07742857142857142,0.07799999999999999,0.07857142857142857,0.07914285714285713,0.07971428571428571,0.08028571428571428,0.08085714285714285,0.08142857142857142,0.08199999999999999],"type":"scatter"},{"hovertemplate":"GMV portfolio with short sales <br>US Equity: 78.3%<br>Developed Intl: 40.8%<br>Emerging Mkt: -19.1%<br><extra></extra>","marker":{"color":"blue","size":15},"mode":"markers","name":"GMV Portfolio with Short Sales","x":[0.14380094206054425],"y":[0.058220486111111115],"type":"scatter"},{"hovertemplate":"%{text}<extra></extra>","marker":{"color":"red","size":15},"mode":"markers","name":"Underlying Assets","text":["US Equity","Developed Intl","Emerging Mkt"],"x":[0.15,0.165,0.21],"y":[0.06,0.065,0.08],"type":"scatter"}],                        {"template":{"data":{"histogram2dcontour":[{"type":"histogram2dcontour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"choropleth":[{"type":"choropleth","colorbar":{"outlinewidth":0,"ticks":""}}],"histogram2d":[{"type":"histogram2d","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmap":[{"type":"heatmap","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmapgl":[{"type":"heatmapgl","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"contourcarpet":[{"type":"contourcarpet","colorbar":{"outlinewidth":0,"ticks":""}}],"contour":[{"type":"contour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"surface":[{"type":"surface","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"mesh3d":[{"type":"mesh3d","colorbar":{"outlinewidth":0,"ticks":""}}],"scatter":[{"fillpattern":{"fillmode":"overlay","size":10,"solidity":0.2},"type":"scatter"}],"parcoords":[{"type":"parcoords","line":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolargl":[{"type":"scatterpolargl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"scattergeo":[{"type":"scattergeo","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolar":[{"type":"scatterpolar","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"scattergl":[{"type":"scattergl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatter3d":[{"type":"scatter3d","line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattermapbox":[{"type":"scattermapbox","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterternary":[{"type":"scatterternary","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattercarpet":[{"type":"scattercarpet","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"type":"carpet"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}],"barpolar":[{"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"pie":[{"automargin":true,"type":"pie"}]},"layout":{"autotypenumbers":"strict","colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"hovermode":"closest","hoverlabel":{"align":"left"},"paper_bgcolor":"white","plot_bgcolor":"#E5ECF6","polar":{"bgcolor":"#E5ECF6","angularaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"radialaxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"ternary":{"bgcolor":"#E5ECF6","aaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"baxis":{"gridcolor":"white","linecolor":"white","ticks":""},"caxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]]},"xaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"yaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"scene":{"xaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"yaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"zaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"geo":{"bgcolor":"white","landcolor":"#E5ECF6","subunitcolor":"white","showland":true,"showlakes":true,"lakecolor":"white"},"title":{"x":0.05},"mapbox":{"style":"light"}}},"xaxis":{"title":{"text":"Standard Deviation"},"tickformat":".1%"},"yaxis":{"title":{"text":"Expected Return"},"tickformat":".1%"},"legend":{"yanchor":"top","y":0.99,"xanchor":"left","x":0.01}},                        {"responsive": true}                    ).then(function(){
                            
var gd = document.getElementById('f70ad87c-4975-48b3-8e9a-9a603006b8d8');
var x = new MutationObserver(function (mutations, observer) {{
        var display = window.getComputedStyle(gd).display;
        if (!display || display === 'none') {{
            console.log([gd, 'removed!']);
            Plotly.purge(gd);
            observer.disconnect();
        }}
}});

// Listen for the removal of the full notebook cells
var notebookContainer = gd.closest('#notebook-container');
if (notebookContainer) {{
    x.observe(notebookContainer, {childList: true});
}}

// Listen for the clearing of the current output cell
var outputEl = gd.closest('.output');
if (outputEl) {{
    x.observe(outputEl, {childList: true});
}}

                        })                };                });            </script>        </div>
<p></p><figcaption class="figure-caption">Figure&nbsp;4.5: Short-Selling and the Frontier</figcaption><p></p>
</figure>
</div>
</div>
<p>The frontier with short-selling coincides with the frontier without short-selling for many expected return values, but shorting allows an investor to reach expected returns values below the minimum expected returns of the assets (the US equity portfolio) and above the maximum expected return of the underlying assets (the emerging market portfolio). These portfolios entail shorting the emerging market fund or the US equity fund, respectively.</p>
<p>Within the set of expected returns possible without shorting, lower risk portfolios are possible with shorting for expected returns close to the US market fund’s expected return and close to the emerging market fund’s expected return. For the former case, the emerging market fund is shorted and serves as a hedge against long positions in the other two funds. For the latter case, the US equity fund serves as a hedge.</p>
<p>The improvement in mean-variance efficiency is sometimes more dramatic than the example above. For instance, <a href="#fig-industry-frontiers">Figure&nbsp;<span class="quarto-unresolved-ref">fig-industry-frontiers</span></a> shows the frontiers for portfolios of 48 industries when shorts sales are or are not allowed. In this case, allowing short sales shifts the frontier leftward for the full range of expected returns obtainable with long-only portfolios of industries.</p>
<div class="cell" data-execution_count="7">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pandas_datareader <span class="im">import</span> DataReader <span class="im">as</span> pdr</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> cvxopt <span class="im">import</span> matrix</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> cvxopt.solvers <span class="im">import</span> qp <span class="im">as</span> Solver, options <span class="im">as</span> SolverOptions</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.optimize <span class="im">import</span> minimize_scalar</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.graph_objects <span class="im">as</span> go</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>SolverOptions[<span class="st">"show_progress"</span>] <span class="op">=</span> <span class="va">False</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Read data and clean-up missing data (coded -99.99)</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>ff48 <span class="op">=</span> pdr(<span class="st">"48_Industry_Portfolios"</span>, <span class="st">"famafrench"</span>, start<span class="op">=</span><span class="dv">1900</span>)[<span class="dv">0</span>]</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean-up missings</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> c <span class="kw">in</span> ff48.columns:</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>    ff48[c] <span class="op">=</span> np.where(ff48[c]<span class="op">==-</span><span class="fl">99.99</span>, np.nan, ff48[c])</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>ff48 <span class="op">=</span> ff48<span class="op">/</span><span class="dv">100</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimate inputs from historical data</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>mns <span class="op">=</span> ff48.mean()</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>sds <span class="op">=</span> ff48.std()</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>C <span class="op">=</span> ff48.corr()</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>cov <span class="op">=</span> np.diag(sds) <span class="op">@</span> C <span class="op">@</span> np.diag(sds)</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Frontier with shorting              </span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>ss  <span class="op">=</span> portfolio(mns.values,cov.values, Shorts <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>frontier_ss  <span class="op">=</span> [ss.frontier(m) <span class="cf">for</span> m <span class="kw">in</span> np.linspace(mns.<span class="bu">min</span>(), mns.<span class="bu">max</span>(),<span class="dv">50</span>)]</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>mu_ss <span class="op">=</span> [wgt <span class="op">@</span> mns <span class="cf">for</span> wgt <span class="kw">in</span> frontier_ss]</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>sd_ss <span class="op">=</span> [np.sqrt(wgt <span class="op">@</span> cov <span class="op">@</span> wgt) <span class="cf">for</span> wgt <span class="kw">in</span> frontier_ss]</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Frontier without shorting</span></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>noss<span class="op">=</span> portfolio(mns.values,cov.values, Shorts <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>frontier_noss<span class="op">=</span> [noss.frontier(m) <span class="cf">for</span> m <span class="kw">in</span> np.linspace(mns.<span class="bu">min</span>(), mns.<span class="bu">max</span>(),<span class="dv">50</span>)]</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>mu_noss <span class="op">=</span> [wgt <span class="op">@</span> mns <span class="cf">for</span> wgt <span class="kw">in</span> frontier_noss]</span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>sd_noss <span class="op">=</span> [np.sqrt(wgt <span class="op">@</span> cov <span class="op">@</span> wgt) <span class="cf">for</span> wgt <span class="kw">in</span> frontier_noss]</span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the frontiers</span></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>string <span class="op">=</span>  <span class="st">"Frontier with shorting allowed&lt;br&gt;"</span></span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>string <span class="op">+=</span> <span class="st">"Expected Return (monthly): %</span><span class="sc">{y:.2%}</span><span class="st">&lt;br&gt;"</span></span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>string <span class="op">+=</span> <span class="st">"Standard Deviation (monthly): %</span><span class="sc">{x:.2%}</span><span class="st">&lt;br&gt;"</span></span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>string <span class="op">+=</span> <span class="st">"&lt;extra&gt;&lt;/extra&gt;"</span></span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>trace_ss  <span class="op">=</span> go.Scatter(x<span class="op">=</span>sd_ss, y<span class="op">=</span>mu_ss, mode<span class="op">=</span><span class="st">"lines"</span>, name<span class="op">=</span><span class="st">'With shorting'</span>, hovertemplate<span class="op">=</span>string)</span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>string <span class="op">=</span>  <span class="st">"Frontier with no short selling &lt;br&gt;"</span></span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>string <span class="op">+=</span> <span class="st">"Expected Return (monthly): %</span><span class="sc">{y:.2%}</span><span class="st">&lt;br&gt;"</span></span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>string <span class="op">+=</span> <span class="st">"Standard Deviation (monthly): %</span><span class="sc">{x:.2%}</span><span class="st">&lt;br&gt;"</span></span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>string <span class="op">+=</span> <span class="st">"&lt;extra&gt;&lt;/extra&gt;"</span></span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>trace_noss<span class="op">=</span> go.Scatter(x<span class="op">=</span>sd_noss, y<span class="op">=</span>mu_noss, mode<span class="op">=</span><span class="st">"lines"</span>, name<span class="op">=</span><span class="st">'Without shorting'</span>, hovertemplate<span class="op">=</span>string)</span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> go.Figure()</span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a>fig.add_trace(trace_ss)</span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>fig.add_trace(trace_noss)</span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a>fig.update_layout(legend<span class="op">=</span><span class="bu">dict</span>(yanchor<span class="op">=</span><span class="st">"top"</span>, y <span class="op">=</span><span class="fl">0.99</span>, xanchor<span class="op">=</span><span class="st">"left"</span>, x<span class="op">=</span><span class="fl">0.01</span>))</span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a>fig.update_yaxes(title<span class="op">=</span><span class="st">"Expected Return (monthly)"</span>, tickformat<span class="op">=</span><span class="st">".2%"</span>, <span class="bu">range</span><span class="op">=</span>[<span class="fl">0.5</span><span class="op">*</span>np.<span class="bu">min</span>(mu_noss<span class="op">+</span>mu_ss), <span class="fl">1.05</span><span class="op">*</span>np.<span class="bu">max</span>(mu_noss<span class="op">+</span>mu_ss)])</span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a>fig.update_xaxes(title<span class="op">=</span><span class="st">"Standard Deviation (monthly)"</span>, tickformat<span class="op">=</span><span class="st">".2%"</span>, <span class="bu">range</span><span class="op">=</span>[<span class="fl">0.5</span><span class="op">*</span>np.<span class="bu">min</span>(sd_noss<span class="op">+</span>sd_ss), <span class="fl">1.05</span><span class="op">*</span>np.<span class="bu">max</span>(sd_noss<span class="op">+</span>sd_ss)])</span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a>fig.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-industry-frontiers" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">

<div>                            <div id="f0c3bfcd-e9a7-4264-99fe-1433ebd6dac4" class="plotly-graph-div" style="height:525px; width:100%;"></div>            <script type="text/javascript">                require(["plotly"], function(Plotly) {                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("f0c3bfcd-e9a7-4264-99fe-1433ebd6dac4")) {                    Plotly.newPlot(                        "f0c3bfcd-e9a7-4264-99fe-1433ebd6dac4",                        [{"hovertemplate":"Frontier with shorting allowed<br>Expected Return (monthly): %{y:.2%}<br>Standard Deviation (monthly): %{x:.2%}<br><extra></extra>","mode":"lines","name":"With shorting","x":[0.03583654137137399,0.03579315006157099,0.03576296129130572,0.03574600851063065,0.03574231055326557,0.035751871532207026,0.035774680816887026,0.03581071309217686,0.0358599284984734,0.035922272851065466,0.03599767793597971,0.03608606187857023,0.03618732958026652,0.0363013732181445,0.03642807280135144,0.036567296777906,0.03671890268501639,0.03688273783581293,0.03705864003527739,0.037246438318161046,0.037445953701811904,0.03765699994706507,0.037879384320678076,0.03811290835319918,0.038357368586628054,0.0386125573067477,0.03887826325556048,0.039154272319835134,0.03944036819235217,0.039736333003010674,0.04004194791751971,0.04035699370193373,0.04068125125179697,0.041014502085129585,0.04135652879891785,0.041707115489154796,0.04206604813482038,0.04243311494648615,0.042808106680484535,0.04319081691979367,0.04358104232296287,0.04397858284253803,0.044383241914549613,0.044794826620696275,0.04521314782490157,0.04563802028594048,0.04606926274783204,0.04650669800967392,0.04695015297656212,0.04739945869319096],"y":[0.0072360726643598584,0.007370397570793023,0.007504722477226178,0.0076390473836593425,0.007773372290092505,0.007907697196525667,0.00804202210295883,0.008176347009391993,0.00831067191582515,0.008444996822258315,0.008579321728691476,0.00871364663512464,0.0088479715415578,0.00898229644799096,0.009116621354424122,0.009250946260857283,0.00938527116729045,0.009519596073723605,0.009653920980156766,0.00978824588658993,0.00992257079302309,0.010056895699456253,0.010191220605889412,0.010325545512322575,0.010459870418755735,0.010594195325188899,0.01072852023162206,0.010862845138055221,0.010997170044488386,0.011131494950921549,0.01126581985735471,0.011400144763787867,0.01153446967022103,0.011668794576654196,0.011803119483087352,0.011937444389520517,0.012071769295953673,0.012206094202386834,0.012340419108819998,0.012474744015253163,0.012609068921686324,0.012743393828119488,0.012877718734552646,0.013012043640985809,0.01314636854741897,0.01328069345385213,0.013415018360285292,0.013549343266718453,0.01368366817315162,0.013817993079584775],"type":"scatter"},{"hovertemplate":"Frontier with no short selling <br>Expected Return (monthly): %{y:.2%}<br>Standard Deviation (monthly): %{x:.2%}<br><extra></extra>","mode":"lines","name":"Without shorting","x":[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],"y":[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],"type":"scatter"}],                        {"template":{"data":{"histogram2dcontour":[{"type":"histogram2dcontour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"choropleth":[{"type":"choropleth","colorbar":{"outlinewidth":0,"ticks":""}}],"histogram2d":[{"type":"histogram2d","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmap":[{"type":"heatmap","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmapgl":[{"type":"heatmapgl","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"contourcarpet":[{"type":"contourcarpet","colorbar":{"outlinewidth":0,"ticks":""}}],"contour":[{"type":"contour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"surface":[{"type":"surface","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"mesh3d":[{"type":"mesh3d","colorbar":{"outlinewidth":0,"ticks":""}}],"scatter":[{"fillpattern":{"fillmode":"overlay","size":10,"solidity":0.2},"type":"scatter"}],"parcoords":[{"type":"parcoords","line":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolargl":[{"type":"scatterpolargl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"scattergeo":[{"type":"scattergeo","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolar":[{"type":"scatterpolar","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"scattergl":[{"type":"scattergl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatter3d":[{"type":"scatter3d","line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattermapbox":[{"type":"scattermapbox","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterternary":[{"type":"scatterternary","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattercarpet":[{"type":"scattercarpet","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"type":"carpet"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}],"barpolar":[{"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"pie":[{"automargin":true,"type":"pie"}]},"layout":{"autotypenumbers":"strict","colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"hovermode":"closest","hoverlabel":{"align":"left"},"paper_bgcolor":"white","plot_bgcolor":"#E5ECF6","polar":{"bgcolor":"#E5ECF6","angularaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"radialaxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"ternary":{"bgcolor":"#E5ECF6","aaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"baxis":{"gridcolor":"white","linecolor":"white","ticks":""},"caxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]]},"xaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"yaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"scene":{"xaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"yaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"zaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"geo":{"bgcolor":"white","landcolor":"#E5ECF6","subunitcolor":"white","showland":true,"showlakes":true,"lakecolor":"white"},"title":{"x":0.05},"mapbox":{"style":"light"}}},"legend":{"yanchor":"top","y":0.99,"xanchor":"left","x":0.01},"yaxis":{"title":{"text":"Expected Return (monthly)"},"tickformat":".2%","range":[null,null]},"xaxis":{"title":{"text":"Standard Deviation (monthly)"},"tickformat":".2%","range":[null,null]}},                        {"responsive": true}                    ).then(function(){
                            
var gd = document.getElementById('f0c3bfcd-e9a7-4264-99fe-1433ebd6dac4');
var x = new MutationObserver(function (mutations, observer) {{
        var display = window.getComputedStyle(gd).display;
        if (!display || display === 'none') {{
            console.log([gd, 'removed!']);
            Plotly.purge(gd);
            observer.disconnect();
        }}
}});

// Listen for the removal of the full notebook cells
var notebookContainer = gd.closest('#notebook-container');
if (notebookContainer) {{
    x.observe(notebookContainer, {childList: true});
}}

// Listen for the clearing of the current output cell
var outputEl = gd.closest('.output');
if (outputEl) {{
    x.observe(outputEl, {childList: true});
}}

                        })                };                });            </script>        </div>
<p></p><figcaption class="figure-caption">Figure&nbsp;4.6: Industry Portfolio Frontiers with and without Short-Selling</figcaption><p></p>
</figure>
</div>
</div>
</section>
<section id="gmv-and-frontier-portfolios" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="gmv-and-frontier-portfolios">GMV and Frontier Portfolios</h3>
<p>Short-sale constraints are an set of additional constraints to the optimization problems for the GMV portfolio and frontier portfolios considered in <a href="#eq-frontier">Equation&nbsp;<span class="quarto-unresolved-ref">eq-frontier</span></a> and <a href="#eq-cal">Equation&nbsp;<span class="quarto-unresolved-ref">eq-cal</span></a>.</p>
<p>With short-sale constraints, the GMV portfolio is the set of <em>non-negative</em> portfolio weights that minimizes portfolio variance: <span class="math display">\[ \underset{w_1,w_2,\dots,w_N}{\text{min}} \text{var}[r_p]\]</span> subject to the constraints <span class="math inline">\(\sum_i w_i=1\)</span> and <span class="math inline">\(w_i \ge 0\)</span> for all assets <span class="math inline">\(i\)</span>.</p>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
GMV with Short-Sale Constraints
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Minimizing variance is a quadratic programming problem that can be solved numerically using constrained optimization in Python using the CVXOPT package. The CVXOPT user guide is available <a href="https://cvxopt.org/userguide/index.html"> here </a>.</p>
<p>The function <code>cvxopt.solvers.qp</code> solves problems of the general form: <span class="math display">\[\begin{align}
    \underset{w}{\text{min  }}&amp; \frac{1}{2} w' Q w + p'x \\
     \text{subject to  } &amp; Gw \le h \\
                        &amp; Aw = b \\
\end{align}\]</span></p>
<p>The optimizer is solving for a <span class="math inline">\(N \times 1\)</span> vector of portfolio weights, <span class="math inline">\(w\)</span> that minimizes the objective function. To minimize variance, we set <span class="math inline">\(Q\)</span> equal to the <span class="math inline">\(N \times N\)</span> covariance matrix of returns and <span class="math inline">\(p\)</span> equal to a <span class="math inline">\(N \times 1\)</span> vector of zeros.</p>
<p>The constraint <span class="math inline">\(Gw \le h\)</span> is used to put position limits on the portfolio weights. Short-selling constraints are the most common such constraint. These are accomplished by setting <span class="math inline">\(G\)</span> equal to the negative of the <span class="math inline">\(N \times N\)</span> identity matrix (that is, a matrix with -1s on the diagonal and zero elsewhere), and <span class="math inline">\(h\)</span> equal to a <span class="math inline">\(N \times 1\)</span> vector of zeros. Additional position limits could be enforced by adding rows to <span class="math inline">\(G\)</span> and <span class="math inline">\(h\)</span>. For instance, many funds have maximum position limits in addition to short-sale constraints.</p>
<p>The constraint <span class="math inline">\(Aw=b\)</span> usually includes the constraint that the portfolio is fulling invested; that is, the portfolio weights sum to 100%. This is accomplished by setting <span class="math inline">\(A\)</span> equal to a <span class="math inline">\(N \times 1\)</span> vector of ones and setting <span class="math inline">\(b=1\)</span>. <span class="math inline">\(A\)</span> and <span class="math inline">\(b\)</span> can include additional rows for other constraints. For instance, setting a target expected return is accomplished by adding a row to <span class="math inline">\(A\)</span> with the asset mean vector and adding a row to <span class="math inline">\(b\)</span> with the target expected return. This is done when solving for a particular point on the mean-variance frontier.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode p code-with-copy"><code class="sourceCode pascal"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> numpy <span class="kw">as</span> np</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>from cvxopt <span class="kw">import</span> matrix</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>from cvxopt.solvers <span class="kw">import</span> qp <span class="kw">as</span> Solver, options <span class="kw">as</span> SolverOptions</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="st">##### </span>Inputs</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="st"># </span>Risk-free rate</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>r = <span class="dv">0.02</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="st"># </span>Expected returns</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>mns = np.<span class="kw">array</span>([<span class="dv">0.06</span>, <span class="dv">0.065</span>, <span class="dv">0.08</span>])</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="st"># </span>Standard deviations</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>sds = np.<span class="kw">array</span>([<span class="dv">0.15</span>, <span class="dv">0.165</span>, <span class="dv">0.21</span>])</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="st"># </span>Correlations</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>corr12 = <span class="dv">0.75</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>corr13 = <span class="dv">0.75</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>corr23 = <span class="dv">0.75</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="st"># </span>Covariance matrix</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>C  = np.identity(<span class="dv">3</span>)</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>C[<span class="dv">0</span>, <span class="dv">1</span>] = C[<span class="dv">1</span>, <span class="dv">0</span>] = corr12</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>C[<span class="dv">0</span>, <span class="dv">2</span>] = C[<span class="dv">2</span>, <span class="dv">0</span>] = corr13</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>C[<span class="dv">1</span>, <span class="dv">2</span>] = C[<span class="dv">2</span>, <span class="dv">1</span>] = corr23</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>cov = np.diag(sds) @ C @ np.diag(sds)</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a><span class="st">##### </span>GMV problem <span class="kw">with</span> short-sale constraints</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>n = len(mns)</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>Q = matrix(cov, tc="d")</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>p = matrix(np.zeros(n), (n, <span class="dv">1</span>), tc="d")</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a><span class="st"># </span>Constraint: short-sales <span class="kw">not</span> allowed</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>G = matrix(-np.identity(n), tc="d")</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>h = matrix(np.zeros(n), (n, <span class="dv">1</span>), tc="d")</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a><span class="st"># </span>Constraint: fully-invested portfolio</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>A = matrix(np.ones(n), (<span class="dv">1</span>, n), tc="d")</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>b = matrix([<span class="dv">1</span>], (<span class="dv">1</span>, <span class="dv">1</span>), tc="d")</span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>sol = Solver(Q, p, G, h, A, b)</span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>wgts_gmv = np.<span class="kw">array</span>(sol["x"]).flatten() <span class="kw">if</span> sol["status"] == "optimal" <span class="kw">else</span> np.<span class="kw">array</span>(n * [np.nan])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Note that the GMV without short-sale constraints can be found using numerical optimization by removing the short-sale constraint:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode p code-with-copy"><code class="sourceCode pascal"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>G = matrix(np.zeros((n,n)), tc="d")</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<p>Similarly, a frontier portfolio with expected return <span class="math inline">\(\mu_{\text{target}}\)</span> is defined by the <em>non-negative</em> portfolio weights that solve the following constrained optimization problem: <span class="math display">\[ \underset{w_1,w_2,\dots,w_N}{\text{min}} \text{var}[r_p]\]</span> subject to constraints: <span class="math inline">\(\sum_i w_i E[r_i]=E[r_{\text{target}}]\)</span>, <span class="math inline">\(\sum_i w_i=1\)</span> and <span class="math inline">\(w_i \ge 0\)</span> for all assets <span class="math inline">\(i\)</span>.</p>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Frontier with Short-Sale Constraints
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Relative to the GMV problem, the frontier problem contains an additional constraint of the form <span class="math inline">\(Aw=b\)</span> in addition to the usual constraint that the portfolio is fulling invested. Setting a target expected return is accomplished by adding a row to <span class="math inline">\(A\)</span> with the asset mean vector and adding a row to <span class="math inline">\(b\)</span> with the target expected return.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode p code-with-copy"><code class="sourceCode pascal"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> numpy <span class="kw">as</span> np</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>from cvxopt <span class="kw">import</span> matrix</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>from cvxopt.solvers <span class="kw">import</span> qp <span class="kw">as</span> Solver, options <span class="kw">as</span> SolverOptions</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="st">##### </span>Inputs</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="st"># </span>Risk-free rate</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>r = <span class="dv">0.02</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="st"># </span>Expected returns</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>mns = np.<span class="kw">array</span>([<span class="dv">0.06</span>, <span class="dv">0.065</span>, <span class="dv">0.08</span>])</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="st"># </span>Standard deviations</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>sds = np.<span class="kw">array</span>([<span class="dv">0.15</span>, <span class="dv">0.165</span>, <span class="dv">0.21</span>])</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="st"># </span>Correlations</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>corr12 = <span class="dv">0.75</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>corr13 = <span class="dv">0.75</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>corr23 = <span class="dv">0.75</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="st"># </span>Covariance matrix</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>C  = np.identity(<span class="dv">3</span>)</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>C[<span class="dv">0</span>, <span class="dv">1</span>] = C[<span class="dv">1</span>, <span class="dv">0</span>] = corr12</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>C[<span class="dv">0</span>, <span class="dv">2</span>] = C[<span class="dv">2</span>, <span class="dv">0</span>] = corr13</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>C[<span class="dv">1</span>, <span class="dv">2</span>] = C[<span class="dv">2</span>, <span class="dv">1</span>] = corr23</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>cov = np.diag(sds) @ C @ np.diag(sds)</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a><span class="st">##### </span>Frontier problem <span class="kw">with</span> short-sale constraints</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>def frontier(means, cov, target):</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>    n = len(means)</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>    Q = matrix(cov, tc="d")</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>    p = matrix(np.zeros(n), (n, <span class="dv">1</span>), tc="d")</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>    <span class="st"># </span>Constraint: short-sales <span class="kw">not</span> allowed</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>    G = matrix(-np.identity(n), tc="d")</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>    h = matrix(np.zeros(n), (n, <span class="dv">1</span>), tc="d")</span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>    <span class="st"># </span>Fully-invested constraint</span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>    A = matrix(np.vstack((np.ones(n), means)), (<span class="dv">2</span>, n), tc="d")</span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>    b = matrix([<span class="dv">1</span>, target], (<span class="dv">2</span>, <span class="dv">1</span>), tc="d")</span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>    sol = Solver(Q, p, G, h, A, b)</span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>    wgts = np.<span class="kw">array</span>(sol["x"]).flatten() <span class="kw">if</span> sol["status"] == "optimal" <span class="kw">else</span> np.<span class="kw">array</span>(n * [np.nan])</span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>    return wgts</span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>wgts_frontier = [frontier(mns, cov, m) <span class="kw">for</span> m <span class="kw">in</span> np.linspace(mns.min(), mns.max(),<span class="dv">5</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Note that the frontier portfolios without short-sale constraints can be found using numerical optimization by removing the short-sale constraint:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode p code-with-copy"><code class="sourceCode pascal"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>G = matrix(np.zeros((n,n)), tc="d")</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</section>
<section id="tangency-portfolio" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="tangency-portfolio">Tangency Portfolio</h3>
<p>For a single risk-free rate, the tangency portfolio with short-sale constraints is the set of <em>non-negative</em> portfolio weights that maximizes the Sharpe ratio: <span class="math display">\[ \underset{w_1,w_2,\dots,w_N}{\text{max}} \frac{E[r_p] - r_f}{\text{sd}[r_p]} \]</span> subject to the constraints <span class="math inline">\(\sum_i w_i=1\)</span> and <span class="math inline">\(w_i \ge 0\)</span> for all assets <span class="math inline">\(i\)</span>.</p>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tangency Portfolio with Short-Sale Constraints
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The optimizer is solving for a <span class="math inline">\(N \times 1\)</span> vector of portfolio weights, <span class="math inline">\(w\)</span> that minimizes the objective function. The <code>minimize</code> package in <code>scipy.optimize</code> solves multivariate constrained optimization problems. Short-sale constraints are passed to the optimizer as a list of lower and/or upper limits on each portfolio weight.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode p code-with-copy"><code class="sourceCode pascal"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> numpy <span class="kw">as</span> np</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>from scipy.optimize <span class="kw">import</span> minimize</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="st">##### </span>Inputs</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="st"># </span>Risk-free rate</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>r = <span class="dv">0.02</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="st"># </span>Expected returns</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>mns = np.<span class="kw">array</span>([<span class="dv">0.10</span>, <span class="dv">0.05</span>, <span class="dv">0.07</span>])</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="st"># </span>Standard deviations</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>sds = np.<span class="kw">array</span>([<span class="dv">0.20</span>, <span class="dv">0.12</span>, <span class="dv">0.15</span>])</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="st"># </span>Correlations</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>corr12 = <span class="dv">0.3</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>corr13 = <span class="dv">0.3</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>corr23 = <span class="dv">0.3</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a><span class="st"># </span>Covariance matrix</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>C  = np.identity(<span class="dv">3</span>)</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>C[<span class="dv">0</span>, <span class="dv">1</span>] = C[<span class="dv">1</span>, <span class="dv">0</span>] = corr12</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>C[<span class="dv">0</span>, <span class="dv">2</span>] = C[<span class="dv">2</span>, <span class="dv">0</span>] = corr13</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>C[<span class="dv">1</span>, <span class="dv">2</span>] = C[<span class="dv">2</span>, <span class="dv">1</span>] = corr23</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>cov = np.diag(sds) @ C @ np.diag(sds)</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a><span class="st">##### </span>Tangency Portfolio</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>n = len(mns)</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>def f(w):</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>    mn = w @ mns</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>    sd = np.sqrt(w @ cov @ w)</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>    return -(mn - r) / sd</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a><span class="st"># </span>Initial guess (equal-weighted)</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>w0 = (<span class="dv">1</span>/n)*np.ones(n)</span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a><span class="st"># </span>Constraint: fully-invested portfolio</span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>A = np.ones(n)</span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>b = <span class="dv">1</span></span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>cons = [<span class="co">{"type": "eq", "fun": lambda x: A @ x - b}</span>]</span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a><span class="st"># </span>Short-sale constraint</span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>bnds = [(<span class="dv">0</span>, None) <span class="kw">for</span> i <span class="kw">in</span> range(n)] </span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a><span class="st"># </span>Optimization</span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>wgts_tangency = minimize(f, w0, bounds=bnds, constraints=cons).x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Note that the tangency portfolio without short-sale constraints can be found using numerical optimization by removing the short-sale constraint:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode p code-with-copy"><code class="sourceCode pascal"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>bnds = [(None, None) <span class="kw">for</span> i <span class="kw">in</span> range(n)] </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>


</section>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>This is true if the interest rates are lower than expected returns. If interest rates are set higher than expected returns, then the efficient portfolios may not exist.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>That is, <span class="math inline">\(A&gt;\frac{E[r_{\text{low}}-r_f^{\text{saving}}]}{\text{var}_{\text{low}}}\)</span>.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>That is, <span class="math inline">\(A&lt;\frac{E[r_{\text{high}}-r_f^{\text{borrow}}]}{\text{var}_{\text{high}}}\)</span>.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>The covariance between the efficient low risk and high mean portfolios (<span class="math inline">\(\text{cov}[r_{\text{low}}, r_{\text{high}}]\)</span>) can be calculated as <span class="math inline">\(w_{\text{low}}' V w_{\text{high}}\)</span>, where <span class="math inline">\(w_{\text{low}}\)</span> and <span class="math inline">\(w_{\text{high}}\)</span> are the weights in the underlying risky assets for the efficient low-risk and high-mean portfolios, respectively.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./portfolios.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Optimal Portfolios: Theory</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./input_sensitivity.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Optimal Portfolios: Sensitivity to Inputs</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>